<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Pedro J. Aphalo">
<meta name="author" content="T. Matthew Robson">
<meta name="author" content="Maxime Durand">
<meta name="author" content="(Andreas Albert)">
<meta name="author" content="(Lars Olof Björn)">
<meta name="author" content="(Lasse Yliantilla)">
<meta name="dcterms.date" content="2024-06-17">

<title>4&nbsp; The UV, VIS and NIR environment above vegetation – Field Methods in Plant Photobiology</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./light-environment-plants.html" rel="next">
<link href="./optics.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-364982630eef5352dd1537128a8ed5cb.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="application/json" class="js-hypothesis-config">
{
  "theme": "clean",
  "openSidebar": true
}
</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./introduction.html">Basics</a></li><li class="breadcrumb-item"><a href="./light-environment-terrestrial.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">The UV, VIS and NIR environment above vegetation</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Field Methods in Plant Photobiology</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface-1ed.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface to the 1st edition</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface to the 2nd edition</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./contents.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Table of Contents</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./abbreviations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">List of abbreviations and symbols</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Basics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./radiation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Radiation Physics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./optics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Radiation-matter Interactions and Optics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./light-environment-terrestrial.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">The UV, VIS and NIR environment above vegetation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./light-environment-plants.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">The UV, VIS and NIR environment of plants</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Measurements</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quantifying-radiation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Quantifying radiation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./leaf-optics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Quantifying Optical Properties</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quantifying-responses.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Quantifying plants’ responses</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./imaging.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Imaging in UV, VIS and NIR radiation</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Design and planning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./design-of-experiments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Design of Experiments and Statistics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reproducibility.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Ensuring reproducibility</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Realization and treatments</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./manipulating-radiation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Manipulating UV, VIS and NIR radiation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./plant-cultivation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Plant cultivation</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec:solar:radiation" id="toc-sec:solar:radiation" class="nav-link active" data-scroll-target="#sec\:solar\:radiation"><span class="header-section-number">4.1</span> Solar radiation at ground level</a>
  <ul class="collapse">
  <li><a href="#position-of-the-sun" id="toc-position-of-the-sun" class="nav-link" data-scroll-target="#position-of-the-sun"><span class="header-section-number">4.1.1</span> Position of the sun</a></li>
  <li><a href="#solar-radiation-at-the-top-of-the-atmosphere" id="toc-solar-radiation-at-the-top-of-the-atmosphere" class="nav-link" data-scroll-target="#solar-radiation-at-the-top-of-the-atmosphere"><span class="header-section-number">4.1.2</span> Solar radiation at the top of the atmosphere</a></li>
  <li><a href="#solar-radiation-at-ground-level" id="toc-solar-radiation-at-ground-level" class="nav-link" data-scroll-target="#solar-radiation-at-ground-level"><span class="header-section-number">4.1.3</span> Solar radiation at ground level</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./introduction.html">Basics</a></li><li class="breadcrumb-item"><a href="./light-environment-terrestrial.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">The UV, VIS and NIR environment above vegetation</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">The UV, VIS and NIR environment above vegetation</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
<p class="subtitle lead">Quantity, quality and timing in nature</p>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Authors</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Pedro J. Aphalo <a href="mailto:pedro.aphalo@helsinki.fi" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> <a href="https://orcid.org/0000-0003-3385-972X" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            University of Helsinki
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">T. Matthew Robson </p>
  </div>
  <div class="quarto-title-meta-contents">
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">Maxime Durand </p>
  </div>
  <div class="quarto-title-meta-contents">
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">(Andreas Albert) </p>
  </div>
  <div class="quarto-title-meta-contents">
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">(Lars Olof Björn) </p>
  </div>
  <div class="quarto-title-meta-contents">
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">(Lasse Yliantilla) </p>
  </div>
  <div class="quarto-title-meta-contents">
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 17, 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">July 17, 2024</p>
    </div>
  </div>
    
  </div>
  
<div>
  <div class="abstract">
    <div class="block-title">Abstract</div>
    <p>This chapter discusses the light environment of terrestrial plants.</p>
  </div>
</div>


</header>


<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
First edition authors
</div>
</div>
<div class="callout-body-container callout-body">
<p>Andreas Albert, Lars Olof Björn, Lasse Ylianttila</p>
</div>
</div>
<div class="hidden">
$$
% fluence rate
<p>$$</p>
</div>
<section id="sec:solar:radiation" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="sec:solar:radiation"><span class="header-section-number">4.1</span> Solar radiation at ground level</h2>
<section id="position-of-the-sun" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="position-of-the-sun"><span class="header-section-number">4.1.1</span> Position of the sun</h3>
<p>When studying plants we frequently need to describe the position of the sun because of its effect on spectral irradiance and as a determinant of day length. The azimuth angle (<span class="math inline">\phi</span>) is usually measured clockwise from the North on a horizontal plane. The position on the vertical plane is measured either as the zenith angle (<span class="math inline">\theta</span>) downwards from the zenith, or as an elevation angle (<span class="math inline">h</span>) upwards from the horizon. Consequently <span class="math inline">h + \theta = 90^\circ = \frac{\pi}{2}\,</span>radians. When describing the position of the sun as in <a href="#fig-solar-position" class="quarto-xref">Figure&nbsp;<span>4.1</span></a> the observer is situated at the origin of the system of coordinates used to describe the angles.</p>
<div id="fig-solar-position" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-solar-position-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/solar-position.png" class="img-fluid figure-img" style="width:67.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-solar-position-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.1: Diagram showing the angles used to describe the position of the sun in the sky, viewed from the East. h: sun elevation angle, θ: zenith angle, Φ: azimuth angle.
</figcaption>
</figure>
</div>
<p>The daily path of the sun in the sky depends on the time of the year and the latitude. The time of solar noon depends on the actual geographic location, and nearly always differs from the local-time noon which is based on a time zone and possibly affected by a shift of one or more hours to enhance daylight use, especially in summer time.</p>
<p>Highly accurate astronomical formulas are available and can be used to compute the current, past and future positions of the sun in the sky <span class="citation" data-cites="Meeus1998">(e.g., <a href="references.html#ref-Meeus1998" role="doc-biblioref">Meeus 1998</a>)</span>. Less accurate, but simpler to compute, formulas also exist. These formulas can also be use to compute day- and night lengths based on different twilight definitions.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The accuracy of astronomical formulas is less when the sun is near the horizon because, as seen in the previous chapter, the transition from vacuum to the atmosphere introduces a small angular displacement of the light beam depending on the refractive index and angle of incidence. The difficulty is that the refractive index (<span class="math inline">\nu</span>) of the air depends on its water content, which is not constant.</p>
</div>
</div>
<p>The path of the sun in the sky determines the lengths of the day and night. The most frequently used criterion for the day to night and night to days transitions is that the upper rim of the solar disk coincides with the astronomical horizon. As the solar disk is approximately 2 degrees in diameter, the transition between day and night is in this case when the centre of the solar disk is one degree below the horizon. Alternatively, the centre of the solar disk can be used coinciding with the astronomical horizon can be used as the criterion.</p>
<div id="fig-twilight-full-day" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-twilight-full-day-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/twilight-full-day.png" class="img-fluid figure-img" style="width:67.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-twilight-full-day-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.2: Position of the sun at sunrise, sunset, dawn and dusk. Figure by TWCarlson available at <a href="https://commons.wikimedia.org/wiki/File:Twilight_description_full_day.svg">Wikimedia Commons</a> under CC-BY-SA 3.0.
</figcaption>
</figure>
</div>
<p>Twilight is the period before sunrise and after sunset when there is more intense diffuse light than further into the night (<a href="#fig-twilight-full-day" class="quarto-xref">Figure&nbsp;<span>4.2</span></a>). The definitions of twilight are based on practical considerations of human activities, and called <em>civil</em>, <em>naval</em> and <em>astronomical</em> (<a href="#fig-twilight-angles" class="quarto-xref">Figure&nbsp;<span>4.3</span></a>). During civil twilight artificial lighting is usually not needed in cities. For nautical twilight I have seen two descriptions: 1) before nautical dawn and after nautical dawn it is possible to navigate based on the stars, and 2) after nautical dawn and before nautical dusk navigation by sight is possible. Before astronomical dawn and after astronomical dusk stars of sixth magnitude are visible. These three descriptions are very approximate, as they do not consider the effect of clouds, light pollution from artificial sources, or other source of light.</p>
<div id="fig-twilight-angles" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-twilight-angles-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/twilight-dawn-angles.png" class="img-fluid figure-img" style="width:67.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-twilight-angles-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.3: Criteria defining twilight based on the position of the sun. The angles when expressed as sun elevation (<span class="math inline">h</span>) are negative. Only dawn and sunrise shown. The same angles are used between sunset and dusk. Figure by TWCarlson available at <a href="https://commons.wikimedia.org/wiki/File:Twilight_description_full_day.svg">Wikimedia Commons</a> under CC-BY-SA 3.0., edited
</figcaption>
</figure>
</div>
<p>The day length through the year computed for three cities, one of them, Ivalo at the northern latitude within the Artic circle.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-day-length" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-day-length-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="light-environment-terrestrial_files/figure-html/fig-day-length-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-day-length-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.4: Day length through the year at different latitudes.
</figcaption>
</figure>
</div>
</div>
</div>
<p>If we include twilight, the estimated length of the photoperiod increases (<a href="#fig-daylength-twilight" class="quarto-xref">Figure&nbsp;<span>4.5</span></a>).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-daylength-twilight" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-daylength-twilight-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="light-environment-terrestrial_files/figure-html/fig-daylength-twilight-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-daylength-twilight-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.5: Photoperiod duration computed for sunrise/sunset or for dawn/dusk according to different twilight definitions. The curve describes the elevation angle of the sun through the day at Helsinki, Finalnd, on the 21 March 2024. The horizontal lines show the elevation angles used as the boundary of the “photoperiod” and the numbers above each of these lines give the corresponding length of the photoperiod in hours.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Even though day length or photoperiod duration is normally based on the astronomical horizon, in many cases there are obstacles that occlude the sun from view until later at dawn or earlier at dusk: mountains, vegetation, buildings, etc. Thus, in some cases it may be more relevant for a scientific study with plants to consider sun elevation angles <span class="math inline">h &gt; 0</span> as the criterion; even different angles can be used for day start and day end.</p>
<p>The question remains of what light level is actually detected by plants and other organisms as the night-day and day-night transitions. Most likely the exact value depends on the genotype and the realized phenotype. However, at dawn and dusk irradiance increases and decreases, respectively, qquite fast at low and medium latitudes. At high latitudes, at some times the year twilight lasts for a long time making the change in irradiance more gradual. At civil dawn/dusk irradiance is already very low.</p>
</div>
</div>
<p>The dependency of the elevation angle on time of the year and latitude is illustrated in <a href="#fig-sun-elevation-world" class="quarto-xref">Figure&nbsp;<span>4.6</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-sun-elevation-world" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-sun-elevation-world-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="light-environment-terrestrial_files/figure-html/fig-sun-elevation-world-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sun-elevation-world-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.6: Sun elevation angle through the day at five different latitudes and four dates. The horizontal dotted lines show the horizon (<span class="math inline">h = 0</span>). The range limits for the <em>x</em> and <em>y</em> axes are consistent across all plots.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Three images from fig 3.6 in Graedel and Crutzen, 1993. Scanned. Have to be redrawn.</p>
<p><img src="images/Earth-equinox.png" class="img-fluid" style="width:30.0%" alt="Equinox"> <img src="images/Earth-N-summer.png" class="img-fluid" style="width:30.0%" alt="N hemisphere summer"> <img src="images/Earth-S-summer.png" class="img-fluid" style="width:30.0%" alt="S hemisphere summer"></p>
<p><strong><em>Add links to previous chapter</em></strong></p>
</section>
<section id="solar-radiation-at-the-top-of-the-atmosphere" class="level3" data-number="4.1.2">
<h3 data-number="4.1.2" class="anchored" data-anchor-id="solar-radiation-at-the-top-of-the-atmosphere"><span class="header-section-number">4.1.2</span> Solar radiation at the top of the atmosphere</h3>
<p>We can measure irradiance outside the atmosphere at a know distance from the sun and we can also measure the apparent diameter of the sun at this same distance. Based on this we can calculate the total radiant energy emitted by the sun and irradiance at arbitrary distances.</p>
<p>In outer space, in vacuum, no scattering takes place as the light travels, and because of this, the sky looks completely black. Planets and the Moon do reflect light allowing us to see them. As the distance to the sun increases irradiance decreases as the flux spreads into a large area represented by the surface of a sphere, without scattering, this becomes a geometric computations in 3D.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Geometric calculation
</div>
</div>
<div class="callout-body-container callout-body">
<p>The spectral irradiance of the sun <span class="math inline">{E_{\mathrm{s}}}(\lambda)</span> can be estimated assuming a homogeneous flux and using the correlation of intensity and radiance from their definitions in table <a href="#tab:Phys:Quants" data-reference-type="ref" data-reference="tab:Phys:Quants">[tab:Phys:Quants]</a>. The intensity of the sun <span class="math inline">{I_{\mathrm{s}}}(\lambda)</span> is given by the radiance <span class="math inline">{L_{\mathrm{s}}}(\lambda)</span> multiplied by the apparent sun surface (a non-tilted disk of radius <span class="math inline">r_s=7\times 10^5</span> km). To calculate the decreased solar irradiance at the top of the Earth’s atmosphere, the distance of the sun to the Earth (<span class="math inline">r_0=150\times 10^6</span> km) has to be taken into account applying the inverse square law of irradiance of equation (<a href="#equ_r2law" data-reference-type="ref" data-reference="equ_r2law">[equ_r2law]</a>). Thus, the extraterrestrial solar irradiance is</p>
<p><span class="math display">{E_{\mathrm{s}}}(\lambda)={L_{\mathrm{s}}}(\lambda)\cdot\frac{\pi r_s^2}{r_0^2}</span> Remembering the solid angle of equation (<a href="#equ_solidangle" data-reference-type="ref" data-reference="equ_solidangle">[equ_solidangle]</a>), the right multiplication factor represents the solid angle of the sun’s disk as seen from the Earth’s surface (<span class="math inline">\approx 6.8\times 10^{-5}</span> sr).</p>
</div>
</div>
<p>At the time scales relevant to plants and humans, the distance between the Sun and the Earth varies little, as well as the emission from the surface of the sun. Thus, we can use a “solar constant” as a useful and nearly perfect approximation. The solar “constant”, the irradiance at the top of the atmosphere, varies between <span class="math inline">1\,361</span> and <span class="math inline">1\,362~\mathrm{W m^{-2}}</span> due to changes in solar activity. In addition to the irradiance, the shape of the solar spectrum at the top of the atmosphere varies very little in time, and is usually assumed constant.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Radiation from the sun reaches the Earth’s surface in about eight minutes (<span class="math inline">t</span> = time, <span class="math inline">r_0</span> = distance sun to earth, <span class="math inline">c</span> = velocity of light in vacuum): <span class="math display">t = \frac{r_0}{c} \approx \frac{150 \times 10^9 ~{\rm m}}{3 \times 10^8 ~\frac{\rm m}{\rm s}} = 500 ~{\rm s} = 8.3 ~{\rm min}</span>.</p>
</div>
</div>
<p>The energy radiance (<span class="math inline">L</span>) of radiation emitted by the sun is similar in shape, but not identical, to the emission spectrum of a <em>black body</em>. The solar spectrum has a fine structure of peaks and valleys arising from the atoms and molecules in the sun while black body emission is described by a smooth curve. A “match” based on the wavelength at which spectral <em>energy</em> radiance is at its maximum can be used as criterion to estimate the temperature of the sun’s surface. Obviously, we use the extraterrestrial spectrum for this match. We see in the AM0 curve in <a href="#fig-sun-spectra-energy" class="quarto-xref">Figure&nbsp;<span>4.11</span></a> that the wavelength at the maximum is near 500 nm. In reality the temperature of the sun surface is not uniform, and different sources mention as its average temperatures between 5800 K and 5500 K. Comparing the AM0 curve in <a href="#fig-sun-spectra-energy" class="quarto-xref">Figure&nbsp;<span>4.11</span></a> to the 5800 K curve in <a href="#fig-blackbody-emission" class="quarto-xref">Figure&nbsp;<span>4.7</span></a> the similary of their shapes is clear.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-blackbody-emission" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-blackbody-emission-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="light-environment-terrestrial_files/figure-html/fig-blackbody-emission-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-blackbody-emission-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.7: Radiance spectra for black bodies at three different temperatures; 5800 K (blue), 5000 K (orange) and 3700 K (red).
</figcaption>
</figure>
</div>
</div>
</div>
<p>Planck’s law describes black body emission at temperature <span class="math inline">T</span> (<a href="#fig-blackbody-emission" class="quarto-xref">Figure&nbsp;<span>4.7</span></a>), expressed as absolute temperature measured in degrees Kelvin (K):</p>
<p><span class="math display">L_s(\lambda,T) = \frac{2hc^2}{\lambda^5}\cdot\frac{1}{\mathrm{e}^{(hc/k_\mathrm{B}T\lambda)}-1}</span></p>
<p>with Boltzmann’s constant <span class="math inline">k_\mathrm{B}=1.381\times 10^{-23}</span> .</p>
<p>The “equivalent temperature” of a black body is given by Wien’s displacement law (<a href="#fig-wein-wl" class="quarto-xref">Figure&nbsp;<span>4.8</span></a>), which gives the wavelength at which the radiative energy emitted by a black body is at its maximum as a function of its absolute temperature.</p>
<p><span class="math display">\lambda_\mathrm{max} \cdot T = 2.898 \times 10^6 \,{\rm nm\,K}</span></p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-wein-wl" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-wein-wl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="light-environment-terrestrial_files/figure-html/fig-wein-wl-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-wein-wl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.8: The peak wavelength of radiation emission by a black body as a function of its absolute (surface) temperature. The approximate temperature of the sun <span class="math inline">T_\mathrm{sun} \approx 5800\,\mathrm{K}</span> is highlighted by a yellow-filled circle.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>The concept of “colour temperature” used for describing the emission of lamps used for illumination and more generaly in photography differs in that it takes into account human colour vision when determining the match between the black body emission spectrum and the spectrum of an arbitrary light source. The coordinated colour temperature (CCT) for the AM1.5 solar spectrum is 5231 K and for the AM0 spectrum is 5922 K.</p>
</div>
</div>
<p>The spectral irradiance of the sun <span class="math inline">{E_{\mathrm{s}}}(\lambda)</span> can be estimated assuming a homogeneous flux and using the correlation of intensity and radiance from their definitions in table <a href="#tab:Phys:Quants" data-reference-type="ref" data-reference="tab:Phys:Quants">[tab:Phys:Quants]</a>. The intensity of the sun <span class="math inline">{I_{\mathrm{s}}}(\lambda)</span> is given by the radiance <span class="math inline">{L_{\mathrm{s}}}(\lambda)</span> multiplied by the apparent sun surface (a non-tilted disk of radius <span class="math inline">r_s=7\times 10^5</span> km). To calculate the decreased solar irradiance at the moment of reaching the Earth’s atmosphere, the distance of the sun to the Earth (<span class="math inline">r_0=150\times 10^6</span> km) has to be taken into account due to the inverse square law of irradiance of equation (<a href="#equ_r2law" data-reference-type="ref" data-reference="equ_r2law">[equ_r2law]</a>). Thus, the extraterrestrial solar irradiance is</p>
<p><span class="math display">{E_{\mathrm{s}}}(\lambda)={L_{\mathrm{s}}}(\lambda)\cdot\frac{\pi r_s^2}{r_0^2}\label{equ_extraterrestrial}</span> Remembering the solid angle of equation (<a href="#equ_solidangle" data-reference-type="ref" data-reference="equ_solidangle">[equ_solidangle]</a>), the right multiplication factor represents the solid angle of the sun’s disk as seen from the Earth’s surface (<span class="math inline">\approx 6.8\times 10^{-5}</span> sr). Figure <a href="#fig_sun" data-reference-type="ref" data-reference="fig_sun">[fig_sun]</a> shows the spectrum of the measured extraterrestrial solar radiation (Wehrli, 1985)<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> and the spectrum calculated by equation 1.14 using Planck’s law of equation 1.12 at a black body temperature of 5800 K. Integrated over all wavelengths, <span class="math inline">{E_{\mathrm{s}}}</span> is about 1361 to 1362 at top of the atmosphere <span class="citation" data-cites="Kopp2011">(<a href="references.html#ref-Kopp2011" role="doc-biblioref">Kopp and Lean 2011</a>)</span>. This value is called the ‘solar constant’. In former times, depending on different measurements, <span class="math inline">{E_{\mathrm{s}}}</span> varies by a few percent <span class="citation" data-cites="iqbal83">(<a href="references.html#ref-iqbal83" role="doc-biblioref">Iqbal 1983</a>)</span>. For example, the irradiance at the top of the atmosphere (the integrated value) changes by <span class="math inline">\pm 50</span> (3.7 %) during the year due to distance variation caused by orbit excentricity <span class="citation" data-cites="moble94">(<a href="references.html#ref-moble94" role="doc-biblioref">Mobley 1994</a>)</span>. More accurate measurements during the last 25 years by spaceborne radiometers show a variability of the solar radiation of a few tenth of a percent. A detailed analysis is given by <span class="citation" data-cites="froeh04">Fröhlich and Lean (<a href="references.html#ref-froeh04" role="doc-biblioref">2004</a>)</span>. <span class="math inline">{E_{\mathrm{s}}}</span> can also be calculated by the Stefan-Boltzmann Law: the total energy emitted from the surface of a black body is proportional to the fourth power of its temperature. For an isotropically emitting source (Lambertian emitter), this means <span class="math display">{L_{\mathrm{}}}= \frac{\sigma}{\pi} \cdot T^4 \label{equ_boltzmann}</span> with the Stefan-Boltzmann constant <span class="math inline">\sigma=5.6705\times 10^{-8}</span> W m<span class="math inline">^{-2}</span> K<span class="math inline">^{-4}</span>. With <span class="math inline">T = 5800</span> K equation <a href="#equ_boltzmann" data-reference-type="ref" data-reference="equ_boltzmann">[equ_boltzmann]</a> gives the radiance of the solar disc. From this value, we can obtain an approximation of the solar constant, by taking into account the distance from the Earth to the Sun and the apparent size of the solar disc (see equations <a href="#equ_solidangle" data-reference-type="ref" data-reference="equ_solidangle">[equ_solidangle]</a> and <a href="#equ_r2law" data-reference-type="ref" data-reference="equ_r2law">[equ_r2law]</a>).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-sun-black-body" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-sun-black-body-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="light-environment-terrestrial_files/figure-html/fig-sun-black-body-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sun-black-body-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.9: The extraterrestrial solar spectrum compared to black body emission. The black body emission spectrum has been scaled to match the energy irradiance of the solar spectrum at the top of the atmosphere (AM0) within the range of wavelengths shown.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The total solar irradiance covers a wide range of wavelengths. Using some of the ‘colours’ introduced in table <a href="#tab:Waverange" data-reference-type="ref" data-reference="tab:Waverange">[tab:Waverange]</a>, table <a href="#tab_sun" data-reference-type="ref" data-reference="tab_sun">[tab_sun]</a> lists the irradiance and fraction of <span class="math inline">{E_{\mathrm{s}}}</span> of different wavelength intervals.</p>
<div class="table*">
<div class="center">
<table class="caption-top table">
<colgroup>
<col style="width: 21%">
<col style="width: 22%">
<col style="width: 20%">
<col style="width: 36%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Waveband</th>
<th style="text-align: center;">Wavelength <span class="math inline">\lambda</span> (nm)</th>
<th style="text-align: center;">Irradiance <span class="math inline">{E_{\mathrm{}}}</span> (<span class="math inline">W m^{-2}</span>)</th>
<th style="text-align: center;">Irradiance <span class="math inline">{E_{\mathrm{}}}</span> (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">UV-C</td>
<td style="text-align: center;">100 – 280</td>
<td style="text-align: center;">7</td>
<td style="text-align: center;">0.5</td>
</tr>
<tr class="even">
<td style="text-align: center;">UV-B</td>
<td style="text-align: center;">280 – 315</td>
<td style="text-align: center;">17</td>
<td style="text-align: center;">1.3</td>
</tr>
<tr class="odd">
<td style="text-align: center;">UV-A2</td>
<td style="text-align: center;">315 – 340</td>
<td style="text-align: center;">21</td>
<td style="text-align: center;">1.6</td>
</tr>
<tr class="even">
<td style="text-align: center;">UV-A1</td>
<td style="text-align: center;">340 – 400</td>
<td style="text-align: center;">63</td>
<td style="text-align: center;">4.7</td>
</tr>
<tr class="odd">
<td style="text-align: center;">PhR</td>
<td style="text-align: center;">400 – 700</td>
<td style="text-align: center;">531</td>
<td style="text-align: center;">39.6</td>
</tr>
<tr class="even">
<td style="text-align: center;">IR-A (CIE)</td>
<td style="text-align: center;">700 – 1400</td>
<td style="text-align: center;">517</td>
<td style="text-align: center;">38.6</td>
</tr>
<tr class="odd">
<td style="text-align: center;">IR-B (CIE)</td>
<td style="text-align: center;">1400 – 3000</td>
<td style="text-align: center;">184</td>
<td style="text-align: center;">13.7</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>TOTAL</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"><strong>1339</strong></td>
<td style="text-align: center;"><strong>100.0</strong></td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="solar-radiation-at-ground-level" class="level3" data-number="4.1.3">
<h3 data-number="4.1.3" class="anchored" data-anchor-id="solar-radiation-at-ground-level"><span class="header-section-number">4.1.3</span> Solar radiation at ground level</h3>
<p>Above, we used the word <em>light</em> with its everyday meaning. Its technical definition is of radiation visible to humans. Ultraviolet, visible and infrared radiation (taken together are called in meteorolgy <em>shortwave radiation</em>) are components of solar radiation.</p>
<section id="spectrum-under-clear-sky" class="level4" data-number="4.1.3.1">
<h4 data-number="4.1.3.1" class="anchored" data-anchor-id="spectrum-under-clear-sky"><span class="header-section-number">4.1.3.1</span> Spectrum under clear sky</h4>
<p><strong>We could include a plot of scalar spectral irradiance (easy to generate with TUV) or of hemispherical spectral irradiance measured with a hemispherical diffuser (I have data). A comparison to spectral irradiance on a horizontal plane could be very informative.</strong></p>
<p>Before reaching the Earth’s surface radiation from the sun travels through the atmosphere. The sun elevation angle affects the length of the path that the light arriving from the sun travels through the atmosphere. In atmospheric physics it is common to describe spectra as corresponding to <em>AM0</em> for above the atmosphere, <em>AM1</em> when the sun is at the zenith, i.e., one atmosphere thickness and <em>AM1.5</em> when the length of the air mass traversed is 1.5 times that when the sun is at the zenith.</p>
<p>The air mass traversed is, in reality, not exactly proportional to the distance computed by trigonometry, but not far from it. An empirical formula <span class="citation" data-cites="Kasten1989">(<a href="references.html#ref-Kasten1989" role="doc-biblioref">Kasten and Young 1989</a>)</span> can be used as a better approximation to the computation of AM values from the elevation angle (<span class="math inline">h</span>) (<a href="#fig-AM-h" class="quarto-xref">Figure&nbsp;<span>4.10</span></a>).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-AM-h" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-AM-h-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="light-environment-terrestrial_files/figure-html/fig-AM-h-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-AM-h-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.10: Plot of the empirical relationship between sun elevation (<span class="math inline">h</span>) or zenith anglr (<span class="math inline">\theta</span>) and “equivalent” atmosphere thickness traversed by solar radiation between outer space and the Earth’s surface (at sea level). AM1 is indicated by the horizontal dotted line.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Light when travelling through the atmosphere interacts with the gases and particles composing it. The light is attenuated and scattered. Different wavelengths are differently affected by these processes, giving us a blue sky and warmer coloured direct sunlight. In other words, the daylight spectrum depends on the position of the sun in the sky, and on the composition of the atmosphere along this path (<a href="#fig-sun-spectra-energy" class="quarto-xref">Figure&nbsp;<span>4.11</span></a> and <a href="#fig-sun-spectra-photons" class="quarto-xref">Figure&nbsp;<span>4.12</span></a>). In addition to molecular absorption and scattering, aerosols, both liquid like water and solid like ice and dust, interact with light.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-sun-spectra-energy" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-sun-spectra-energy-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="light-environment-terrestrial_files/figure-html/fig-sun-spectra-energy-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sun-spectra-energy-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.11: The spectrum of solar radiation above the atmosphere (AM0) and a typical spectrum at ground level (AM1.5). Spectral energy irradiance for the wavelength range called <em>shortwave radiation</em> in meteorology.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-sun-spectra-photons" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-sun-spectra-photons-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="light-environment-terrestrial_files/figure-html/fig-sun-spectra-photons-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sun-spectra-photons-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.12: The spectrum of solar radiation above the atmosphere (AM0) and a typical spectrum at ground level (AM1.5). Spectral photon irradiance for the range 250 to 900 nm.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The extraterrestrial solar spectrum differs from that at ground level due to the absorption of radiation by the atmosphere, because the absorption peaks of water, and other components of the atmosphere, cause corresponding valleys to appear in the solar spectrum at ground level. The solar spectrum has a much finer structure, due to emission and absorption lines of elements, this fine structure is not observable with the spectroradiometers normally used in plant research. For plant research, finr structure of peaks and valleys is considered irrelevant because plant pigments <em>in vivo</em> have broader peaks and valleys in their spectra.</p>
<p>Not only total irradiance, but also the wavelength distribution and the diffuse fraction of the solar spectrum changes with the seasons of the year and time of day. This changes are in large part explained by the change in sun elevation. In what follows we describe these changes as a function of sun elevation. The increasing air mass traversed with decreasing sun elevation affects the shape of the spectrum, by stronger attenuation of the shorter wavelengths. An increased air mass also increases scattering in the atmosphere.</p>
<p>A figure of spectral irradiance is difficult to read as both the shape of the curve and the maximum spectral irradiance change in parallel <a href="#fig-spectra-sun-elevation" class="quarto-xref">Figure&nbsp;<span>4.13</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-spectra-sun-elevation" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-spectra-sun-elevation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="light-environment-terrestrial_files/figure-html/fig-spectra-sun-elevation-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-spectra-sun-elevation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.13: Change in spectral irradiance with sun elevation angle. Based on simulations with the TUV model for an ozone column of 300 DU under clear sky.
</figcaption>
</figure>
</div>
</div>
</div>
<p>If we rescale the curves to equal PAR irradiance the change in shape is easier to observe <a href="#fig-uv-spectra-sun-elevation-scaled" class="quarto-xref">Figure&nbsp;<span>4.14</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-uv-spectra-sun-elevation-scaled" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-uv-spectra-sun-elevation-scaled-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="light-environment-terrestrial_files/figure-html/fig-uv-spectra-sun-elevation-scaled-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-uv-spectra-sun-elevation-scaled-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.14: Change in scaled spectral irradiance with sun elevation angle. UV region of the spectrum. Based on simulations with the TUV model for an ozone column of 300 DU under clear sky. Spectra scaled to PAR = <span class="math inline">1\,000\,\mu mol\,s^{-1}\,m^{-2}</span>.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-nir-spectra-sun-elevation-scaled" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nir-spectra-sun-elevation-scaled-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="light-environment-terrestrial_files/figure-html/fig-nir-spectra-sun-elevation-scaled-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nir-spectra-sun-elevation-scaled-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.15: Change in scaled spectral irradiance with sun elevation angle. Red-FR region of the spectrum. Based on simulations with the TUV model for an ozone column of 300 DU under clear sky. Spectra scaled to PAR = <span class="math inline">1\,000\,\mu mol\,s^{-1}\,m^{-2}</span>.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Plotting the normalised photon irradiance for different wavebands <a href="#fig-wbands-elevation-normalized" class="quarto-xref">Figure&nbsp;<span>4.16</span></a> shows that the daily course of UV-B photon irradiance is different than that for other bands, even the adjacent UV-A2. UV-B irradiance decreases faster with decreasing sun elevation (<span class="math inline">h</span>).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-wbands-elevation-normalized" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-wbands-elevation-normalized-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="light-environment-terrestrial_files/figure-html/fig-wbands-elevation-normalized-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-wbands-elevation-normalized-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.16: Change in irradiance with sun elevation angle for different regions of the spectrum. PAR. orange, UVA-1. violet, UV-A2. purple, and UV-B. black. Based on simulations with the TUV model for an ozone column of 300 DU.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="diffuse-fraction-under-clear-sky" class="level4" data-number="4.1.3.2">
<h4 data-number="4.1.3.2" class="anchored" data-anchor-id="diffuse-fraction-under-clear-sky"><span class="header-section-number">4.1.3.2</span> Diffuse fraction under clear sky</h4>
<p>At the Earth’s surface, the incident radiation or <em>global radiation</em> has two distinct components, <em>direct radiation</em> and <em>diffuse radiation</em>. Direct radiation is radiation travelling directly from the sun, while diffuse radiation is that scattered by the atmosphere. Diffuse radiation is what gives the blue colour to the sky and white colour to clouds. The relative contribution of direct and diffuse radiation to global radiation varies with wavelength and weather conditions. The contribution of diffuse radiation is more in the UV region, and in the presence of clouds (Figures <a href="#fig:sky:photos" data-reference-type="ref" data-reference="fig:sky:photos">[fig:sky:photos]</a> and <a href="#fig:diffuse:UV" data-reference-type="ref" data-reference="fig:diffuse:UV">[fig:diffuse:UV]</a>).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="photos/Lasse_sky_composite.jpg" class="img-fluid figure-img"></p>
<figcaption>image</figcaption>
</figure>
</div>
<p>Simultaneous spectral measurements of direct and diffuse solar radiation are infrequent. Radiation transfer models such as TUV estimate these components, as shown in <a href="#fig-spectra-diffuse-TUV-45" class="quarto-xref">Figure&nbsp;<span>4.17</span></a>. The diffuse fraction is larger at shorter wavelengths. Under overcast conditions or any other situation when the solar disk is fully occluded the diffuse fraction is equal to one. However, only in outer space the diffuse fraction approaches zero.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-spectra-diffuse-TUV-45" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-spectra-diffuse-TUV-45-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="light-environment-terrestrial_files/figure-html/fig-spectra-diffuse-TUV-45-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-spectra-diffuse-TUV-45-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.17: Spectral energy irradiance under a clear sky and sun elevation of 45 degrees. Simulation with the TUV radiation transfer and atmospheric chemistry model for an ozone column on 300 DU, assuming a low optical density of aerosols. The black line shown total spectral energy irradiance, the orange-filled area is the direct component and the blue-filled area is the diffuse or scattered component.
</figcaption>
</figure>
</div>
</div>
</div>
<p>In <a href="#fig-spectra-diffuse-TUV-45" class="quarto-xref">Figure&nbsp;<span>4.17</span></a> the spectrum at a single sun elevation is shown. In <a href="#fig-diffuse-TUV" class="quarto-xref">Figure&nbsp;<span>4.18</span></a> the diffuse fraction from simulations under the same atmospheric conditions are shown as a function of sun elevation. The diffuse fraction is largest for shorter wavelengths and for each waveband it increases as the sun elevation decreases. This change is not linear, and has a similar shape as the change in air mass traversed <a href="#fig-AM-h" class="quarto-xref">Figure&nbsp;<span>4.10</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-diffuse-TUV" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-diffuse-TUV-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="light-environment-terrestrial_files/figure-html/fig-diffuse-TUV-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-diffuse-TUV-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.18: Fraction of total radiation that is diffuse under a clear sky as a function of sun elevation angle. PAR, orange dashed; Red, red; Green, green; Blue, blue; UVA-1, violet; UV-A2, purple; UV-B, black. Based on simulations with the TUV radiation transfer and atmospheric chemistry model for an ozone column on 300 DU, assuming a low optical density of aerosols.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="ozone-column" class="level4" data-number="4.1.3.3">
<h4 data-number="4.1.3.3" class="anchored" data-anchor-id="ozone-column"><span class="header-section-number">4.1.3.3</span> Ozone column</h4>
<p>The spectral wavelength distribution is also modified by the amount of ozone in the atmosphere, known as the ozone column and measured in Dobson units (DU = mm of pure ozone) <a href="#fig-UVB-PAR-ozone" class="quarto-xref">Figure&nbsp;<span>4.20</span></a>. As expected, it is also affected by the air mass traversed, which depends on sun elevation. The UV-B:PAR photon ratior is more strongly dependent on the thickness of the ozone column at low sun elevations, when the ratio it smallest <a href="#fig-UVB-PAR-ozone" class="quarto-xref">Figure&nbsp;<span>4.20</span></a>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Climate change and ozone depletion
</div>
</div>
<div class="callout-body-container callout-body">
<p>An increase in the UV-B and UV-A2 irradiance is caused by depletion of the ozone layer in the stratosphere, mainly as a consequence of the release of chlorofluorocarbons (CFCs), used in cooling devices such as refrigerators and air conditioners, and in some spray cans <span class="citation" data-cites="Graedel1993">(see <a href="references.html#ref-Graedel1993" role="doc-biblioref">Graedel and Crutzen 1993</a>)</span>. The most dramatic manifestation of this has been the seasonal formation of an “ozone hole” over Antarctica. It is controversial whether a true ozone hole has already formed in the Arctic, but strong depletion has occurred in year 2011 <span class="citation" data-cites="Manney2011">(<a href="references.html#ref-Manney2011" role="doc-biblioref">Manney et al. 2011</a>)</span> and atmospheric conditions needed for the formation of a “deep” ozone hole are not very different from those prevalent in recent years. Not so dramatic, but consistent, depletion has also been observed at mid-latitudes in both hemispheres. CFCs and some other halocarbons have been phased out following the Montreal agreement and later updates. However, as CFCs have a long half life in the atmosphere, of the order of 100 years, their effect on the ozone layer will persist for many years, even after their use has been drastically reduced. Model-based predictions of changes in atmospheric circulation due to global climate change have been used to derive future trends in index and ozone column thickness <span class="citation" data-cites="Hegglin2009">(<a href="references.html#ref-Hegglin2009" role="doc-biblioref">Hegglin and Shepherd 2009</a>)</span>. In addition, increased cloudiness and pollution, could lead to decreased global irradiance, sometimes called ‘global dimming’ <span class="citation" data-cites="Stanhill2001">(e.g. <a href="references.html#ref-Stanhill2001" role="doc-biblioref">Stanhill and Cohen 2001</a>)</span>.</p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-uv-spectra-ozone-scaled" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-uv-spectra-ozone-scaled-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="light-environment-terrestrial_files/figure-html/fig-uv-spectra-ozone-scaled-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-uv-spectra-ozone-scaled-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.19: Change in scaled spectral irradiance with sun elevation angle. UV-B and UV-A2 regions of the spectrum. Spectra scaled to PAR = <span class="math inline">1\,000\,\mu mol\,s^{-1}\,m^{-2}</span>. Based on simulations with libradtran for 300 DU and 240 DU, a 20% depletion at Jokioinen, Finland. Data from Anders Lindfors.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-UVB-PAR-ozone" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-UVB-PAR-ozone-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="light-environment-terrestrial_files/figure-html/fig-UVB-PAR-ozone-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-UVB-PAR-ozone-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.20: Daily time course of UV-B:PAR photon ratio under a clear sky, under normal and 20% depleted ozone column. Based on simulations with libradtran for 300 DU and 240 DU, a 20% depletion at Jokioinen, Finland. Data from Anders Lindfors.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="clouds" class="level4" data-number="4.1.3.4">
<h4 data-number="4.1.3.4" class="anchored" data-anchor-id="clouds"><span class="header-section-number">4.1.3.4</span> Clouds</h4>
<p>Above we have ignored the effects of clouds and relied heavily on simulations for clear-sky conditions. Next we will consider the effect of clouds and use as examples measurements and simulations that include the effect of clouds. We will consider variation at different time scales. We start with a time series of hourly mean spectra for one day, scaled to equal PAR photon irradiance to illustrate how the shape of the spectrum can change during the course of day <a href="#fig-spectra-whole-day-anim" class="quarto-xref">Figure&nbsp;<span>4.21</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-spectra-whole-day-anim" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-spectra-whole-day-anim-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="light-environment-terrestrial_files/figure-html/fig-spectra-whole-day-anim-1.gif" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-spectra-whole-day-anim-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.21: Time series of scaled spectral photon irradiance during one day. Hourly mean spectra scaled to PAR = 1000 <span class="math inline">\mu mol\,s^{-1}\,m^{-2}</span> to emphasize the change in shape. Simulated with libradtran including the effect of clouds for Kumpula, Helsinki, Finland. Data from Andes Lindfors.
</figcaption>
</figure>
</div>
</div>
</div>
<p>It should be noted that, through reflection, broken clouds can locally increase irradiance to values above those under clear-sky conditions <span class="citation" data-cites="Frederick1993 Diaz1996">(<a href="references.html#ref-Frederick1993" role="doc-biblioref">Frederick et al. 1993</a>; <a href="references.html#ref-Diaz1996" role="doc-biblioref">Díaz et al. 1996</a>)</span>. These are transient increases of short duration and easily detected with fast measurements, and the irradiance increase can be 30% or more compared to under a clear sky. This is well illustrated by measurements at 1 min interval during four consecutive days <a href="#fig-PAR-four-days" class="quarto-xref">Figure&nbsp;<span>4.22</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-PAR-four-days" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-PAR-four-days-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="light-environment-terrestrial_files/figure-html/fig-PAR-four-days-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-PAR-four-days-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.22: Time course of PAR, UV-A and UV-B photon irradiance during four consecutive days with different cloud conditions. Measured with broad band-sensors at Viikki, Helsinki, Finland. The values plotted are 1 min means from measurements once every 5 s. The step changes at very low sun elevations are caused by shading from far-away buildings.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The photon ratios for the same four days <a href="#fig-ratios-four-days" class="quarto-xref">Figure&nbsp;<span>4.23</span></a> shows the influence of clouds and of sun elevation, both affecting the PAR diffuse fraction. In particular, broken clouds on 10 July cause momentary nearly doubling of the UV-A:PAR and UV-B:PAR photon ratios. The short-term effect on the R:FR is smaller, but the differences between days larger, possibly because of its dependence on the atmospheric water content <span class="citation" data-cites="kotilainenxxxx">(<a href="references.html#ref-kotilainenxxxx" role="doc-biblioref"><strong>kotilainenxxxx?</strong></a>)</span>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-ratios-four-days" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ratios-four-days-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="light-environment-terrestrial_files/figure-html/fig-ratios-four-days-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ratios-four-days-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.23: Time course of red:far-red, UV-A:PAR and UV-B:PAR photon ratios during four consecutive days with different cloud conditions. Measured with broad band-sensors at Viikki, Helsinki, Finland. The values plotted are 1 min means from measurements once every 5 s; data shown for sun above the horizon. The step changes at very low sun elevations are caused by shading from far-away buildings. The PAR diffuse ratio varies with sun elevation in the range 0.12 to 1.0, as shown in <a href="#fig-diffuse-TUV" class="quarto-xref">Figure&nbsp;<span>4.18</span></a> for clear sky conditions. With the solar disk fully occluded by clouds or objects the diffuse ratio approches 1 at all sun elevations.
</figcaption>
</figure>
</div>
</div>
</div>
<p>In <a href="#fig-ratios-four-days" class="quarto-xref">Figure&nbsp;<span>4.23</span></a> we can see fast changes in the ratios towards the end of the day. The time-series of spectra measured once a minute during 5 minutes shows how the shape of the spectrum can rapidly change leading to rapid changes in the R:FR photon ratio <a href="#fig-spectra-anim-five-min" class="quarto-xref">Figure&nbsp;<span>4.24</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-spectra-anim-five-min" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-spectra-anim-five-min-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="light-environment-terrestrial_files/figure-html/fig-spectra-anim-five-min-1.gif" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-spectra-anim-five-min-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.24: Time series of spectra near sunset. Five minutes of solar spectra measurements. Measured with an array spectrometer at Viikki, Helsinki, Finland.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The low irradiance periods interspersed with higher irradiance ones, caused by moving clouds intermittently occluding the sun, or cloud flecks, have a haphazard dynamics that is very dependent on the cloud type and wind conditions. One way of describing them is by estimating an empirical probability density function for their duration <a href="#fig-cloudflecks-edf" class="quarto-xref">Figure&nbsp;<span>4.25</span></a>. The distribution is not Normal, and skewed to the right. Semi-transparent and small clouds attenuate irradiance less that large thick clouds and at the same time create cloud flecks of shorter duration <a href="#fig-cloudflecks-edf" class="quarto-xref">Figure&nbsp;<span>4.25</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-cloudflecks-edf" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-cloudflecks-edf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="light-environment-terrestrial_files/figure-html/fig-cloudflecks-edf-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cloudflecks-edf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.25: xxxxxxxxxxxxxxx. In the main panel a quantile regression is shown, with the line repesenting the median, the dark band enclosing the two central quantiles (simmilar to the box in a box plot) and the pale band enclosing 90% of the observations. The inset shows the fitted empirical density function (EDF) for the duration of the cloudflecks. Source <span class="citation" data-cites="Sellaro2024">Sellaro et al. (<a href="references.html#ref-Sellaro2024" role="doc-biblioref">2024</a>)</span>.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Irradiance is much lower under cloud cover than in full sunlight under a clear sky <a href="#fig-spectrum-cloudfleck" class="quarto-xref">Figure&nbsp;<span>4.26</span></a>. The cloud light spectrum is shifted towards shorter wavelengths, i.e., shade light is bluer (or cooler) than full sunlight, more easily seen after scaling the spectra to equal irradiance <a href="#fig-spectrum-cloudfleck" class="quarto-xref">Figure&nbsp;<span>4.26</span></a>. For this example the coordinated colour temperature (CCT) was 6190 K and 5580 K for the overcast and clear sky, respectively.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-spectrum-cloudfleck" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-spectrum-cloudfleck-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="light-environment-terrestrial_files/figure-html/fig-spectrum-cloudfleck-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-spectrum-cloudfleck-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.26: Spectra during and immediately after a cloudfleck. A: photon spectral irradiance as measured, B: same data scaled to equal PAR of <span class="math inline">1\,000 \mu mol\,s^{-1}\,m^{-2}</span>. Source <span class="citation" data-cites="Sellaro2024">Sellaro et al. (<a href="references.html#ref-Sellaro2024" role="doc-biblioref">2024</a>)</span>.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="elevation" class="level4" data-number="4.1.3.5">
<h4 data-number="4.1.3.5" class="anchored" data-anchor-id="elevation"><span class="header-section-number">4.1.3.5</span> Elevation</h4>
<p><strong>We have three options: 1) generate suitable data with TUV, 2) show measured data from the literature, or 3) both.</strong></p>
<p>A simulation with the TUV model shows how attenuation by the atmosphere decreases with increasing ground altitude under a clear sky, with all other parameters kept unchanged, including surface albedo. As above, we show the actual spectral irradiance and the spectral irradiances scaled to equal PAR photon irradiance. The effect is not huge and the decrease in attenuation is stronger at shorter wavelengths <a href="#fig-spectrum-ground-altitude" class="quarto-xref">Figure&nbsp;<span>4.27</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-spectrum-ground-altitude" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-spectrum-ground-altitude-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="light-environment-terrestrial_files/figure-html/fig-spectrum-ground-altitude-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-spectrum-ground-altitude-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.27: Spectra under clear sky and a sun elevation of 45 degrees at different ground altitudes. A: photon spectral irradiance as computed with the TUV model, B: same data scaled to equal PAR of <span class="math inline">1\,000 \mu mol\,s^{-1}\,m^{-2}</span>.
</figcaption>
</figure>
</div>
</div>
</div>
<p>In <a href="#fig-spectrum-ground-altitude" class="quarto-xref">Figure&nbsp;<span>4.27</span></a> we show the spectra for two extreme altitudes, sea level and 8000 m above sea level. In <a href="#fig-irradiance-ground-altitude" class="quarto-xref">Figure&nbsp;<span>4.28</span></a> we show the increase in UV-B, UV-A2, UV-A1 and PAR with ground altitude.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-irradiance-ground-altitude" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-irradiance-ground-altitude-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="light-environment-terrestrial_files/figure-html/fig-irradiance-ground-altitude-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-irradiance-ground-altitude-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.28: Increase in PAR and UV irradiances at ground level under clear sky as a function of ground altitude above sea level. Based on spectral simulations with TUV for sun elevation 45 degrees. UVA-1, violet; UV-A2, purple; UV-B, black.
</figcaption>
</figure>
</div>
</div>
</div>
<p>In reality, the different variables shown individually in the examples in this chapter, can vary in ways that their effects add up, so the total range of variation is larger than is apparent in the examples above.</p>
</section>
<section id="seasons-and-latitude" class="level4" data-number="4.1.3.6">
<h4 data-number="4.1.3.6" class="anchored" data-anchor-id="seasons-and-latitude"><span class="header-section-number">4.1.3.6</span> Seasons and latitude</h4>
<p>The main determinant of changes in spectral irradiance with seasons and latitude is the changing path of the sun through the sky, and consequently of the sun elevation angle. However, several other variables play a role. The depth of the ozone column varies with latitude and seasonally. Clouds and the water column depth vary locally and with latitude, as does ground elevation and albedo. The result is that spectral irradiance varies in time and space. One way of summarising this is to describe the local climatology using maps with monthly averages over several years interpolated over a geographic grid. One approach is to use data retrieved by instruments on board satellites. An alternative approach is to describe terrestrial solar radiation at locations where ground-level measurements are available. We start with examples based on this second approach and observations with broadband sensors from ELDONET. From the perspective of research with plants the availability of UV-B, UV-A and PhR data measured concurrently is important.</p>
<p>Considering a longer time scale of years, seasonal and daily variation are combined. The seasonal pattern of variation in UV-B daily exposure is very clear but has day to day variation superimposed <a href="#fig-UVB-Erlangen" class="quarto-xref">Figure&nbsp;<span>4.29</span></a>. The strong change in the UV-B:PAR photon ratio with sun elevation creates a strong seasonal pattern in this photon ratio <a href="#fig-UVB-Erlangen" class="quarto-xref">Figure&nbsp;<span>4.29</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-UVB-Erlangen" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-UVB-Erlangen-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="light-environment-terrestrial_files/figure-html/fig-UVB-Erlangen-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-UVB-Erlangen-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.29: Seasonal variation in daily UV-B energy exposure Erlangen, Germany (<span class="math inline">54^\circ 10^\prime \mathrm{N}, 07^\circ 51^\prime \mathrm{E}</span>, 280 m asl). A: daily UV-B energy exposure; B: UV-B:PhR daily-energy-exposures ratio. Note: there are gaps with missing data in the time-series data. Measured with ELDONET instruments <span class="citation" data-cites="Haeder2007">(see, <a href="references.html#ref-Haeder2007" role="doc-biblioref">Häder et al. 2007</a>)</span>.
</figcaption>
</figure>
</div>
</div>
</div>
<p>UV-B irradiance increases with elevation in mountains and with decreasing latitude <a href="#fig-UVB-latitude" class="quarto-xref">Figure&nbsp;<span>4.30</span></a> and is particularly high on high mountains in equatorial regions.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-UVB-latitude" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-UVB-latitude-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="light-environment-terrestrial_files/figure-html/fig-UVB-latitude-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-UVB-latitude-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.30: Latitudinal variation in annual UV-B and UV-A energy exposure in the Northern Hemisphere. Measured with ELDONET instruments. The ground altitude for these locations varies <span class="citation" data-cites="Haeder2007">(see, <a href="references.html#ref-Haeder2007" role="doc-biblioref">Häder et al. 2007</a>)</span>.
</figcaption>
</figure>
</div>
</div>
</div>
<p><strong>I have data for 2-3 years time series measured with the same sensors as the four days plot above. Could be added as they include separate measurements of UV-B, UV-A2, UV-A1, blue, red, far-red and PAR irradiances. Maybe a figure with daily averages per month or week or showing a moving average or moving median could be informative. What do you think?</strong></p>
<p><strong>Maps for global radiation, UV-B, and UV-A could be added to this section. The daily data are available on-line on a 1/2 degree grid for the last &gt;10 years. Some biologically effective exposures are also available. This is a lot of data. I have already downloaded the last 12 months. Downloading the whole time series with worldwide coverage and computing long-term means would be doable I think, but time consuming. For the time being here are maps for UV-B and UV-A with monthly means of daily doses for the whole world.</strong></p>
<div id="fig-uvb-world-map" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-uvb-world-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/UVB-world-map-monthly.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-uvb-world-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.31: Monthly means of daily doses of UV-B. Daily data from 2023-10-01 to 2024-09-30 on a 0.5 by 0.5 degrees grid were used to compute monthly means. Grey areas in the map correspond to continuous night or low sun elevation at solar noon, which prevent remote sensing. Under these conditions UV-B irradiance is very low or null. We thank the AC SAF project of the EUMETSAT for providing data and/or products used in this figure.
</figcaption>
</figure>
</div>
<div id="fig-uva-world-map" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-uva-world-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/UVA-world-map-monthly.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-uva-world-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.32: Monthly means of daily doses of UV-A. Daily data from 2023-10-01 to 2024-09-30 on a 0.5 by 0.5 degrees grid were used to compute monthly means. Grey areas in the map correspond to continuous night or low sun elevation at solar noon, which prevent remote sensing. Under these conditions UV-A irradiance is low or null. We thank the AC SAF project of the EUMETSAT for providing data and/or products used in this figure.
</figcaption>
</figure>
</div>
<div id="fig-uvb-europe-map" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-uvb-europe-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/UVB-europe-map-monthly.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-uvb-europe-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.33: Monthly means of daily doses of UV-B for Europe. Daily data from 2023-10-01 to 2024-09-30 on a 0.5 by 0.5 degrees grid were used to compute monthly means. Grey areas in the map correspond to continuous night or low sun elevation at solar noon, which prevent remote sensing. Under these conditions UV-B irradiance is very low or null. We thank the AC SAF project of the EUMETSAT for providing data and/or products used in this figure.
</figcaption>
</figure>
</div>
<div id="fig-uva-europe-map" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-uva-europe-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/UVA-europe-map-monthly.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-uva-europe-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.34: Monthly means of daily doses of UV-A for Europe. Daily data from 2023-10-01 to 2024-09-30 on a 0.5 by 0.5 degrees grid were used to compute monthly means. Grey areas in the map correspond to continuous night or low sun elevation at solar noon, which prevent remote sensing. Under these conditions UV-A irradiance is low or null. We thank the AC SAF project of the EUMETSAT for providing data and/or products used in this figure.
</figcaption>
</figure>
</div>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-Diaz1996" class="csl-entry" role="listitem">
Díaz, S. B., J. E. Frederick, T. Lucas, C. R. Booth, and I. Smolskaia. 1996. <span>“Solar Ultraviolet Irradiance at <span>T</span>ierra Del <span>F</span>uego: <span>C</span>omparison of Measurements and Calculations over a Full Annual Cycle.”</span> <em>Geophysical Research Letters</em> 23 (4): 355–58. <a href="https://doi.org/10.1029/96GL00253">https://doi.org/10.1029/96GL00253</a>.
</div>
<div id="ref-Frederick1993" class="csl-entry" role="listitem">
Frederick, J. E., P. F. Soulen, S. B. Diaz, I. Smolskaia, C. R. Booth, T. Lucas, and D. Neuschuler. 1993. <span>“Solar Ultraviolet Irradiance Observed from Southern <span>A</span>rgentina: <span>S</span>eptember 1990 to <span>M</span>arch 1991.”</span> <em>Journal of Geophysical Research</em> 98: 8891–97. <a href="https://doi.org/10.1029/93JD00030">https://doi.org/10.1029/93JD00030</a>.
</div>
<div id="ref-froeh04" class="csl-entry" role="listitem">
Fröhlich, C., and J. Lean. 2004. <span>“Solar Radiative Output and Its Variability: Evidence and Mechanisms.”</span> <em>The Astronomy and Astrophysics Review</em> 12: 273–320. <a href="https://doi.org/10.1007/s00159-004-0024-1">https://doi.org/10.1007/s00159-004-0024-1</a>.
</div>
<div id="ref-Graedel1993" class="csl-entry" role="listitem">
Graedel, T. E., and P. J. Crutzen. 1993. <em>Atmospheric Change: An Earth System Perspective</em>. New York: WH Freeman.
</div>
<div id="ref-Haeder2007" class="csl-entry" role="listitem">
Häder, Donat-Peter, Michael Lebert, Martin Schuster, Lineu del Ciampo, E Walter Helbling, and Richard McKenzie. 2007. <span>“<span>ELDONET</span>—a Decade of Monitoring Solar Radiation on Five Continents.”</span> <em>Photochem Photobiol</em> 83: 1348–57. <a href="https://doi.org/10.1111/j.1751-1097.2007.00168.x">https://doi.org/10.1111/j.1751-1097.2007.00168.x</a>.
</div>
<div id="ref-Hegglin2009" class="csl-entry" role="listitem">
Hegglin, Michaela I., and Theodore G. Shepherd. 2009. <span>“Large Climate-Induced Changes in Ultraviolet Index and Stratosphere-to-Troposphere Ozone Flux.”</span> <em>Nature Geoscience</em> advance online publication: 687–91. <a href="https://doi.org/10.1038/ngeo604">https://doi.org/10.1038/ngeo604</a>.
</div>
<div id="ref-iqbal83" class="csl-entry" role="listitem">
Iqbal, M. 1983. <em>An Introduction to Solar Radiation</em>. Academic Press Canada.
</div>
<div id="ref-Kasten1989" class="csl-entry" role="listitem">
Kasten, Fritz, and Andrew T. Young. 1989. <span>“Revised Optical Air Mass Tables and Approximation Formula.”</span> <em>Applied Optics</em> 28 (22): 4735. <a href="https://doi.org/10.1364/ao.28.004735">https://doi.org/10.1364/ao.28.004735</a>.
</div>
<div id="ref-Kopp2011" class="csl-entry" role="listitem">
Kopp, Greg, and Judith L. Lean. 2011. <span>“A New, Lower Value of Total Solar Irradiance: Evidence and Climate Significance.”</span> <em>Geophys. Res. Lett.</em> 38 (1): L01706–. <a href="https://doi.org/10.1029/2010GL045777">https://doi.org/10.1029/2010GL045777</a>.
</div>
<div id="ref-Manney2011" class="csl-entry" role="listitem">
Manney, Gloria L., Michelle L. Santee, Markus Rex, Nathaniel J. Livesey, Michael C. Pitts, Pepijn Veefkind, Eric R. Nash, et al. 2011. <span>“Unprecedented Arctic Ozone Loss in 2011.”</span> <em>Nature</em> 478: 469–75. <a href="https://doi.org/10.1038/nature10556">https://doi.org/10.1038/nature10556</a>.
</div>
<div id="ref-Meeus1998" class="csl-entry" role="listitem">
Meeus, Jean. 1998. <em>Astronomical Algorithms</em>. Willmann-Bell.
</div>
<div id="ref-moble94" class="csl-entry" role="listitem">
Mobley, C. D. 1994. <em>Light and Water - Radiative Transfer in Natural Waters</em>. San Diego: Academic Press. <a href="http://www.curtismobley.com/lightandwater.zip">http://www.curtismobley.com/lightandwater.zip</a>.
</div>
<div id="ref-Sellaro2024" class="csl-entry" role="listitem">
Sellaro, Romina, Maxime Durand, Pedro J. Aphalo, and Jorge J. Casal. 2024. <span>“Making the Most of Canopy Light: Shade Avoidance Under Afluctuating Spectrum and Irradiance.”</span> <em>Journal of Experimental Botany</em>.
</div>
<div id="ref-Stanhill2001" class="csl-entry" role="listitem">
Stanhill, Gerald, and Shabtai Cohen. 2001. <span>“Global Dimming: A Review of the Evidence for a Widespread and Significant Reduction in Global Radiation with Discussion of Its Probable Causes and Possible Agricultural Consequences.”</span> <em>Agricultural and Forest Meteorology</em> 107: 255–78. <a href="https://doi.org/10.1016/S0168-1923(00)00241-0">https://doi.org/10.1016/S0168-1923(00)00241-0</a>.
</div>
</div>
</section>
</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Available as ASCII file at PMODWRC, <a href="ftp://ftp.pmodwrc.ch/pub/publications/pmod615.asc" class="uri">ftp://ftp.pmodwrc.ch/pub/publications/pmod615.asc</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./optics.html" class="pagination-link" aria-label="Radiation-matter Interactions and Optics">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Radiation-matter Interactions and Optics</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./light-environment-plants.html" class="pagination-link" aria-label="The UV, VIS and NIR environment of plants">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">The UV, VIS and NIR environment of plants</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb1" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "The UV, VIS and NIR environment above vegetation"</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Quantity, quality and timing in nature"</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Pedro J. Aphalo</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">    orcid: 0000-0003-3385-972X</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">    email: pedro.aphalo@helsinki.fi</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation: University of Helsinki</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: T. Matthew Robson</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Maxime Durand</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: (Andreas Albert)</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: (Lars Olof Björn)</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: (Lasse Yliantilla)</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="an">contributor:</span><span class="co"> "Andreas Albert, Lars Olof Björn, Lasse Ylianttila"</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2024-06-17</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="an">date-modified:</span><span class="co"> 2024-07-17</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co">    embed-resources: false</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> source</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="an">abstract:</span><span class="co"> | </span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co">  This chapter discusses the light environment of terrestrial plants.</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="fu"># First edition authors</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>{{&lt; meta contributor &gt;}}</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include=FALSE, message=FALSE}</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(photobiology)</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(photobiologyWavebands)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(photobiologyInOut)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(photobiologySun)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggspectra)</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpp)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpmisc)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gganimate)</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdensity)</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quantreg)</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>            <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>                  <span class="at">plot.tag.position =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.95</span>),</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>                  <span class="at">plot.tag =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">10</span>))</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>::: {.hidden}</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>\newcommand{\Chem}<span class="co">[</span><span class="ot">1</span><span class="co">]</span>{{\mathrm{#1}}}</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>\newcommand{\Unit}<span class="co">[</span><span class="ot">1</span><span class="co">]</span>{{\mathrm{#1}}}</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>\newcommand{\mymu}{\mu}</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>\newcommand{\um}{\Unit{\mymu m}}</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>\newcommand{\ulitre}{\Unit{\mymu l}}</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>\newcommand{\ms}{\Unit{m\,s^{-1}}}</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>\newcommand{\umolflow}{\Unit{\mymu mol\,s^{-1}}}</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>\newcommand{\umol}{\Unit{\mymu mol\,m^{-2}\,s^{-1}}}</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>\newcommand{\molms}{\Unit{mol\,m^{-2}\,s^{-1}}}</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>\newcommand{\umolt}{\Unit{\frac{\mymu mol}{m^2\,s}}}</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>\newcommand{\umolnm}{\Unit{\mymu mol\,m^{-2}\,s^{-1}\,nm^{-1}}}</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>\newcommand{\mmol}{\Unit{mmol\,m^{-2}\,s^{-1}}}</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>\newcommand{\mmolt}{\Unit{\frac{mmol}{m^2\,s}}}</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>\newcommand{\mol}{\Unit{mol\,m^{-2}\,s^{-1}}}</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>\newcommand{\ppm}{\Unit{\mymu mol\,mol^{-1}}}</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>\newcommand{\ppmt}{\Unit{\frac{\mymu mol}{mol}}}</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>\newcommand{\mmolmol}{\Unit{mmol\,mol^{-1}}}</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>\newcommand{\mmolmolt}{\Unit{\frac{mmol}{mol}}}</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>\newcommand{\molday}{\Unit{mol\,m^{-2}\,d^{-1}}}</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>\newcommand{\kjday}{\Unit{kJ\,m^{-2}\,d^{-1}}}</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>\newcommand{\kjhour}{\Unit{kJ\,m^{-2}\,h^{-1}}}</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>\newcommand{\kjdaynm}{\Unit{kJ\,m^{-2}\,d^{-1}\,nm^{-1}}}</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>\newcommand{\kjmole}{\Unit{kJ\,mol^{-1}}}</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>\newcommand{\jsecond}{\Unit{J\,s}}</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>\newcommand{\msecond}{\Unit{m\,s^{-1}}}</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>\newcommand{\Js}{\Unit{J\,s}}</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>\newcommand{\watt}{\Unit{W\,m^{-2}}}</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>\newcommand{\wattcm}{\Unit{W\,cm^{-2}}}</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>\newcommand{\wattt}{\Unit{\frac{W}{m^2}}}</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>\newcommand{\wattsr}{\Unit{W\,sr^{-1}\,m^{-2}}}</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>\newcommand{\wattnm}{\Unit{W\,m^{-2}\,nm^{-1}}}</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>\newcommand{\mwattnm}{\Unit{mW\,cm^{-2}\,nm^{-1}}}</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>\newcommand{\mwattmnm}{\Unit{mW\,m^{-2}\,nm^{-1}}}</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>\newcommand{\wattcmnm}{\Unit{W\,cm^{-2}\,nm^{-1}}}</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>\newcommand{\gmcubic}{\Unit{g\,m^{-3}}}</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>\newcommand{\irr}<span class="co">[</span><span class="ot">1</span><span class="co">][]</span>{{E_{\mathrm{#1}}}}</span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>\newcommand{\sirr}<span class="co">[</span><span class="ot">1</span><span class="co">][]</span>{{E_{\mathrm{#1}}(\lambda)}}</span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>\newcommand{\pfd}<span class="co">[</span><span class="ot">1</span><span class="co">][]</span>{{Q_{\mathrm{#1}}}}</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>\newcommand{\spfd}<span class="co">[</span><span class="ot">1</span><span class="co">][]</span>{{Q_{\mathrm{#1}}(\lambda)}}</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>\newcommand{\quantum}<span class="co">[</span><span class="ot">1</span><span class="co">][]</span>{{q^{\mathrm{#1}}}}</span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>\newcommand{\molequanta}{\quantum<span class="co">[</span><span class="ot">\prime</span><span class="co">]</span>}</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>\newcommand{\flrat}{\irr<span class="co">[</span><span class="ot">0</span><span class="co">]</span>} % fluence rate</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>\newcommand{\PAR}{{\mathrm{PAR}}}</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>\newcommand{\PPFD}{{\mathrm{PPFD}}}</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>\newcommand{\RAF}{{\mathrm{RAF}}}</span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>\newcommand{\eeff}<span class="co">[</span><span class="ot">1</span><span class="co">][]</span>{{s_{\mathrm{#1}}}}</span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>\newcommand{\seeff}<span class="co">[</span><span class="ot">1</span><span class="co">][]</span>{{s_{\mathrm{#1}}(\lambda)}}</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>\newcommand{\qeff}<span class="co">[</span><span class="ot">1</span><span class="co">][]</span>{{s_{\mathrm{#1}}^\mathrm{p}}}</span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>\newcommand{\sqeff}<span class="co">[</span><span class="ot">1</span><span class="co">][]</span>{{s_{\mathrm{#1}}^\mathrm{p}(\lambda)}}</span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>\newcommand{\intensity}<span class="co">[</span><span class="ot">1</span><span class="co">][]</span>{{I_{\mathrm{#1}}}}</span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>\newcommand{\radiance}<span class="co">[</span><span class="ot">1</span><span class="co">][]</span>{{L_{\mathrm{#1}}}}</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>\newcommand{\exposure}<span class="co">[</span><span class="ot">1</span><span class="co">][]</span>{{H_{\mathrm{#1}}}}</span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>\newcommand{\dose}<span class="co">[</span><span class="ot">1</span><span class="co">][]</span>{{H^{\mathrm{#1}}}}</span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>\newcommand{\sdose}<span class="co">[</span><span class="ot">1</span><span class="co">][]</span>{{H^{\mathrm{#1}}(\lambda)}}</span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>\newcommand{\qdose}<span class="co">[</span><span class="ot">1</span><span class="co">][]</span>{{H^{\mathrm{#1}}_\mathrm{p}}}</span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>\newcommand{\sqdose}<span class="co">[</span><span class="ot">1</span><span class="co">][]</span>{{H^{\mathrm{#1}}_\mathrm{p}(\lambda}}</span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>\newcommand{\rad}<span class="co">[</span><span class="ot">1</span><span class="co">][]</span>{{L_{\mathrm{#1}}}}</span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>\newcommand{\trans}<span class="co">[</span><span class="ot">1</span><span class="co">][]</span>{{\tau_{\mathrm{#1}}}}</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>\newcommand{\strans}<span class="co">[</span><span class="ot">1</span><span class="co">][]</span>{{\tau_{\mathrm{#1}}(\lambda)}}</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>\newcommand{\absb}<span class="co">[</span><span class="ot">1</span><span class="co">][]</span>{{A_{\mathrm{#1}}}}</span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>\newcommand{\abst}<span class="co">[</span><span class="ot">1</span><span class="co">][]</span>{{\alpha_{\mathrm{#1}}}}</span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>\newcommand{\sabst}<span class="co">[</span><span class="ot">1</span><span class="co">][]</span>{{\alpha_{\mathrm{#1}}(\lambda)}}</span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>\newcommand{\refl}<span class="co">[</span><span class="ot">1</span><span class="co">][]</span>{{\rho_{\mathrm{#1}}}}</span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>\newcommand{\srefl}<span class="co">[</span><span class="ot">1</span><span class="co">][]</span>{{\rho_{\mathrm{#1}}(\lambda)}}</span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>\newcommand{\emitt}<span class="co">[</span><span class="ot">1</span><span class="co">][]</span>{{\epsilon_{\mathrm{#1}}}}</span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>\newcommand{\SZA}{{\theta}}</span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>\newcommand{\TOthree}{{\omega}}</span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>\newcommand{\degree}{{\mathrm{^{\circ}}}}</span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>\newcommand{\voltage}<span class="co">[</span><span class="ot">1</span><span class="co">][]</span>{{U_{\mathrm{#1}}}}</span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>\newcommand{\temperature}<span class="co">[</span><span class="ot">1</span><span class="co">][]</span>{{T_{\mathrm{#1}}}}</span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>\newcommand{\Coscor}{{\varphi}}</span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a><span class="fu">## Solar radiation at ground level {#sec:solar:radiation}</span></span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a><span class="fu">### Position of the sun</span></span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>When studying plants we frequently need to describe the position of the sun because of its effect on spectral irradiance and as a determinant of day length. The azimuth angle ($\phi$) is usually measured clockwise from the North on a horizontal plane. The position on the vertical plane is measured either as the zenith angle ($\theta$) downwards from the zenith, or as an elevation angle ($h$) upwards from the horizon. Consequently $h + \theta = 90^\circ = \frac{\pi}{2}\,$radians. When describing the position of the sun as in @fig-solar-position the observer is situated at the origin of the system of coordinates used to describe the angles.</span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a><span class="al">![Diagram showing the angles used to describe the position of the sun in the sky, viewed from the East. h: sun elevation angle, θ: zenith angle, Φ: azimuth angle.](figures/solar-position.png)</span>{#fig-solar-position width=67%}</span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>The daily path of the sun in the sky depends on the time of the year and the latitude. The time of solar noon depends on the actual geographic location, and nearly always differs from the local-time noon which is based on a time zone and possibly affected by a shift of one or more hours to enhance daylight use, especially in summer time.</span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>Highly accurate astronomical formulas are available and can be used to compute the current, past and future positions of the sun in the sky <span class="co">[</span><span class="ot">e.g., @Meeus1998</span><span class="co">]</span>. Less accurate, but simpler to compute, formulas also exist. These formulas can also be use to compute day- and night lengths based on different twilight definitions.</span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>The accuracy of astronomical formulas is less when the sun is near the horizon because, as seen in the previous chapter, the transition from vacuum to the atmosphere introduces a small angular displacement of the light beam depending on the refractive index and angle of incidence. The difficulty is that the refractive index ($\nu$) of the air depends on its water content, which is not constant.</span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>The path of the sun in the sky determines the lengths of the day and night. The most frequently used criterion for the day to night and night to days transitions is that the upper rim of the solar disk coincides with the astronomical horizon. As the solar disk is approximately 2 degrees in diameter, the transition between day and night is in this case when the centre of the solar disk is one degree below the horizon. Alternatively, the centre of the solar disk can be used coinciding with the astronomical horizon can be used as the criterion.</span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>!<span class="co">[</span><span class="ot">Position of the sun at sunrise, sunset, dawn and dusk. Figure by TWCarlson available at [Wikimedia Commons](https://commons.wikimedia.org/wiki/File:Twilight_description_full_day.svg) under CC-BY-SA 3.0.</span><span class="co">](images/twilight-full-day.png)</span>{#fig-twilight-full-day width=67%}</span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>Twilight is the period before sunrise and after sunset when there is more intense diffuse light than further into the night (@fig-twilight-full-day). The definitions of twilight are based on practical considerations of human activities, and called *civil*, *naval* and *astronomical* (@fig-twilight-angles). During civil twilight artificial lighting is usually not needed in cities. For nautical twilight I have seen two descriptions: 1) before nautical dawn and after nautical dawn it is possible to navigate based on the stars, and 2) after nautical dawn and before nautical dusk navigation by sight is possible. Before astronomical dawn and after astronomical dusk stars of sixth magnitude are visible. These three descriptions are very approximate, as they do not consider the effect of clouds, light pollution from artificial sources, or other source of light.</span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>!<span class="co">[</span><span class="ot">Criteria defining twilight based on the position of the sun. The angles when expressed as sun elevation ($h$) are negative. Only dawn and sunrise shown. The same angles are used between sunset and dusk. Figure by TWCarlson available at [Wikimedia Commons](https://commons.wikimedia.org/wiki/File:Twilight_description_full_day.svg) under CC-BY-SA 3.0., edited</span><span class="co">](images/twilight-dawn-angles.png)</span>{#fig-twilight-angles width=67%}</span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>The day length through the year computed for three cities, one of them, Ivalo at the northern latitude within the Artic circle.</span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-day-length</span></span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Day length through the year at different latitudes.</span></span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>days <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">ymd</span>(<span class="st">"2024-01-01"</span>), <span class="at">to =</span> <span class="fu">ymd</span>(<span class="st">"2024-12-31"</span>), <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>cities <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Ivalo, Finland"</span>, <span class="st">"Helsinki, Finland"</span>, <span class="st">"Athens, Greece"</span>)</span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>geocodes <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">lon =</span> <span class="fu">c</span>(<span class="fl">27.53971</span>, <span class="fl">24.93838</span>, <span class="fl">23.72754</span>),</span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>                       <span class="at">lat =</span> <span class="fu">c</span>(<span class="fl">68.65764</span>, <span class="fl">60.16986</span>, <span class="fl">37.98381</span>),</span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>                       <span class="at">address =</span> cities)</span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span></span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">day_night</span>(<span class="at">date =</span> days,</span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>            <span class="at">geocode =</span> geocodes,</span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>            <span class="at">tz =</span> <span class="st">"EET"</span>,</span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>            <span class="at">unit.out =</span> <span class="st">"hour"</span>)</span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(times,</span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> day, <span class="at">y =</span> daylength, <span class="at">linetype=</span>address)) <span class="sc">+</span></span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="st">"Day length (h)"</span>,</span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">12</span>,<span class="dv">24</span>), <span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">24</span>)) <span class="sc">+</span></span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_datetime</span>(<span class="at">name =</span> <span class="st">"Date (yyyy-mm-dd)"</span>,</span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a>                   <span class="at">date_labels =</span> <span class="st">"%Y-%m-%d"</span>) <span class="sc">+</span></span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype</span>(<span class="at">name =</span> <span class="st">"Location"</span>) <span class="sc">+</span></span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a>If we include twilight, the estimated length of the photoperiod increases (@fig-daylength-twilight).</span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-daylength-twilight</span></span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Photoperiod duration computed for sunrise/sunset or for dawn/dusk according to different twilight definitions. The curve describes the elevation angle of the sun through the day at Helsinki, Finalnd, on the 21 March 2024. The horizontal lines show the elevation angles used as the boundary of the "photoperiod" and the numbers above each of these lines give the corresponding length of the photoperiod in hours.</span></span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a>geocode_He <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">lon =</span> <span class="fl">24.93838</span>, <span class="at">lat =</span> <span class="fl">60.16986</span>)</span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a>hours <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">ymd_hm</span>(<span class="st">"2024-03-21 00:00"</span>, <span class="at">tz =</span> <span class="st">"EET"</span>),</span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="st">"1 min"</span>,</span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a>             <span class="at">length.out =</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">60</span>)</span>
<span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a>angles_He <span class="ot">&lt;-</span> <span class="fu">sun_angles</span>(hours,</span>
<span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a>                        <span class="at">geocode =</span> geocode_He)</span>
<span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a>twilight.tb <span class="ot">&lt;-</span></span>
<span id="cb1-198"><a href="#cb1-198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">angle =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">6</span>, <span class="sc">-</span><span class="dv">12</span>, <span class="sc">-</span><span class="dv">18</span>),</span>
<span id="cb1-199"><a href="#cb1-199" aria-hidden="true" tabindex="-1"></a>             <span class="at">location =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"Horizon"</span>, <span class="st">"Civil"</span>,</span>
<span id="cb1-200"><a href="#cb1-200" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"Nautical"</span>,</span>
<span id="cb1-201"><a href="#cb1-201" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"Astronomical"</span>), </span>
<span id="cb1-202"><a href="#cb1-202" aria-hidden="true" tabindex="-1"></a>                       <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Horizon"</span>, <span class="st">"Civil"</span>,</span>
<span id="cb1-203"><a href="#cb1-203" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"Nautical"</span>,</span>
<span id="cb1-204"><a href="#cb1-204" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"Astronomical"</span>)),</span>
<span id="cb1-205"><a href="#cb1-205" aria-hidden="true" tabindex="-1"></a>             <span class="at">time =</span> <span class="fu">min</span>(hours))</span>
<span id="cb1-206"><a href="#cb1-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-207"><a href="#cb1-207" aria-hidden="true" tabindex="-1"></a>get_middle_rows <span class="ot">&lt;-</span> </span>
<span id="cb1-208"><a href="#cb1-208" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) {</span>
<span id="cb1-209"><a href="#cb1-209" aria-hidden="true" tabindex="-1"></a>    z <span class="ot">&lt;-</span> x[<span class="fu">nrow</span>(x) <span class="sc">%/%</span> <span class="dv">2</span> <span class="sc">+</span> <span class="sc">-</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, ]</span>
<span id="cb1-210"><a href="#cb1-210" aria-hidden="true" tabindex="-1"></a>    z<span class="sc">$</span>twilight <span class="ot">&lt;-</span> twilight.tb<span class="sc">$</span>angle</span>
<span id="cb1-211"><a href="#cb1-211" aria-hidden="true" tabindex="-1"></a>    daylength <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">nrow</span>(z))</span>
<span id="cb1-212"><a href="#cb1-212" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(z)) {</span>
<span id="cb1-213"><a href="#cb1-213" aria-hidden="true" tabindex="-1"></a>      daylength[i] <span class="ot">&lt;-</span> <span class="fu">day_length</span>(<span class="at">date =</span> z[i, ]<span class="sc">$</span>time, </span>
<span id="cb1-214"><a href="#cb1-214" aria-hidden="true" tabindex="-1"></a>                               <span class="at">geocode =</span> geocode_He,</span>
<span id="cb1-215"><a href="#cb1-215" aria-hidden="true" tabindex="-1"></a>                               <span class="at">twilight =</span> z[i, ]<span class="sc">$</span>twilight)</span>
<span id="cb1-216"><a href="#cb1-216" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-217"><a href="#cb1-217" aria-hidden="true" tabindex="-1"></a>    z<span class="sc">$</span>daylength <span class="ot">&lt;-</span> <span class="fu">round</span>(daylength, <span class="at">digits =</span> <span class="dv">1</span>L)</span>
<span id="cb1-218"><a href="#cb1-218" aria-hidden="true" tabindex="-1"></a>    z</span>
<span id="cb1-219"><a href="#cb1-219" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-220"><a href="#cb1-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-221"><a href="#cb1-221" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(angles_He,</span>
<span id="cb1-222"><a href="#cb1-222" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> elevation)) <span class="sc">+</span></span>
<span id="cb1-223"><a href="#cb1-223" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1-224"><a href="#cb1-224" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">data =</span> twilight.tb,</span>
<span id="cb1-225"><a href="#cb1-225" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">yintercept =</span> angle, <span class="at">linetype =</span> location),</span>
<span id="cb1-226"><a href="#cb1-226" aria-hidden="true" tabindex="-1"></a>             <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb1-227"><a href="#cb1-227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> get_middle_rows,</span>
<span id="cb1-228"><a href="#cb1-228" aria-hidden="true" tabindex="-1"></a>            <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste</span>(daylength, <span class="st">"h"</span>),</span>
<span id="cb1-229"><a href="#cb1-229" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> twilight <span class="sc">+</span> <span class="dv">2</span>, <span class="at">x =</span> time)) <span class="sc">+</span></span>
<span id="cb1-230"><a href="#cb1-230" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_datetime</span>(<span class="at">date_labels =</span> <span class="st">"%H:%M"</span>, <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="fl">0.02</span>, <span class="fl">0.02</span>)) <span class="sc">+</span></span>
<span id="cb1-231"><a href="#cb1-231" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Sun elevation angle at Helsinki (degrees)"</span>,</span>
<span id="cb1-232"><a href="#cb1-232" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Time UTC + 2 (hh:mm)"</span>, <span class="at">linetype =</span> <span class="st">"Dawn/dusk"</span>) <span class="sc">+</span></span>
<span id="cb1-233"><a href="#cb1-233" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb1-234"><a href="#cb1-234" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-235"><a href="#cb1-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-236"><a href="#cb1-236" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb1-237"><a href="#cb1-237" aria-hidden="true" tabindex="-1"></a>Even though day length or photoperiod duration is normally based on the astronomical horizon, in many cases there are obstacles that occlude the sun from view until later at dawn or earlier at dusk: mountains, vegetation, buildings, etc. Thus, in some cases it may be more relevant for a scientific study with plants to consider sun elevation angles $h &gt; 0$ as the criterion; even different angles can be used for day start and day end.</span>
<span id="cb1-238"><a href="#cb1-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-239"><a href="#cb1-239" aria-hidden="true" tabindex="-1"></a>The question remains of what light level is actually detected by plants and other organisms as the night-day and day-night transitions. Most likely the exact value depends on the genotype and the realized phenotype. However, at dawn and dusk irradiance increases and decreases, respectively, qquite fast at low and medium latitudes. At high latitudes, at some times the year twilight lasts for a long time making the change in irradiance more gradual. At civil dawn/dusk irradiance is already very low.</span>
<span id="cb1-240"><a href="#cb1-240" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb1-241"><a href="#cb1-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-242"><a href="#cb1-242" aria-hidden="true" tabindex="-1"></a>The dependency of the elevation angle on time of the year and latitude is illustrated in @fig-sun-elevation-world.</span>
<span id="cb1-243"><a href="#cb1-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-244"><a href="#cb1-244" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb1-245"><a href="#cb1-245" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-sun-elevation-world</span></span>
<span id="cb1-246"><a href="#cb1-246" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Sun elevation angle through the day at five different latitudes and four dates. The horizontal dotted lines show the horizon ($h = 0$). The range limits for the _x_ and _y_ axes are consistent  across all plots. </span></span>
<span id="cb1-247"><a href="#cb1-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-248"><a href="#cb1-248" aria-hidden="true" tabindex="-1"></a>make_sun_elevation_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(date, geocode) {</span>
<span id="cb1-249"><a href="#cb1-249" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 97 points in time from midnight to midnight</span></span>
<span id="cb1-250"><a href="#cb1-250" aria-hidden="true" tabindex="-1"></a>  t <span class="ot">&lt;-</span> <span class="fu">rep</span>(date, <span class="dv">24</span> <span class="sc">*</span> <span class="dv">4</span> <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1-251"><a href="#cb1-251" aria-hidden="true" tabindex="-1"></a>         <span class="fu">hours</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">23</span>, <span class="at">each =</span> <span class="dv">4</span>), <span class="dv">24</span>)) <span class="sc">+</span></span>
<span id="cb1-252"><a href="#cb1-252" aria-hidden="true" tabindex="-1"></a>         <span class="fu">minutes</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">15</span>, <span class="dv">30</span>, <span class="dv">45</span>), <span class="at">times =</span> <span class="dv">24</span>), <span class="dv">0</span>))</span>
<span id="cb1-253"><a href="#cb1-253" aria-hidden="true" tabindex="-1"></a>  e <span class="ot">&lt;-</span> <span class="fu">sun_elevation</span>(<span class="at">time =</span> t, <span class="at">geocode =</span> geocode)</span>
<span id="cb1-254"><a href="#cb1-254" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(t, e), <span class="fu">aes</span>(t, e)) <span class="sc">+</span></span>
<span id="cb1-255"><a href="#cb1-255" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb1-256"><a href="#cb1-256" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1-257"><a href="#cb1-257" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">90</span>, <span class="dv">90</span>)) <span class="sc">+</span></span>
<span id="cb1-258"><a href="#cb1-258" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_datetime</span>(<span class="at">date_labels =</span> <span class="st">"%H:%m"</span>, <span class="at">expand =</span> <span class="fu">expansion</span>()) <span class="sc">+</span></span>
<span id="cb1-259"><a href="#cb1-259" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>()) <span class="sc">+</span></span>
<span id="cb1-260"><a href="#cb1-260" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb1-261"><a href="#cb1-261" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"grey95"</span>,</span>
<span id="cb1-262"><a href="#cb1-262" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb1-263"><a href="#cb1-263" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.border =</span> <span class="fu">element_blank</span>())</span>
<span id="cb1-264"><a href="#cb1-264" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-265"><a href="#cb1-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-266"><a href="#cb1-266" aria-hidden="true" tabindex="-1"></a>dates <span class="ot">&lt;-</span> <span class="fu">ymd</span>(<span class="fu">c</span>(<span class="st">"2020-02-20"</span>, <span class="st">"2020-03-21"</span>, <span class="st">"2020-6-21"</span>,</span>
<span id="cb1-267"><a href="#cb1-267" aria-hidden="true" tabindex="-1"></a>               <span class="st">"2020-09-21"</span>, <span class="st">"2020-12-21"</span>, <span class="st">"2021-01-22"</span>))</span>
<span id="cb1-268"><a href="#cb1-268" aria-hidden="true" tabindex="-1"></a>date.ticks <span class="ot">&lt;-</span> dates[<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb1-269"><a href="#cb1-269" aria-hidden="true" tabindex="-1"></a>date.ends <span class="ot">&lt;-</span> dates[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">6</span>)]</span>
<span id="cb1-270"><a href="#cb1-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-271"><a href="#cb1-271" aria-hidden="true" tabindex="-1"></a>geocodes <span class="ot">&lt;-</span></span>
<span id="cb1-272"><a href="#cb1-272" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">lon =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb1-273"><a href="#cb1-273" aria-hidden="true" tabindex="-1"></a>         <span class="at">lat =</span> <span class="fu">c</span>(<span class="fl">66.5634</span>, <span class="fl">23.4394</span>, <span class="dv">0</span>, <span class="sc">-</span><span class="fl">23.4394</span>, <span class="sc">-</span><span class="fl">66.5634</span>),</span>
<span id="cb1-274"><a href="#cb1-274" aria-hidden="true" tabindex="-1"></a>         <span class="at">address =</span> <span class="fu">c</span>(<span class="st">"Northern</span><span class="sc">\n</span><span class="st">Polar</span><span class="sc">\n</span><span class="st">Circle"</span>, <span class="st">"Tropic of</span><span class="sc">\n</span><span class="st">Cancer"</span>, <span class="st">"Equator"</span>,</span>
<span id="cb1-275"><a href="#cb1-275" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Tropic of</span><span class="sc">\n</span><span class="st">Capricorn"</span>, <span class="st">"Southern</span><span class="sc">\n</span><span class="st">Polar</span><span class="sc">\n</span><span class="st">Circle"</span>))</span>
<span id="cb1-276"><a href="#cb1-276" aria-hidden="true" tabindex="-1"></a>sun_elevation.tb <span class="ot">&lt;-</span></span>
<span id="cb1-277"><a href="#cb1-277" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">when =</span> <span class="fu">rep</span>(dates, <span class="fu">nrow</span>(geocodes)),</span>
<span id="cb1-278"><a href="#cb1-278" aria-hidden="true" tabindex="-1"></a>         <span class="at">where =</span> <span class="fu">rep</span>(geocodes<span class="sc">$</span>address, <span class="at">each =</span> <span class="fu">length</span>(dates)),</span>
<span id="cb1-279"><a href="#cb1-279" aria-hidden="true" tabindex="-1"></a>         <span class="at">plots =</span> <span class="fu">c</span>(<span class="fu">lapply</span>(dates, make_sun_elevation_plot, <span class="at">geocode =</span> geocodes[<span class="dv">1</span>, ]),</span>
<span id="cb1-280"><a href="#cb1-280" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">lapply</span>(dates, make_sun_elevation_plot, <span class="at">geocode =</span> geocodes[<span class="dv">2</span>, ]),</span>
<span id="cb1-281"><a href="#cb1-281" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">lapply</span>(dates, make_sun_elevation_plot, <span class="at">geocode =</span> geocodes[<span class="dv">3</span>, ]),</span>
<span id="cb1-282"><a href="#cb1-282" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">lapply</span>(dates, make_sun_elevation_plot, <span class="at">geocode =</span> geocodes[<span class="dv">4</span>, ]),</span>
<span id="cb1-283"><a href="#cb1-283" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">lapply</span>(dates, make_sun_elevation_plot, <span class="at">geocode =</span> geocodes[<span class="dv">5</span>, ])))</span>
<span id="cb1-284"><a href="#cb1-284" aria-hidden="true" tabindex="-1"></a>sun_elevation.tb<span class="sc">$</span>where <span class="ot">&lt;-</span></span>
<span id="cb1-285"><a href="#cb1-285" aria-hidden="true" tabindex="-1"></a>  <span class="fu">factor</span>(sun_elevation.tb<span class="sc">$</span>where, <span class="at">levels =</span> <span class="fu">rev</span>(geocodes<span class="sc">$</span>address))</span>
<span id="cb1-286"><a href="#cb1-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-287"><a href="#cb1-287" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sun_elevation.tb, <span class="fu">aes</span>(<span class="at">x =</span> when, <span class="at">y =</span> where, <span class="at">label =</span> plots)) <span class="sc">+</span></span>
<span id="cb1-288"><a href="#cb1-288" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_plot</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">day</span>(when) <span class="sc">==</span> <span class="dv">21</span>),</span>
<span id="cb1-289"><a href="#cb1-289" aria-hidden="true" tabindex="-1"></a>            <span class="at">inherit.aes =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-290"><a href="#cb1-290" aria-hidden="true" tabindex="-1"></a>            <span class="at">vp.width =</span> <span class="fl">0.18</span>, <span class="at">vp.height =</span> <span class="fl">0.15</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb1-291"><a href="#cb1-291" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">name =</span> <span class="st">""</span>, <span class="at">breaks =</span> date.ticks,</span>
<span id="cb1-292"><a href="#cb1-292" aria-hidden="true" tabindex="-1"></a>               <span class="at">limits =</span> date.ends,</span>
<span id="cb1-293"><a href="#cb1-293" aria-hidden="true" tabindex="-1"></a>               <span class="at">date_labels =</span> <span class="st">"%d %b"</span>) <span class="sc">+</span></span>
<span id="cb1-294"><a href="#cb1-294" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">name =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb1-295"><a href="#cb1-295" aria-hidden="true" tabindex="-1"></a>  <span class="co"># labs(title = "Solar elevation through the day",</span></span>
<span id="cb1-296"><a href="#cb1-296" aria-hidden="true" tabindex="-1"></a>  <span class="co">#      subtitle = "The dotted line indicates the horizon (h = 0)",</span></span>
<span id="cb1-297"><a href="#cb1-297" aria-hidden="true" tabindex="-1"></a>  <span class="co">#      caption = "Inset plots are drawn using consistent x and y scale limits.") +</span></span>
<span id="cb1-298"><a href="#cb1-298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb1-299"><a href="#cb1-299" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1-300"><a href="#cb1-300" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>())</span>
<span id="cb1-301"><a href="#cb1-301" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-302"><a href="#cb1-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-303"><a href="#cb1-303" aria-hidden="true" tabindex="-1"></a>Three images from fig 3.6 in Graedel and Crutzen, 1993. Scanned. Have to be redrawn.</span>
<span id="cb1-304"><a href="#cb1-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-305"><a href="#cb1-305" aria-hidden="true" tabindex="-1"></a><span class="al">![Equinox](images/Earth-equinox.png)</span>{width=30%}</span>
<span id="cb1-306"><a href="#cb1-306" aria-hidden="true" tabindex="-1"></a><span class="al">![N hemisphere summer](images/Earth-N-summer.png)</span>{width=30%}</span>
<span id="cb1-307"><a href="#cb1-307" aria-hidden="true" tabindex="-1"></a><span class="al">![S hemisphere summer](images/Earth-S-summer.png)</span>{width=30%}</span>
<span id="cb1-308"><a href="#cb1-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-309"><a href="#cb1-309" aria-hidden="true" tabindex="-1"></a>***Add links to previous chapter***</span>
<span id="cb1-310"><a href="#cb1-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-311"><a href="#cb1-311" aria-hidden="true" tabindex="-1"></a><span class="fu">### Solar radiation at the top of the atmosphere</span></span>
<span id="cb1-312"><a href="#cb1-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-313"><a href="#cb1-313" aria-hidden="true" tabindex="-1"></a>We can measure irradiance outside the atmosphere at a know distance from the sun and we can also measure the apparent diameter of the sun at this same distance. Based on this we can calculate the total radiant energy emitted by the sun and irradiance at arbitrary distances. </span>
<span id="cb1-314"><a href="#cb1-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-315"><a href="#cb1-315" aria-hidden="true" tabindex="-1"></a>In outer space, in vacuum, no scattering takes place as the light travels, and because of this, the sky looks completely black. Planets and the Moon do reflect light allowing us to see them. As the distance to the sun increases irradiance decreases as the flux spreads into a large area represented by the surface of a sphere, without scattering, this becomes a geometric computations in 3D.</span>
<span id="cb1-316"><a href="#cb1-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-317"><a href="#cb1-317" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb1-318"><a href="#cb1-318" aria-hidden="true" tabindex="-1"></a><span class="fu"># Geometric calculation</span></span>
<span id="cb1-319"><a href="#cb1-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-320"><a href="#cb1-320" aria-hidden="true" tabindex="-1"></a>The spectral irradiance of the sun $\irr<span class="co">[</span><span class="ot">s</span><span class="co">](\lambda)</span>$ can be estimated assuming a homogeneous flux and using the correlation of intensity and radiance from their definitions in table <span class="co">[</span><span class="ot">\[tab:Phys:Quants\]</span><span class="co">](#tab:Phys:Quants)</span>{reference-type="ref" reference="tab<span class="sc">:Phys:</span>Quants"}. The intensity of the sun $\intensity<span class="co">[</span><span class="ot">s</span><span class="co">](\lambda)</span>$ is given by the radiance $\radiance<span class="co">[</span><span class="ot">s</span><span class="co">](\lambda)</span>$ multiplied by the apparent sun surface (a non-tilted disk of radius $r_s=7\times 10^5$ km). To calculate the decreased solar irradiance at the top of the Earth's atmosphere, the distance of the sun to the Earth ($r_0=150\times 10^6$ km) has to be taken into account applying the inverse square law of irradiance of equation (<span class="co">[</span><span class="ot">\[equ_r2law\]</span><span class="co">](#equ_r2law)</span>{reference-type="ref" reference="equ_r2law"}). Thus, the extraterrestrial solar irradiance is </span>
<span id="cb1-321"><a href="#cb1-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-322"><a href="#cb1-322" aria-hidden="true" tabindex="-1"></a>$$\irr<span class="co">[</span><span class="ot">s</span><span class="co">](\lambda)</span>=\radiance<span class="co">[</span><span class="ot">s</span><span class="co">](\lambda)</span>\cdot\frac{\pi r_s^2}{r_0^2}$$ </span>
<span id="cb1-323"><a href="#cb1-323" aria-hidden="true" tabindex="-1"></a>Remembering the solid angle of equation (<span class="co">[</span><span class="ot">\[equ_solidangle\]</span><span class="co">](#equ_solidangle)</span>{reference-type="ref" reference="equ_solidangle"}), the right multiplication factor represents the solid angle of the sun's disk as seen from the Earth's surface ($\approx 6.8\times 10^{-5}$ sr). </span>
<span id="cb1-324"><a href="#cb1-324" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb1-325"><a href="#cb1-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-326"><a href="#cb1-326" aria-hidden="true" tabindex="-1"></a>At the time scales relevant to plants and humans, the distance between the Sun and the Earth varies little, as well as the emission from the surface of the sun. Thus, we can use a "solar constant" as a useful and nearly perfect approximation. The solar "constant", the irradiance at the top of the atmosphere, varies between $1\,361$ and $1\,362~\mathrm{W m^{-2}}$ due to changes in solar activity. In addition to the irradiance, the shape of the solar spectrum at the top of the atmosphere varies very little in time, and is usually assumed constant.</span>
<span id="cb1-327"><a href="#cb1-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-328"><a href="#cb1-328" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb1-329"><a href="#cb1-329" aria-hidden="true" tabindex="-1"></a>Radiation from the sun reaches the Earth's surface in about eight minutes ($t$ = time, $r_0$ = distance sun to earth, $c$ = velocity of light in vacuum): $$t = \frac{r_0}{c} \approx \frac{150 \times 10^9 ~{\rm m}}{3 \times 10^8 ~\frac{\rm m}{\rm s}} = 500 ~{\rm s} = 8.3 ~{\rm min}$$.</span>
<span id="cb1-330"><a href="#cb1-330" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb1-331"><a href="#cb1-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-332"><a href="#cb1-332" aria-hidden="true" tabindex="-1"></a>The energy radiance ($L$) of radiation emitted by the sun is similar in shape, but not identical, to the emission spectrum of a *black body*. The solar spectrum has a fine structure of peaks and valleys arising from the atoms and molecules in the sun while black body emission is described by a smooth curve. A "match" based on the wavelength at which spectral _energy_ radiance is at its maximum can be used as criterion to estimate the temperature of the sun's surface. Obviously, we use the extraterrestrial spectrum for this match. We see in the AM0 curve in @fig-sun-spectra-energy that the wavelength at the maximum is near 500 nm. In reality the temperature of the sun surface is not uniform, and different sources mention as its average temperatures between 5800 K and 5500 K. Comparing the AM0 curve in @fig-sun-spectra-energy to the 5800 K curve in @fig-blackbody-emission the similary of their shapes is clear.</span>
<span id="cb1-333"><a href="#cb1-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-334"><a href="#cb1-334" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb1-335"><a href="#cb1-335" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-blackbody-emission</span></span>
<span id="cb1-336"><a href="#cb1-336" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Radiance spectra for black bodies at three different temperatures; 5800 K (blue), 5000 K (orange) and 3700 K (red).</span></span>
<span id="cb1-337"><a href="#cb1-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-338"><a href="#cb1-338" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fl">6.626e-34</span> <span class="co"># J s-1</span></span>
<span id="cb1-339"><a href="#cb1-339" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="fl">2.998e8</span> <span class="co"># m s-1</span></span>
<span id="cb1-340"><a href="#cb1-340" aria-hidden="true" tabindex="-1"></a>kB <span class="ot">&lt;-</span> <span class="fl">1.381e-23</span> <span class="co"># J K-1</span></span>
<span id="cb1-341"><a href="#cb1-341" aria-hidden="true" tabindex="-1"></a>black_body_spectrum <span class="ot">&lt;-</span> <span class="cf">function</span>(w.length, Tabs) {</span>
<span id="cb1-342"><a href="#cb1-342" aria-hidden="true" tabindex="-1"></a>  w.length <span class="ot">&lt;-</span> w.length <span class="sc">*</span> <span class="fl">1e-9</span> <span class="co"># nm -&gt; m</span></span>
<span id="cb1-343"><a href="#cb1-343" aria-hidden="true" tabindex="-1"></a>  ((<span class="dv">2</span> <span class="sc">*</span> h <span class="sc">*</span> c<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> w.length<span class="sc">^</span><span class="dv">5</span>) <span class="sc">*</span></span>
<span id="cb1-344"><a href="#cb1-344" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span> <span class="sc">/</span> (<span class="fu">exp</span>((h <span class="sc">*</span> c <span class="sc">/</span> (kB <span class="sc">*</span> Tabs <span class="sc">*</span> w.length))) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb1-345"><a href="#cb1-345" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-346"><a href="#cb1-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-347"><a href="#cb1-347" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span><span class="fu">data.frame</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">50</span>,<span class="dv">3000</span>)), <span class="fu">aes</span>(x)) <span class="sc">+</span></span>
<span id="cb1-348"><a href="#cb1-348" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun=</span>black_body_spectrum,</span>
<span id="cb1-349"><a href="#cb1-349" aria-hidden="true" tabindex="-1"></a>                <span class="at">args =</span> <span class="fu">list</span>(<span class="at">Tabs=</span><span class="dv">5800</span>),</span>
<span id="cb1-350"><a href="#cb1-350" aria-hidden="true" tabindex="-1"></a>                <span class="at">colour=</span><span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb1-351"><a href="#cb1-351" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun=</span>black_body_spectrum,</span>
<span id="cb1-352"><a href="#cb1-352" aria-hidden="true" tabindex="-1"></a>                <span class="at">args =</span> <span class="fu">list</span>(<span class="at">Tabs=</span><span class="dv">5000</span>),</span>
<span id="cb1-353"><a href="#cb1-353" aria-hidden="true" tabindex="-1"></a>                <span class="at">colour=</span><span class="st">"orange"</span>) <span class="sc">+</span></span>
<span id="cb1-354"><a href="#cb1-354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun=</span>black_body_spectrum,</span>
<span id="cb1-355"><a href="#cb1-355" aria-hidden="true" tabindex="-1"></a>                <span class="at">args =</span> <span class="fu">list</span>(<span class="at">Tabs=</span><span class="dv">3700</span>),</span>
<span id="cb1-356"><a href="#cb1-356" aria-hidden="true" tabindex="-1"></a>                <span class="at">colour=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb1-357"><a href="#cb1-357" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="fu">expression</span>(Spectral<span class="sc">~</span><span class="er">~</span>radiance<span class="sc">~</span><span class="er">~</span>(W<span class="sc">~</span>sr<span class="sc">^-</span><span class="dv">1</span><span class="sc">~</span>m<span class="sc">^-</span><span class="dv">3</span>)),</span>
<span id="cb1-358"><a href="#cb1-358" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span><span class="st">"Wavelength (nm)"</span>) <span class="sc">+</span></span>
<span id="cb1-359"><a href="#cb1-359" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb1-360"><a href="#cb1-360" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-361"><a href="#cb1-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-362"><a href="#cb1-362" aria-hidden="true" tabindex="-1"></a>Planck's law describes black body emission at temperature $T$ (@fig-blackbody-emission), expressed as absolute temperature measured in degrees Kelvin (K):</span>
<span id="cb1-363"><a href="#cb1-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-364"><a href="#cb1-364" aria-hidden="true" tabindex="-1"></a>$$L_s(\lambda,T) = \frac{2hc^2}{\lambda^5}\cdot\frac{1}{\mathrm{e}^{(hc/k_\mathrm{B}T\lambda)}-1}$$</span>
<span id="cb1-365"><a href="#cb1-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-366"><a href="#cb1-366" aria-hidden="true" tabindex="-1"></a>with Boltzmann's constant $k_\mathrm{B}=1.381\times 10^{-23}$ .</span>
<span id="cb1-367"><a href="#cb1-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-368"><a href="#cb1-368" aria-hidden="true" tabindex="-1"></a>The "equivalent temperature" of a black body is given by Wien's displacement law (@fig-wein-wl), which gives the wavelength at which the radiative energy emitted by a black body is at its maximum as a function of its absolute temperature. </span>
<span id="cb1-369"><a href="#cb1-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-370"><a href="#cb1-370" aria-hidden="true" tabindex="-1"></a>$$\lambda_\mathrm{max} \cdot T = 2.898 \times 10^6 \,{\rm nm\,K}$$ </span>
<span id="cb1-371"><a href="#cb1-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-372"><a href="#cb1-372" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb1-373"><a href="#cb1-373" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-wein-wl</span></span>
<span id="cb1-374"><a href="#cb1-374" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: The peak wavelength of radiation emission by a black body as a function of its absolute (surface) temperature. The approximate temperature of the sun $T_\mathrm{sun} \approx 5800\,\mathrm{K}$ is highlighted by a yellow-filled circle.</span></span>
<span id="cb1-375"><a href="#cb1-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-376"><a href="#cb1-376" aria-hidden="true" tabindex="-1"></a>k.wein <span class="ot">&lt;-</span> <span class="fl">2.8977721e6</span> <span class="co"># nm K</span></span>
<span id="cb1-377"><a href="#cb1-377" aria-hidden="true" tabindex="-1"></a>black_body_peak_wl <span class="ot">&lt;-</span> <span class="cf">function</span>(Tabs) {</span>
<span id="cb1-378"><a href="#cb1-378" aria-hidden="true" tabindex="-1"></a>  k.wein <span class="sc">/</span> Tabs</span>
<span id="cb1-379"><a href="#cb1-379" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-380"><a href="#cb1-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-381"><a href="#cb1-381" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span><span class="fu">data.frame</span>(<span class="at">Tabs =</span> <span class="fu">c</span>(<span class="dv">2000</span>,<span class="dv">7000</span>)), <span class="fu">aes</span>(<span class="at">x =</span> Tabs)) <span class="sc">+</span></span>
<span id="cb1-382"><a href="#cb1-382" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> black_body_peak_wl) <span class="sc">+</span></span>
<span id="cb1-383"><a href="#cb1-383" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Temperature (K)"</span>,</span>
<span id="cb1-384"><a href="#cb1-384" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Wavelength at peak of emission (nm)"</span>) <span class="sc">+</span></span>
<span id="cb1-385"><a href="#cb1-385" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"point"</span>,</span>
<span id="cb1-386"><a href="#cb1-386" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">5800</span>, <span class="at">y =</span> <span class="fu">black_body_peak_wl</span>(<span class="dv">5800</span>),</span>
<span id="cb1-387"><a href="#cb1-387" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">"yellow"</span>, <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb1-388"><a href="#cb1-388" aria-hidden="true" tabindex="-1"></a>           <span class="at">shape =</span> <span class="st">"circle filled"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1-389"><a href="#cb1-389" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb1-390"><a href="#cb1-390" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-391"><a href="#cb1-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-392"><a href="#cb1-392" aria-hidden="true" tabindex="-1"></a>::: callout-caution</span>
<span id="cb1-393"><a href="#cb1-393" aria-hidden="true" tabindex="-1"></a>The concept of "colour temperature" used for describing the emission of lamps used for illumination and more generaly in photography differs in that it takes into account human colour vision when determining the match between the black body emission spectrum and the spectrum of an arbitrary light source. The coordinated colour temperature (CCT) for the AM1.5 solar spectrum is <span class="in">`r round(photobiologyInOut::spct_CCT(photobiologySun::sun_reference.mspct$ASTM.G173.global))`</span> K and for the AM0 spectrum is <span class="in">`r round(photobiologyInOut::spct_CCT(photobiologySun::sun_reference.mspct$WMO.Wehrli.AM0))`</span> K. </span>
<span id="cb1-394"><a href="#cb1-394" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb1-395"><a href="#cb1-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-396"><a href="#cb1-396" aria-hidden="true" tabindex="-1"></a>The spectral irradiance of the sun $\irr<span class="co">[</span><span class="ot">s</span><span class="co">](\lambda)</span>$ can be estimated assuming a homogeneous flux and using the correlation of intensity and radiance from their definitions in table <span class="co">[</span><span class="ot">\[tab:Phys:Quants\]</span><span class="co">](#tab:Phys:Quants)</span>{reference-type="ref" reference="tab<span class="sc">:Phys:</span>Quants"}. The intensity of the sun $\intensity<span class="co">[</span><span class="ot">s</span><span class="co">](\lambda)</span>$ is given by the radiance $\radiance<span class="co">[</span><span class="ot">s</span><span class="co">](\lambda)</span>$ multiplied by the apparent sun surface (a non-tilted disk of radius $r_s=7\times 10^5$ km). To calculate the decreased solar irradiance at the moment of reaching the Earth's atmosphere, the distance of the sun to the Earth ($r_0=150\times 10^6$ km) has to be taken into account due to the inverse square law of irradiance of equation (<span class="co">[</span><span class="ot">\[equ_r2law\]</span><span class="co">](#equ_r2law)</span>{reference-type="ref" reference="equ_r2law"}). Thus, the extraterrestrial solar irradiance is </span>
<span id="cb1-397"><a href="#cb1-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-398"><a href="#cb1-398" aria-hidden="true" tabindex="-1"></a>$$\irr<span class="co">[</span><span class="ot">s</span><span class="co">](\lambda)</span>=\radiance<span class="co">[</span><span class="ot">s</span><span class="co">](\lambda)</span>\cdot\frac{\pi r_s^2}{r_0^2}\label{equ_extraterrestrial}$$</span>
<span id="cb1-399"><a href="#cb1-399" aria-hidden="true" tabindex="-1"></a>Remembering the solid angle of equation (<span class="co">[</span><span class="ot">\[equ_solidangle\]</span><span class="co">](#equ_solidangle)</span>{reference-type="ref" reference="equ_solidangle"}), the right multiplication factor represents the solid angle of the sun's disk as seen from the Earth's surface ($\approx 6.8\times 10^{-5}$ sr). Figure <span class="co">[</span><span class="ot">\[fig_sun\]</span><span class="co">](#fig_sun)</span>{reference-type="ref" reference="fig_sun"} shows the spectrum of the measured extraterrestrial solar radiation (Wehrli, 1985)<span class="ot">[^1]</span> and the spectrum calculated by equation 1.14 using Planck's law of equation 1.12 at a black body temperature of 5800 K. Integrated over all wavelengths, $\irr<span class="co">[</span><span class="ot">s</span><span class="co">]</span>$ is about 1361 to 1362 at top of the atmosphere <span class="co">[</span><span class="ot">@Kopp2011</span><span class="co">]</span>. This value is called the 'solar constant'. In former times, depending on different measurements, $\irr<span class="co">[</span><span class="ot">s</span><span class="co">]</span>$ varies by a few percent <span class="co">[</span><span class="ot">@iqbal83</span><span class="co">]</span>. For example, the irradiance at the top of the atmosphere (the integrated value) changes by $\pm 50$ (3.7 %) during the year due to distance variation caused by orbit excentricity <span class="co">[</span><span class="ot">@moble94</span><span class="co">]</span>. More accurate measurements during the last 25 years by spaceborne radiometers show a variability of the solar radiation of a few tenth of a percent. A detailed analysis is given by @froeh04. $\irr<span class="co">[</span><span class="ot">s</span><span class="co">]</span>$ can also be calculated by the Stefan-Boltzmann Law: the total energy emitted from the surface of a black body is proportional to the fourth power of its temperature. For an isotropically emitting source (Lambertian emitter), this means $$\radiance = \frac{\sigma}{\pi} \cdot T^4 \label{equ_boltzmann}$$ with the Stefan-Boltzmann constant $\sigma=5.6705\times 10^{-8}$ W m$^{-2}$ K$^{-4}$. With $T = 5800$ K equation <span class="co">[</span><span class="ot">\[equ_boltzmann\]</span><span class="co">](#equ_boltzmann)</span>{reference-type="ref" reference="equ_boltzmann"} gives the radiance of the solar disc. From this value, we can obtain an approximation of the solar constant, by taking into account the distance from the Earth to the Sun and the apparent size of the solar disc (see equations <span class="co">[</span><span class="ot">\[equ_solidangle\]</span><span class="co">](#equ_solidangle)</span>{reference-type="ref" reference="equ_solidangle"} and <span class="co">[</span><span class="ot">\[equ_r2law\]</span><span class="co">](#equ_r2law)</span>{reference-type="ref" reference="equ_r2law"}).</span>
<span id="cb1-400"><a href="#cb1-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-401"><a href="#cb1-401" aria-hidden="true" tabindex="-1"></a><span class="ot">[^1]: </span>Available as ASCII file at PMODWRC, <span class="ot">&lt;ftp://ftp.pmodwrc.ch/pub/publications/pmod615.asc&gt;</span></span>
<span id="cb1-402"><a href="#cb1-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-403"><a href="#cb1-403" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb1-404"><a href="#cb1-404" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-sun-black-body</span></span>
<span id="cb1-405"><a href="#cb1-405" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: The extraterrestrial solar spectrum compared to black body emission. The black body emission spectrum has been scaled to match the energy irradiance of the solar spectrum at the top of the atmosphere (AM0) within the range of wavelengths shown. </span></span>
<span id="cb1-406"><a href="#cb1-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-407"><a href="#cb1-407" aria-hidden="true" tabindex="-1"></a><span class="fu">energy_as_default</span>()</span>
<span id="cb1-408"><a href="#cb1-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-409"><a href="#cb1-409" aria-hidden="true" tabindex="-1"></a>w.lengths <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">200</span>, <span class="dv">3000</span>, <span class="at">length.out =</span> <span class="dv">201</span>)</span>
<span id="cb1-410"><a href="#cb1-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-411"><a href="#cb1-411" aria-hidden="true" tabindex="-1"></a>sun.spct <span class="ot">&lt;-</span> </span>
<span id="cb1-412"><a href="#cb1-412" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clip_wl</span>(</span>
<span id="cb1-413"><a href="#cb1-413" aria-hidden="true" tabindex="-1"></a>    sun_reference.mspct[[<span class="st">"WMO.Wehrli.AM0"</span>]],</span>
<span id="cb1-414"><a href="#cb1-414" aria-hidden="true" tabindex="-1"></a>    <span class="at">range =</span> <span class="fu">range</span>(w.lengths))</span>
<span id="cb1-415"><a href="#cb1-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-416"><a href="#cb1-416" aria-hidden="true" tabindex="-1"></a>black_body.spct <span class="ot">&lt;-</span></span>
<span id="cb1-417"><a href="#cb1-417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">source_spct</span>(<span class="at">w.length =</span> w.lengths,</span>
<span id="cb1-418"><a href="#cb1-418" aria-hidden="true" tabindex="-1"></a>              <span class="at">s.e.irrad =</span> <span class="fu">black_body_spectrum</span>(w.lengths, <span class="dv">5800</span>))</span>
<span id="cb1-419"><a href="#cb1-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-420"><a href="#cb1-420" aria-hidden="true" tabindex="-1"></a>black_body.spct <span class="ot">&lt;-</span> </span>
<span id="cb1-421"><a href="#cb1-421" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fscale</span>(black_body.spct, </span>
<span id="cb1-422"><a href="#cb1-422" aria-hidden="true" tabindex="-1"></a>         <span class="at">f =</span> e_irrad,</span>
<span id="cb1-423"><a href="#cb1-423" aria-hidden="true" tabindex="-1"></a>         <span class="at">target =</span> <span class="fu">e_irrad</span>(sun.spct))</span>
<span id="cb1-424"><a href="#cb1-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-425"><a href="#cb1-425" aria-hidden="true" tabindex="-1"></a>plot.spectra <span class="ot">&lt;-</span> </span>
<span id="cb1-426"><a href="#cb1-426" aria-hidden="true" tabindex="-1"></a>  <span class="fu">source_mspct</span>(</span>
<span id="cb1-427"><a href="#cb1-427" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">AM0 =</span> sun.spct,</span>
<span id="cb1-428"><a href="#cb1-428" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Black body at 5800K"</span> <span class="ot">=</span> black_body.spct)</span>
<span id="cb1-429"><a href="#cb1-429" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-430"><a href="#cb1-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-431"><a href="#cb1-431" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot.spectra, <span class="at">unit.out =</span> <span class="st">"energy"</span>) <span class="sc">+</span> </span>
<span id="cb1-432"><a href="#cb1-432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">color =</span> spct.idx) <span class="sc">+</span></span>
<span id="cb1-433"><a href="#cb1-433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1-434"><a href="#cb1-434" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name=</span> <span class="st">""</span>,</span>
<span id="cb1-435"><a href="#cb1-435" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values=</span><span class="fu">c</span>(<span class="st">"purple"</span>,<span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb1-436"><a href="#cb1-436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_wl_continuous</span>() <span class="sc">+</span> </span>
<span id="cb1-437"><a href="#cb1-437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_s.e.irrad_continuous</span>(<span class="at">expand=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))  <span class="sc">+</span></span>
<span id="cb1-438"><a href="#cb1-438" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb1-439"><a href="#cb1-439" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span> <span class="st">"top"</span>)</span>
<span id="cb1-440"><a href="#cb1-440" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-441"><a href="#cb1-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-442"><a href="#cb1-442" aria-hidden="true" tabindex="-1"></a>The total solar irradiance covers a wide range of wavelengths. Using some of the 'colours' introduced in table <span class="co">[</span><span class="ot">\[tab:Waverange\]</span><span class="co">](#tab:Waverange)</span>{reference-type="ref" reference="tab:Waverange"}, table <span class="co">[</span><span class="ot">\[tab_sun\]</span><span class="co">](#tab_sun)</span>{reference-type="ref" reference="tab_sun"} lists the irradiance and fraction of $\irr<span class="co">[</span><span class="ot">s</span><span class="co">]</span>$ of different wavelength intervals.</span>
<span id="cb1-443"><a href="#cb1-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-444"><a href="#cb1-444" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include=FALSE}</span></span>
<span id="cb1-445"><a href="#cb1-445" aria-hidden="true" tabindex="-1"></a>AM0_e_irrads <span class="ot">&lt;-</span></span>
<span id="cb1-446"><a href="#cb1-446" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="fu">e_irrad</span>(sun.spct, <span class="at">w.band =</span> <span class="fu">c</span>(<span class="fu">UV_bands</span>(<span class="st">"CIE"</span>), <span class="fu">list</span>(<span class="fu">PhR</span>()), <span class="fu">IR_bands</span>(<span class="st">"CIE"</span>))), <span class="dv">2</span>)</span>
<span id="cb1-447"><a href="#cb1-447" aria-hidden="true" tabindex="-1"></a>AM0_e_irrad_tot <span class="ot">&lt;-</span> <span class="fu">sum</span>(AM0_e_irrads)</span>
<span id="cb1-448"><a href="#cb1-448" aria-hidden="true" tabindex="-1"></a>AM0_e_irrads</span>
<span id="cb1-449"><a href="#cb1-449" aria-hidden="true" tabindex="-1"></a>AM0_e_irrad_tot</span>
<span id="cb1-450"><a href="#cb1-450" aria-hidden="true" tabindex="-1"></a><span class="fu">signif</span>(AM0_e_irrads <span class="sc">/</span> AM0_e_irrad_tot <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">3</span>)</span>
<span id="cb1-451"><a href="#cb1-451" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-452"><a href="#cb1-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-453"><a href="#cb1-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-454"><a href="#cb1-454" aria-hidden="true" tabindex="-1"></a>::: table*</span>
<span id="cb1-455"><a href="#cb1-455" aria-hidden="true" tabindex="-1"></a>::: center</span>
<span id="cb1-456"><a href="#cb1-456" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Waveband       <span class="pp">|</span> Wavelength $\lambda$ (nm) <span class="pp">|</span> Irradiance $\irr$  ($W m^{-2}$) <span class="pp">|</span> Irradiance $\irr$ (%) <span class="pp">|</span></span>
<span id="cb1-457"><a href="#cb1-457" aria-hidden="true" tabindex="-1"></a><span class="pp">|:--------------:|:---------------:|:-------------:|:-------------------------:|</span></span>
<span id="cb1-458"><a href="#cb1-458" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> UV-C           <span class="pp">|</span>   100 -- 280    <span class="pp">|</span>       7       <span class="pp">|</span>            0.5            <span class="pp">|</span></span>
<span id="cb1-459"><a href="#cb1-459" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> UV-B           <span class="pp">|</span>   280 -- 315    <span class="pp">|</span>      17       <span class="pp">|</span>            1.3            <span class="pp">|</span></span>
<span id="cb1-460"><a href="#cb1-460" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> UV-A2          <span class="pp">|</span>   315 -- 340    <span class="pp">|</span>      21       <span class="pp">|</span>            1.6            <span class="pp">|</span></span>
<span id="cb1-461"><a href="#cb1-461" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> UV-A1          <span class="pp">|</span>   340 -- 400    <span class="pp">|</span>      63       <span class="pp">|</span>            4.7            <span class="pp">|</span></span>
<span id="cb1-462"><a href="#cb1-462" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> PhR            <span class="pp">|</span>   400 -- 700    <span class="pp">|</span>      531      <span class="pp">|</span>           39.6            <span class="pp">|</span></span>
<span id="cb1-463"><a href="#cb1-463" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> IR-A (CIE)     <span class="pp">|</span>  700 -- 1400    <span class="pp">|</span>      517      <span class="pp">|</span>           38.6            <span class="pp">|</span></span>
<span id="cb1-464"><a href="#cb1-464" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> IR-B (CIE)     <span class="pp">|</span>  1400 -- 3000   <span class="pp">|</span>      184      <span class="pp">|</span>           13.7            <span class="pp">|</span></span>
<span id="cb1-465"><a href="#cb1-465" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **TOTAL**      |                 |  **1339**     |        **100.0**          <span class="pp">|</span></span>
<span id="cb1-466"><a href="#cb1-466" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb1-467"><a href="#cb1-467" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb1-468"><a href="#cb1-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-469"><a href="#cb1-469" aria-hidden="true" tabindex="-1"></a><span class="fu">### Solar radiation at ground level</span></span>
<span id="cb1-470"><a href="#cb1-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-471"><a href="#cb1-471" aria-hidden="true" tabindex="-1"></a>Above, we used the word *light* with its everyday meaning. Its technical definition is of radiation visible to humans. Ultraviolet, visible and infrared radiation (taken together are called in meteorolgy *shortwave radiation*) are components of solar radiation.</span>
<span id="cb1-472"><a href="#cb1-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-473"><a href="#cb1-473" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Spectrum under clear sky</span></span>
<span id="cb1-474"><a href="#cb1-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-475"><a href="#cb1-475" aria-hidden="true" tabindex="-1"></a>**We could include a plot of scalar spectral irradiance (easy to generate with TUV) or of hemispherical spectral irradiance measured with a hemispherical diffuser (I have data). A comparison to spectral irradiance on a horizontal plane could be very informative.**</span>
<span id="cb1-476"><a href="#cb1-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-477"><a href="#cb1-477" aria-hidden="true" tabindex="-1"></a>Before reaching the Earth's surface radiation from the sun travels through the atmosphere. The sun elevation angle affects the length of the path that the light arriving from the sun travels through the atmosphere. In atmospheric physics it is common to describe spectra as corresponding to *AM0* for above the atmosphere, *AM1* when the sun is at the zenith, i.e., one atmosphere thickness and *AM1.5* when the length of the air mass traversed is 1.5 times that when the sun is at the zenith.</span>
<span id="cb1-478"><a href="#cb1-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-479"><a href="#cb1-479" aria-hidden="true" tabindex="-1"></a>The air mass traversed is, in reality, not exactly proportional to the distance computed by trigonometry, but not far from it. An empirical formula <span class="co">[</span><span class="ot">@Kasten1989</span><span class="co">]</span> can be used as a better approximation to the computation of AM values from the elevation angle ($h$) (@fig-AM-h).  </span>
<span id="cb1-480"><a href="#cb1-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-481"><a href="#cb1-481" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb1-482"><a href="#cb1-482" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-AM-h</span></span>
<span id="cb1-483"><a href="#cb1-483" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Plot of the empirical relationship between sun elevation ($h$) or zenith anglr ($\theta$) and "equivalent" atmosphere thickness traversed by solar radiation between outer space and the Earth's surface (at sea level). AM1</span></span>
<span id="cb1-484"><a href="#cb1-484" aria-hidden="true" tabindex="-1"></a><span class="co">#|  is indicated by the horizontal dotted line.</span></span>
<span id="cb1-485"><a href="#cb1-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-486"><a href="#cb1-486" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">90</span></span>
<span id="cb1-487"><a href="#cb1-487" aria-hidden="true" tabindex="-1"></a>AMx <span class="ot">&lt;-</span> <span class="fu">relative_AM</span>(h)</span>
<span id="cb1-488"><a href="#cb1-488" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(h, AMx), <span class="fu">aes</span>(h, AMx)) <span class="sc">+</span></span>
<span id="cb1-489"><a href="#cb1-489" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb1-490"><a href="#cb1-490" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1-491"><a href="#cb1-491" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="fu">expression</span>(<span class="st">"Sun elevation angle, "</span><span class="sc">*</span><span class="fu">italic</span>(h)<span class="sc">*</span><span class="st">"(degrees)"</span>),</span>
<span id="cb1-492"><a href="#cb1-492" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">90</span>),</span>
<span id="cb1-493"><a href="#cb1-493" aria-hidden="true" tabindex="-1"></a>                     <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="at">transform =</span> <span class="cf">function</span>(x) {<span class="dv">90</span> <span class="sc">-</span> x},</span>
<span id="cb1-494"><a href="#cb1-494" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">breaks =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">90</span>)),</span>
<span id="cb1-495"><a href="#cb1-495" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">name =</span> <span class="fu">expression</span>(<span class="st">"Sun zenith angle,</span></span>
<span id="cb1-496"><a href="#cb1-496" aria-hidden="true" tabindex="-1"></a><span class="st">                                                           "</span><span class="sc">*</span><span class="fu">italic</span>(theta)<span class="sc">*</span><span class="st">"(degrees)"</span>))) <span class="sc">+</span></span>
<span id="cb1-497"><a href="#cb1-497" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="st">"AM"</span>) <span class="sc">+</span></span>
<span id="cb1-498"><a href="#cb1-498" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb1-499"><a href="#cb1-499" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-500"><a href="#cb1-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-501"><a href="#cb1-501" aria-hidden="true" tabindex="-1"></a>Light when travelling through the atmosphere interacts with the gases and particles composing it. The light is attenuated and scattered. Different wavelengths are differently affected by these processes, giving us a blue sky and warmer coloured direct sunlight. In other words, the daylight spectrum depends on the position of the sun in the sky, and on the composition of the atmosphere along this path (@fig-sun-spectra-energy and @fig-sun-spectra-photons). In addition to molecular absorption and scattering, aerosols, both liquid like water and solid like ice and dust, interact with light.</span>
<span id="cb1-502"><a href="#cb1-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-503"><a href="#cb1-503" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb1-504"><a href="#cb1-504" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-sun-spectra-energy</span></span>
<span id="cb1-505"><a href="#cb1-505" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: The spectrum of solar radiation above the atmosphere (AM0) and a typical spectrum at ground level (AM1.5). Spectral energy irradiance for the wavelength range called _shortwave radiation_ in meteorology.</span></span>
<span id="cb1-506"><a href="#cb1-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-507"><a href="#cb1-507" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">clip_wl</span>(sun_reference.mspct[<span class="fu">c</span>(<span class="st">"WMO.Wehrli.AM0"</span>,</span>
<span id="cb1-508"><a href="#cb1-508" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"ASTM.G173.global"</span>)],</span>
<span id="cb1-509"><a href="#cb1-509" aria-hidden="true" tabindex="-1"></a>               <span class="at">range=</span><span class="fu">c</span>(<span class="cn">NA</span>,<span class="dv">3000</span>)), <span class="at">unit.out =</span> <span class="st">"energy"</span>) <span class="sc">+</span> </span>
<span id="cb1-510"><a href="#cb1-510" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">color=</span> spct.idx) <span class="sc">+</span></span>
<span id="cb1-511"><a href="#cb1-511" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1-512"><a href="#cb1-512" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name=</span> <span class="st">""</span>,</span>
<span id="cb1-513"><a href="#cb1-513" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"AM0"</span>,<span class="st">"AM1.5"</span>),</span>
<span id="cb1-514"><a href="#cb1-514" aria-hidden="true" tabindex="-1"></a>                  <span class="at">values=</span><span class="fu">c</span>(<span class="st">"purple"</span>,<span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb1-515"><a href="#cb1-515" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_wl_continuous</span>() <span class="sc">+</span> </span>
<span id="cb1-516"><a href="#cb1-516" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_s.e.irrad_continuous</span>(<span class="at">expand=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))  <span class="sc">+</span></span>
<span id="cb1-517"><a href="#cb1-517" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom=</span> <span class="st">"text"</span>,</span>
<span id="cb1-518"><a href="#cb1-518" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span><span class="fu">c</span>(<span class="dv">245</span>, <span class="dv">750</span>,<span class="dv">950</span>,<span class="dv">1150</span>,<span class="dv">1450</span>,<span class="dv">1900</span>),</span>
<span id="cb1-519"><a href="#cb1-519" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span><span class="fu">c</span>(<span class="fl">0.4</span>, <span class="fl">0.08</span>,<span class="fl">0.08</span>,<span class="fl">0.7</span>,<span class="fl">0.43</span>,<span class="fl">0.27</span>),</span>
<span id="cb1-520"><a href="#cb1-520" aria-hidden="true" tabindex="-1"></a>           <span class="at">label=</span><span class="fu">c</span>(<span class="st">"O[3]"</span>,<span class="st">"O[2]"</span>,<span class="st">"H[2]*O"</span>,<span class="st">"H[2]*O"</span>,<span class="st">"H[2]*O"</span>,<span class="st">"H[2]*O~CO[2]"</span>),</span>
<span id="cb1-521"><a href="#cb1-521" aria-hidden="true" tabindex="-1"></a>           <span class="at">parse=</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb1-522"><a href="#cb1-522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb1-523"><a href="#cb1-523" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span> <span class="st">"top"</span>)</span>
<span id="cb1-524"><a href="#cb1-524" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-525"><a href="#cb1-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-526"><a href="#cb1-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-527"><a href="#cb1-527" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb1-528"><a href="#cb1-528" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-sun-spectra-photons</span></span>
<span id="cb1-529"><a href="#cb1-529" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: The spectrum of solar radiation above the atmosphere (AM0) and a typical spectrum at ground level (AM1.5). Spectral photon irradiance for the range 250 to 900 nm.</span></span>
<span id="cb1-530"><a href="#cb1-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-531"><a href="#cb1-531" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">clip_wl</span>(sun_reference.mspct[<span class="fu">c</span>(<span class="st">"WMO.Wehrli.AM0"</span>,</span>
<span id="cb1-532"><a href="#cb1-532" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"ASTM.G173.global"</span>)],</span>
<span id="cb1-533"><a href="#cb1-533" aria-hidden="true" tabindex="-1"></a>               <span class="at">range=</span><span class="fu">c</span>(<span class="dv">240</span>,<span class="dv">1000</span>)), <span class="at">unit.out =</span> <span class="st">"photon"</span>) <span class="sc">+</span> </span>
<span id="cb1-534"><a href="#cb1-534" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">color =</span> spct.idx) <span class="sc">+</span></span>
<span id="cb1-535"><a href="#cb1-535" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1-536"><a href="#cb1-536" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name=</span> <span class="st">""</span>,</span>
<span id="cb1-537"><a href="#cb1-537" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"AM0"</span>,<span class="st">"AM1.5"</span>),</span>
<span id="cb1-538"><a href="#cb1-538" aria-hidden="true" tabindex="-1"></a>                  <span class="at">values=</span><span class="fu">c</span>(<span class="st">"purple"</span>,<span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb1-539"><a href="#cb1-539" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_wl_continuous</span>() <span class="sc">+</span> </span>
<span id="cb1-540"><a href="#cb1-540" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_s.q.irrad_continuous</span>(<span class="at">expand=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))  <span class="sc">+</span></span>
<span id="cb1-541"><a href="#cb1-541" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb1-542"><a href="#cb1-542" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span> <span class="st">"top"</span>)</span>
<span id="cb1-543"><a href="#cb1-543" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-544"><a href="#cb1-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-545"><a href="#cb1-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-546"><a href="#cb1-546" aria-hidden="true" tabindex="-1"></a>The extraterrestrial solar spectrum differs from that at ground level due to the absorption of radiation by the atmosphere, because the absorption peaks of water, and other components of the atmosphere, cause corresponding valleys to appear in the solar spectrum at ground level. The solar spectrum has a much finer structure, due to emission and absorption lines of elements, this fine structure is not observable with the spectroradiometers normally used in plant research. For plant research, finr structure of peaks and valleys is considered irrelevant because plant pigments *in vivo* have broader peaks and valleys in their spectra.</span>
<span id="cb1-547"><a href="#cb1-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-548"><a href="#cb1-548" aria-hidden="true" tabindex="-1"></a>Not only total irradiance, but also the wavelength distribution and the diffuse fraction of the solar spectrum changes with the seasons of the year and time of day. This changes are in large part explained by the change in sun elevation. In what follows we describe these changes as a function of sun elevation. The increasing air mass traversed with decreasing sun elevation affects the shape of the spectrum, by stronger attenuation of the shorter wavelengths. An increased air mass also increases scattering in the atmosphere.</span>
<span id="cb1-549"><a href="#cb1-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-550"><a href="#cb1-550" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include=FALSE}</span></span>
<span id="cb1-551"><a href="#cb1-551" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare data for upcoming figures</span></span>
<span id="cb1-552"><a href="#cb1-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-553"><a href="#cb1-553" aria-hidden="true" tabindex="-1"></a>sun_elevation.mspct <span class="ot">&lt;-</span> <span class="fu">subset2mspct</span>(sun_elevation.spct, <span class="at">drop.idx =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-554"><a href="#cb1-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-555"><a href="#cb1-555" aria-hidden="true" tabindex="-1"></a><span class="co"># each spectrum contains three columns with spectral data that we separate</span></span>
<span id="cb1-556"><a href="#cb1-556" aria-hidden="true" tabindex="-1"></a>sun_elevation_tot.mspct <span class="ot">&lt;-</span> <span class="fu">source_mspct</span>()</span>
<span id="cb1-557"><a href="#cb1-557" aria-hidden="true" tabindex="-1"></a>sun_elevation_diff.mspct <span class="ot">&lt;-</span> <span class="fu">source_mspct</span>()</span>
<span id="cb1-558"><a href="#cb1-558" aria-hidden="true" tabindex="-1"></a>sun_elevation_dir.mspct <span class="ot">&lt;-</span> <span class="fu">source_mspct</span>()</span>
<span id="cb1-559"><a href="#cb1-559" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (n <span class="cf">in</span> <span class="fu">names</span>(sun_elevation.mspct)) {</span>
<span id="cb1-560"><a href="#cb1-560" aria-hidden="true" tabindex="-1"></a>  sun_elevation_tot.mspct[[n]] <span class="ot">&lt;-</span></span>
<span id="cb1-561"><a href="#cb1-561" aria-hidden="true" tabindex="-1"></a>    sun_elevation.mspct[[n]][ , <span class="fu">c</span>(<span class="st">"w.length"</span>, <span class="st">"s.e.irrad"</span>)]</span>
<span id="cb1-562"><a href="#cb1-562" aria-hidden="true" tabindex="-1"></a>  sun_elevation_diff.mspct[[n]] <span class="ot">&lt;-</span></span>
<span id="cb1-563"><a href="#cb1-563" aria-hidden="true" tabindex="-1"></a>    <span class="fu">with</span>(sun_elevation.mspct[[n]], </span>
<span id="cb1-564"><a href="#cb1-564" aria-hidden="true" tabindex="-1"></a>         <span class="fu">source_spct</span>(<span class="at">w.length =</span> w.length, </span>
<span id="cb1-565"><a href="#cb1-565" aria-hidden="true" tabindex="-1"></a>                     <span class="at">s.e.irrad =</span> s.e.irrad.diff.down))</span>
<span id="cb1-566"><a href="#cb1-566" aria-hidden="true" tabindex="-1"></a>  sun_elevation_dir.mspct[[n]] <span class="ot">&lt;-</span></span>
<span id="cb1-567"><a href="#cb1-567" aria-hidden="true" tabindex="-1"></a>    <span class="fu">with</span>(sun_elevation.mspct[[n]], </span>
<span id="cb1-568"><a href="#cb1-568" aria-hidden="true" tabindex="-1"></a>         <span class="fu">source_spct</span>(<span class="at">w.length =</span> w.length, </span>
<span id="cb1-569"><a href="#cb1-569" aria-hidden="true" tabindex="-1"></a>                     <span class="at">s.e.irrad =</span> s.e.irrad.dir))</span>
<span id="cb1-570"><a href="#cb1-570" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-571"><a href="#cb1-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-572"><a href="#cb1-572" aria-hidden="true" tabindex="-1"></a>wavebands <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">list</span>(<span class="at">PAR =</span> <span class="fu">PAR</span>()), <span class="fu">Plant_bands</span>(<span class="st">"sensory"</span>))</span>
<span id="cb1-573"><a href="#cb1-573" aria-hidden="true" tabindex="-1"></a>wbands_tot.tb <span class="ot">&lt;-</span> </span>
<span id="cb1-574"><a href="#cb1-574" aria-hidden="true" tabindex="-1"></a>  <span class="fu">q_irrad</span>(sun_elevation_tot.mspct, wavebands, <span class="at">scale.factor =</span> <span class="fl">1e6</span>)</span>
<span id="cb1-575"><a href="#cb1-575" aria-hidden="true" tabindex="-1"></a>wbands_dir.tb <span class="ot">&lt;-</span> </span>
<span id="cb1-576"><a href="#cb1-576" aria-hidden="true" tabindex="-1"></a>  <span class="fu">q_irrad</span>(sun_elevation_dir.mspct, wavebands, <span class="at">scale.factor =</span> <span class="fl">1e6</span>)</span>
<span id="cb1-577"><a href="#cb1-577" aria-hidden="true" tabindex="-1"></a>wbands_diff.tb <span class="ot">&lt;-</span> </span>
<span id="cb1-578"><a href="#cb1-578" aria-hidden="true" tabindex="-1"></a>  <span class="fu">q_irrad</span>(sun_elevation_diff.mspct, wavebands, <span class="at">scale.factor =</span> <span class="fl">1e6</span>)</span>
<span id="cb1-579"><a href="#cb1-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-580"><a href="#cb1-580" aria-hidden="true" tabindex="-1"></a>wbands.tb <span class="ot">&lt;-</span></span>
<span id="cb1-581"><a href="#cb1-581" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb1-582"><a href="#cb1-582" aria-hidden="true" tabindex="-1"></a>    <span class="at">SZA =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"tuv-"</span>, <span class="st">""</span>, wbands_tot.tb<span class="sc">$</span>spct.idx)),</span>
<span id="cb1-583"><a href="#cb1-583" aria-hidden="true" tabindex="-1"></a>    <span class="at">SEA =</span> <span class="dv">90</span> <span class="sc">-</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"tuv-"</span>, <span class="st">""</span>, wbands_tot.tb<span class="sc">$</span>spct.idx))</span>
<span id="cb1-584"><a href="#cb1-584" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-585"><a href="#cb1-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-586"><a href="#cb1-586" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (col <span class="cf">in</span> <span class="fu">setdiff</span>(<span class="fu">colnames</span>(wbands_tot.tb), <span class="st">"spct.idx"</span>)) {</span>
<span id="cb1-587"><a href="#cb1-587" aria-hidden="true" tabindex="-1"></a>  wbands.tb[[<span class="fu">paste</span>(col, <span class="st">"tot"</span>, <span class="at">sep =</span> <span class="st">"."</span>)]] <span class="ot">&lt;-</span> wbands_tot.tb[[col]]</span>
<span id="cb1-588"><a href="#cb1-588" aria-hidden="true" tabindex="-1"></a>  wbands.tb[[<span class="fu">paste</span>(col, <span class="st">"dir"</span>, <span class="at">sep =</span> <span class="st">"."</span>)]] <span class="ot">&lt;-</span> wbands_dir.tb[[col]]</span>
<span id="cb1-589"><a href="#cb1-589" aria-hidden="true" tabindex="-1"></a>  wbands.tb[[<span class="fu">paste</span>(col, <span class="st">"diff"</span>, <span class="at">sep =</span> <span class="st">"."</span>)]] <span class="ot">&lt;-</span> wbands_diff.tb[[col]]</span>
<span id="cb1-590"><a href="#cb1-590" aria-hidden="true" tabindex="-1"></a>  wbands.tb[[<span class="fu">paste</span>(col, <span class="st">"diff_fr"</span>, <span class="at">sep =</span> <span class="st">"."</span>)]] <span class="ot">&lt;-</span> </span>
<span id="cb1-591"><a href="#cb1-591" aria-hidden="true" tabindex="-1"></a>    wbands_diff.tb[[col]] <span class="sc">/</span> wbands_tot.tb[[col]]</span>
<span id="cb1-592"><a href="#cb1-592" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-593"><a href="#cb1-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-594"><a href="#cb1-594" aria-hidden="true" tabindex="-1"></a><span class="co"># shorten column names</span></span>
<span id="cb1-595"><a href="#cb1-595" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(wbands.tb) <span class="ot">&lt;-</span> </span>
<span id="cb1-596"><a href="#cb1-596" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gsub</span>(<span class="st">"Q_]|Q_|</span><span class="sc">\\</span><span class="st">.ISO|</span><span class="sc">\\</span><span class="st">.CIE|</span><span class="sc">\\</span><span class="st">.Sellaro|</span><span class="sc">\\</span><span class="st">.Smith20"</span>, <span class="st">""</span>, <span class="fu">colnames</span>(wbands.tb))</span>
<span id="cb1-597"><a href="#cb1-597" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-598"><a href="#cb1-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-599"><a href="#cb1-599" aria-hidden="true" tabindex="-1"></a>A figure of spectral irradiance is difficult to read as both the shape of the curve and the maximum spectral irradiance change in parallel <span class="co">[</span><span class="ot">@fig-spectra-sun-elevation</span><span class="co">]</span>.</span>
<span id="cb1-600"><a href="#cb1-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-601"><a href="#cb1-601" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb1-602"><a href="#cb1-602" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-spectra-sun-elevation</span></span>
<span id="cb1-603"><a href="#cb1-603" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Change in spectral irradiance with sun elevation angle. Based on simulations with the TUV model for an ozone column of 300 DU under clear sky.</span></span>
<span id="cb1-604"><a href="#cb1-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-605"><a href="#cb1-605" aria-hidden="true" tabindex="-1"></a>five_angles.mspct <span class="ot">&lt;-</span> sun_elevation.mspct[<span class="fu">c</span>(<span class="st">"tuv-00"</span>, <span class="st">"tuv-30"</span>, <span class="st">"tuv-45"</span>, <span class="st">"tuv-60"</span>, <span class="st">"tuv-75"</span>, <span class="st">"tuv-85"</span>)]</span>
<span id="cb1-606"><a href="#cb1-606" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(five_angles.mspct) <span class="ot">&lt;-</span> </span>
<span id="cb1-607"><a href="#cb1-607" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.character</span>(<span class="dv">90</span>L <span class="sc">-</span> <span class="fu">as.integer</span>(<span class="fu">gsub</span>(<span class="st">"^tuv-"</span>, <span class="st">""</span>, <span class="fu">names</span>(five_angles.mspct))))</span>
<span id="cb1-608"><a href="#cb1-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-609"><a href="#cb1-609" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(five_angles.mspct, </span>
<span id="cb1-610"><a href="#cb1-610" aria-hidden="true" tabindex="-1"></a>         <span class="at">unit.out =</span> <span class="st">"photon"</span>, </span>
<span id="cb1-611"><a href="#cb1-611" aria-hidden="true" tabindex="-1"></a>         <span class="at">annotations =</span> <span class="fu">c</span>(<span class="st">"-"</span>, <span class="st">"peaks"</span>),</span>
<span id="cb1-612"><a href="#cb1-612" aria-hidden="true" tabindex="-1"></a>         <span class="at">w.band =</span> <span class="fu">Plant_bands</span>(<span class="st">"CIE"</span>)) <span class="sc">+</span></span>
<span id="cb1-613"><a href="#cb1-613" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">linetype =</span> <span class="st">"Sun elevation</span><span class="sc">\n</span><span class="st">(degrees)"</span>)</span>
<span id="cb1-614"><a href="#cb1-614" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-615"><a href="#cb1-615" aria-hidden="true" tabindex="-1"></a>If we rescale the curves to equal PAR irradiance the change in shape is easier to observe <span class="co">[</span><span class="ot">@fig-uv-spectra-sun-elevation-scaled and @fig-nir-spectra-sun-elevation-scaled</span><span class="co">]</span>.</span>
<span id="cb1-616"><a href="#cb1-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-617"><a href="#cb1-617" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb1-618"><a href="#cb1-618" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-uv-spectra-sun-elevation-scaled</span></span>
<span id="cb1-619"><a href="#cb1-619" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Change in scaled spectral irradiance with sun elevation angle. UV region of the spectrum. Based on simulations with the TUV model for an ozone column of 300 DU under clear sky. Spectra scaled to PAR = $1\,000\,\mu mol\,s^{-1}\,m^{-2}$.</span></span>
<span id="cb1-620"><a href="#cb1-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-621"><a href="#cb1-621" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">fscale</span>(five_angles.mspct, <span class="at">f =</span> q_irrad, <span class="at">w.band =</span> <span class="fu">PAR</span>(), <span class="at">target =</span> <span class="fl">1e-3</span>),</span>
<span id="cb1-622"><a href="#cb1-622" aria-hidden="true" tabindex="-1"></a>         <span class="at">range =</span> <span class="fu">UV</span>(),</span>
<span id="cb1-623"><a href="#cb1-623" aria-hidden="true" tabindex="-1"></a>         <span class="at">unit.out =</span> <span class="st">"photon"</span>, </span>
<span id="cb1-624"><a href="#cb1-624" aria-hidden="true" tabindex="-1"></a>         <span class="at">annotations =</span> <span class="fu">c</span>(<span class="st">"-"</span>, <span class="st">"peaks"</span>),</span>
<span id="cb1-625"><a href="#cb1-625" aria-hidden="true" tabindex="-1"></a>         <span class="at">w.band =</span> <span class="fu">Plant_bands</span>(<span class="st">"CIE"</span>)) <span class="sc">+</span></span>
<span id="cb1-626"><a href="#cb1-626" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">linetype =</span> <span class="st">"Sun elevation</span><span class="sc">\n</span><span class="st">(degrees)"</span>)</span>
<span id="cb1-627"><a href="#cb1-627" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-628"><a href="#cb1-628" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb1-629"><a href="#cb1-629" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-nir-spectra-sun-elevation-scaled</span></span>
<span id="cb1-630"><a href="#cb1-630" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Change in scaled spectral irradiance with sun elevation angle. Red-FR region of the spectrum. Based on simulations with the TUV model for an ozone column of 300 DU under clear sky. Spectra scaled to PAR = $1\,000\,\mu mol\,s^{-1}\,m^{-2}$.</span></span>
<span id="cb1-631"><a href="#cb1-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-632"><a href="#cb1-632" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">fscale</span>(five_angles.mspct, <span class="at">f =</span> q_irrad, <span class="at">w.band =</span> <span class="fu">PAR</span>(), <span class="at">target =</span> <span class="fl">1e-3</span>),</span>
<span id="cb1-633"><a href="#cb1-633" aria-hidden="true" tabindex="-1"></a>         <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">600</span>,<span class="dv">700</span>),</span>
<span id="cb1-634"><a href="#cb1-634" aria-hidden="true" tabindex="-1"></a>         <span class="at">unit.out =</span> <span class="st">"photon"</span>, </span>
<span id="cb1-635"><a href="#cb1-635" aria-hidden="true" tabindex="-1"></a>         <span class="at">annotations =</span> <span class="fu">c</span>(<span class="st">"-"</span>, <span class="st">"peaks"</span>),</span>
<span id="cb1-636"><a href="#cb1-636" aria-hidden="true" tabindex="-1"></a>         <span class="at">w.band =</span> <span class="fu">Plant_bands</span>(<span class="st">"CIE"</span>)) <span class="sc">+</span></span>
<span id="cb1-637"><a href="#cb1-637" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">linetype =</span> <span class="st">"Sun elevation</span><span class="sc">\n</span><span class="st">(degrees)"</span>)</span>
<span id="cb1-638"><a href="#cb1-638" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-639"><a href="#cb1-639" aria-hidden="true" tabindex="-1"></a>Plotting the normalised photon irradiance for different wavebands <span class="co">[</span><span class="ot">@fig-wbands-elevation-normalized</span><span class="co">]</span> shows that the daily course of UV-B photon irradiance is different than that for other bands, even the adjacent UV-A2. UV-B irradiance decreases faster with decreasing sun elevation ($h$).</span>
<span id="cb1-640"><a href="#cb1-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-641"><a href="#cb1-641" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb1-642"><a href="#cb1-642" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-wbands-elevation-normalized</span></span>
<span id="cb1-643"><a href="#cb1-643" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Change in irradiance with sun elevation angle for different regions of the spectrum. PAR. orange, UVA-1. violet, UV-A2. purple, and UV-B. black. Based on simulations with the TUV model for an ozone column of 300 DU.</span></span>
<span id="cb1-644"><a href="#cb1-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-645"><a href="#cb1-645" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(wbands.tb, <span class="fu">aes</span>(<span class="at">x =</span> SEA)) <span class="sc">+</span></span>
<span id="cb1-646"><a href="#cb1-646" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> PAR.tot <span class="sc">/</span> <span class="fu">max</span>(PAR.tot)), <span class="at">colour =</span> <span class="st">"orange"</span>) <span class="sc">+</span></span>
<span id="cb1-647"><a href="#cb1-647" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> UVA1.tot <span class="sc">/</span> <span class="fu">max</span>(UVA1.tot)), <span class="at">colour =</span> <span class="st">"violet"</span>) <span class="sc">+</span></span>
<span id="cb1-648"><a href="#cb1-648" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> UVA2.tot <span class="sc">/</span> <span class="fu">max</span>(UVA2.tot)), <span class="at">colour =</span> <span class="st">"purple"</span>) <span class="sc">+</span></span>
<span id="cb1-649"><a href="#cb1-649" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> UVB.tot <span class="sc">/</span> <span class="fu">max</span>(UVB.tot)), <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb1-650"><a href="#cb1-650" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"Sun elevation angle (degrees)"</span>,</span>
<span id="cb1-651"><a href="#cb1-651" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">90</span>),</span>
<span id="cb1-652"><a href="#cb1-652" aria-hidden="true" tabindex="-1"></a>                     <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="at">name =</span> <span class="st">"Sun zenith angle (degrees)"</span>,</span>
<span id="cb1-653"><a href="#cb1-653" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">transform =</span> <span class="cf">function</span>(x) {<span class="dv">90</span> <span class="sc">-</span> x},</span>
<span id="cb1-654"><a href="#cb1-654" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">90</span>, <span class="dv">100</span>))) <span class="sc">+</span></span>
<span id="cb1-655"><a href="#cb1-655" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="fu">expression</span>(<span class="st">"Photon irradiance, "</span><span class="sc">*</span><span class="fu">italic</span>(Q)<span class="sc">~</span><span class="er">~</span>(<span class="st">"rel. units"</span>))) <span class="sc">+</span></span>
<span id="cb1-656"><a href="#cb1-656" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="dv">0</span>)</span>
<span id="cb1-657"><a href="#cb1-657" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-658"><a href="#cb1-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-659"><a href="#cb1-659" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Diffuse fraction under clear sky</span></span>
<span id="cb1-660"><a href="#cb1-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-661"><a href="#cb1-661" aria-hidden="true" tabindex="-1"></a>At the Earth's surface, the incident radiation or _global radiation_ has two distinct components, _direct radiation_ and _diffuse radiation_. Direct radiation is radiation travelling directly from the sun, while diffuse radiation is that scattered by the atmosphere. Diffuse radiation is what gives the blue colour to the sky and white colour to clouds. The relative contribution of direct and diffuse radiation to global radiation varies with wavelength and weather conditions. The contribution of diffuse radiation is more in the UV region, and in the presence of clouds (Figures <span class="co">[</span><span class="ot">\[fig:sky:photos\]</span><span class="co">](#fig:sky:photos)</span>{reference-type="ref" reference="fig<span class="sc">:sky:</span>photos"} and <span class="co">[</span><span class="ot">\[fig:diffuse:UV\]</span><span class="co">](#fig:diffuse:UV)</span>{reference-type="ref" reference="fig<span class="sc">:diffuse:</span>UV"}).</span>
<span id="cb1-662"><a href="#cb1-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-663"><a href="#cb1-663" aria-hidden="true" tabindex="-1"></a><span class="al">![image](photos/Lasse_sky_composite.jpg)</span></span>
<span id="cb1-664"><a href="#cb1-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-665"><a href="#cb1-665" aria-hidden="true" tabindex="-1"></a>Simultaneous spectral measurements of direct and diffuse solar radiation are infrequent. Radiation transfer models such as TUV estimate these components, as shown in @fig-spectra-diffuse-TUV-45. The diffuse fraction is larger at shorter wavelengths. Under overcast conditions or any other situation when the solar disk is fully occluded the diffuse fraction is equal to one. However, only in outer space the diffuse fraction approaches zero.</span>
<span id="cb1-666"><a href="#cb1-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-667"><a href="#cb1-667" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb1-668"><a href="#cb1-668" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-spectra-diffuse-TUV-45</span></span>
<span id="cb1-669"><a href="#cb1-669" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Spectral energy irradiance under a clear sky and sun elevation of 45 degrees. Simulation with the TUV radiation transfer and atmospheric chemistry model for an ozone column on 300 DU, assuming a low optical density of aerosols. The black line shown total spectral energy irradiance, the orange-filled area is the direct component and the blue-filled area is the diffuse or scattered component.</span></span>
<span id="cb1-670"><a href="#cb1-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-671"><a href="#cb1-671" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sun_elevation.mspct[[<span class="st">"tuv-45"</span>]]) <span class="sc">+</span></span>
<span id="cb1-672"><a href="#cb1-672" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spct</span>(<span class="at">fill =</span> <span class="st">"skyblue"</span>, <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb1-673"><a href="#cb1-673" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spct</span>(<span class="fu">aes</span>(<span class="at">y =</span> s.e.irrad.dir), <span class="at">fill =</span> <span class="st">"orange"</span>) <span class="sc">+</span></span>
<span id="cb1-674"><a href="#cb1-674" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_wl_continuous</span>() <span class="sc">+</span></span>
<span id="cb1-675"><a href="#cb1-675" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_s.e.irrad_continuous</span>()</span>
<span id="cb1-676"><a href="#cb1-676" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-677"><a href="#cb1-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-678"><a href="#cb1-678" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include=FALSE}</span></span>
<span id="cb1-679"><a href="#cb1-679" aria-hidden="true" tabindex="-1"></a><span class="co"># create spline functions</span></span>
<span id="cb1-680"><a href="#cb1-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-681"><a href="#cb1-681" aria-hidden="true" tabindex="-1"></a><span class="co"># We fit splines to the diffuse fraction obtaining functions </span></span>
<span id="cb1-682"><a href="#cb1-682" aria-hidden="true" tabindex="-1"></a><span class="co"># that can be used to obtain by interpolation estimates for </span></span>
<span id="cb1-683"><a href="#cb1-683" aria-hidden="true" tabindex="-1"></a><span class="co"># any sun elevation.</span></span>
<span id="cb1-684"><a href="#cb1-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-685"><a href="#cb1-685" aria-hidden="true" tabindex="-1"></a>spl_funs.ls <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb1-686"><a href="#cb1-686" aria-hidden="true" tabindex="-1"></a>diff_fr_cols <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"diff[_]fr"</span>, <span class="fu">colnames</span>(wbands.tb), <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-687"><a href="#cb1-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-688"><a href="#cb1-688" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (col <span class="cf">in</span> diff_fr_cols) {</span>
<span id="cb1-689"><a href="#cb1-689" aria-hidden="true" tabindex="-1"></a>  spl_funs.ls[[col]] <span class="ot">&lt;-</span> <span class="fu">splinefun</span>(wbands.tb[[<span class="st">"SEA"</span>]], wbands.tb[[col]])</span>
<span id="cb1-690"><a href="#cb1-690" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-691"><a href="#cb1-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-692"><a href="#cb1-692" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-693"><a href="#cb1-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-694"><a href="#cb1-694" aria-hidden="true" tabindex="-1"></a>In @fig-spectra-diffuse-TUV-45 the spectrum at a single sun elevation is shown. In @fig-diffuse-TUV the diffuse fraction from simulations under the same atmospheric conditions are shown as a function of sun elevation. The diffuse fraction is largest for shorter wavelengths and for each waveband it increases as the sun elevation decreases. This change is not linear, and has a similar shape as the change in air mass traversed <span class="co">[</span><span class="ot">@fig-AM-h</span><span class="co">]</span>.</span>
<span id="cb1-695"><a href="#cb1-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-696"><a href="#cb1-696" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb1-697"><a href="#cb1-697" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-diffuse-TUV</span></span>
<span id="cb1-698"><a href="#cb1-698" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Fraction of total radiation that is diffuse under a clear sky as a function of sun elevation angle. PAR, orange dashed; Red, red; Green, green; Blue, blue; UVA-1, violet; UV-A2, purple; UV-B, black. Based on simulations with the TUV radiation transfer and atmospheric chemistry model for an ozone column on 300 DU, assuming a low optical density of aerosols.</span></span>
<span id="cb1-699"><a href="#cb1-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-700"><a href="#cb1-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-701"><a href="#cb1-701" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(wbands.tb, <span class="fu">aes</span>(SEA)) <span class="sc">+</span></span>
<span id="cb1-702"><a href="#cb1-702" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb1-703"><a href="#cb1-703" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> spl_funs.ls[[<span class="st">"UVB.diff_fr"</span>]], <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">90</span>), <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb1-704"><a href="#cb1-704" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> spl_funs.ls[[<span class="st">"UVA2.diff_fr"</span>]], <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">90</span>), <span class="at">colour =</span> <span class="st">"purple"</span>) <span class="sc">+</span></span>
<span id="cb1-705"><a href="#cb1-705" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> spl_funs.ls[[<span class="st">"UVA1.diff_fr"</span>]], <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">90</span>), <span class="at">colour =</span> <span class="st">"violet"</span>) <span class="sc">+</span></span>
<span id="cb1-706"><a href="#cb1-706" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> spl_funs.ls[[<span class="st">"Blue.diff_fr"</span>]], <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">90</span>), <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb1-707"><a href="#cb1-707" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> spl_funs.ls[[<span class="st">"Green.diff_fr"</span>]], <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">90</span>), <span class="at">colour =</span> <span class="st">"green"</span>) <span class="sc">+</span></span>
<span id="cb1-708"><a href="#cb1-708" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> spl_funs.ls[[<span class="st">"Red.diff_fr"</span>]], <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">90</span>), <span class="at">colour =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb1-709"><a href="#cb1-709" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> spl_funs.ls[[<span class="st">"PAR.diff_fr"</span>]], <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">90</span>), <span class="at">colour =</span> <span class="st">"orange"</span>,</span>
<span id="cb1-710"><a href="#cb1-710" aria-hidden="true" tabindex="-1"></a>                <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb1-711"><a href="#cb1-711" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"Sun elevation angle (degrees)"</span>,</span>
<span id="cb1-712"><a href="#cb1-712" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">15</span>, <span class="dv">30</span>, <span class="dv">45</span>, <span class="dv">60</span>, <span class="dv">75</span>, <span class="dv">90</span>),</span>
<span id="cb1-713"><a href="#cb1-713" aria-hidden="true" tabindex="-1"></a>                     <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="at">name =</span> <span class="st">"Sun zenith angle (degrees)"</span>,</span>
<span id="cb1-714"><a href="#cb1-714" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">transform =</span> <span class="cf">function</span>(x) {<span class="dv">90</span> <span class="sc">-</span> x},</span>
<span id="cb1-715"><a href="#cb1-715" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">90</span>, <span class="dv">100</span>))) <span class="sc">+</span></span>
<span id="cb1-716"><a href="#cb1-716" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="fu">expression</span>(<span class="st">"Diffuse fraction, "</span><span class="sc">*</span>Q[s] <span class="sc">/</span> Q[t]<span class="sc">~</span><span class="er">~</span>(<span class="st">""</span><span class="sc">/</span><span class="dv">1</span>)),</span>
<span id="cb1-717"><a href="#cb1-717" aria-hidden="true" tabindex="-1"></a>       <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="at">name =</span> <span class="fu">expression</span>(<span class="st">"Direct fraction, "</span><span class="sc">*</span>Q[d] <span class="sc">/</span> Q[t]<span class="sc">~</span><span class="er">~</span>(<span class="st">""</span><span class="sc">/</span><span class="dv">1</span>)),</span>
<span id="cb1-718"><a href="#cb1-718" aria-hidden="true" tabindex="-1"></a>       <span class="at">transform =</span> <span class="cf">function</span>(x) {<span class="dv">1</span> <span class="sc">-</span> x} )) <span class="sc">+</span></span>
<span id="cb1-719"><a href="#cb1-719" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="dv">0</span>)</span>
<span id="cb1-720"><a href="#cb1-720" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-721"><a href="#cb1-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-722"><a href="#cb1-722" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Ozone column</span></span>
<span id="cb1-723"><a href="#cb1-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-724"><a href="#cb1-724" aria-hidden="true" tabindex="-1"></a>The spectral wavelength distribution is also modified by the amount of ozone in the atmosphere, known as the ozone column and measured in Dobson units (DU = mm of pure ozone) <span class="co">[</span><span class="ot">@fig-UVB-PAR-ozone</span><span class="co">]</span>. As expected, it is also affected by the air mass traversed, which depends on sun elevation. The UV-B:PAR photon ratior is more strongly dependent on the thickness of the ozone column at low sun elevations, when the ratio it smallest <span class="co">[</span><span class="ot">@fig-UVB-PAR-ozone</span><span class="co">]</span>.</span>
<span id="cb1-725"><a href="#cb1-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-726"><a href="#cb1-726" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb1-727"><a href="#cb1-727" aria-hidden="true" tabindex="-1"></a><span class="fu"># Climate change and ozone depletion</span></span>
<span id="cb1-728"><a href="#cb1-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-729"><a href="#cb1-729" aria-hidden="true" tabindex="-1"></a>An increase in the UV-B and UV-A2 irradiance is caused by depletion of the ozone layer in the stratosphere, mainly as a consequence of the release of chlorofluorocarbons (CFCs), used in cooling devices such as refrigerators and air conditioners, and in some spray cans <span class="co">[</span><span class="ot">see @Graedel1993</span><span class="co">]</span>. The most dramatic manifestation of this has been the seasonal formation of an "ozone hole" over Antarctica. It is controversial whether a true ozone hole has already formed in the Arctic, but strong depletion has occurred in year 2011 <span class="co">[</span><span class="ot">@Manney2011</span><span class="co">]</span> and atmospheric conditions needed for the formation of a "deep" ozone hole are not very different from those prevalent in recent years. Not so dramatic, but consistent, depletion has also been observed at mid-latitudes in both hemispheres. CFCs and some other halocarbons have been phased out following the Montreal agreement and later updates. However, as CFCs have a long half life in the atmosphere, of the order of 100 years, their effect on the ozone layer will persist for many years, even after their use has been drastically reduced. Model-based predictions of changes in atmospheric circulation due to global climate change have been used to derive future trends in index and ozone column thickness <span class="co">[</span><span class="ot">@Hegglin2009</span><span class="co">]</span>. In addition, increased cloudiness and pollution, could lead to decreased global irradiance, sometimes called 'global dimming' <span class="co">[</span><span class="ot">e.g. @Stanhill2001</span><span class="co">]</span>.</span>
<span id="cb1-730"><a href="#cb1-730" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb1-731"><a href="#cb1-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-732"><a href="#cb1-732" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb1-733"><a href="#cb1-733" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-uv-spectra-ozone-scaled</span></span>
<span id="cb1-734"><a href="#cb1-734" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Change in scaled spectral irradiance with sun elevation angle. UV-B and UV-A2 regions of the spectrum. Spectra scaled to PAR = $1\,000\,\mu mol\,s^{-1}\,m^{-2}$. Based on simulations with libradtran for 300 DU and 240 DU, a 20% depletion at Jokioinen, Finland. Data from Anders Lindfors.</span></span>
<span id="cb1-735"><a href="#cb1-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-736"><a href="#cb1-736" aria-hidden="true" tabindex="-1"></a>six_ozone.mspct <span class="ot">&lt;-</span> <span class="fu">subset2mspct</span>(sun_hourly_ozone.spct)</span>
<span id="cb1-737"><a href="#cb1-737" aria-hidden="true" tabindex="-1"></a>six_ozone.mspct <span class="ot">&lt;-</span> six_ozone.mspct[<span class="fu">grepl</span>(<span class="st">"-10$"</span>, <span class="fu">names</span>(six_ozone.mspct))]</span>
<span id="cb1-738"><a href="#cb1-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-739"><a href="#cb1-739" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">fscale</span>(six_ozone.mspct, <span class="at">f =</span> q_irrad, <span class="at">w.band =</span> <span class="fu">PAR</span>(), <span class="at">target =</span> <span class="fl">1e-3</span>),</span>
<span id="cb1-740"><a href="#cb1-740" aria-hidden="true" tabindex="-1"></a>         <span class="at">range =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">340</span>),</span>
<span id="cb1-741"><a href="#cb1-741" aria-hidden="true" tabindex="-1"></a>         <span class="at">unit.out =</span> <span class="st">"photon"</span>, </span>
<span id="cb1-742"><a href="#cb1-742" aria-hidden="true" tabindex="-1"></a>         <span class="at">annotations =</span> <span class="fu">c</span>(<span class="st">"-"</span>, <span class="st">"peaks"</span>),</span>
<span id="cb1-743"><a href="#cb1-743" aria-hidden="true" tabindex="-1"></a>         <span class="at">w.band =</span> <span class="fu">Plant_bands</span>(<span class="st">"CIE"</span>)) <span class="sc">+</span></span>
<span id="cb1-744"><a href="#cb1-744" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">name =</span> <span class="st">"Ozone column (DU)"</span>,</span>
<span id="cb1-745"><a href="#cb1-745" aria-hidden="true" tabindex="-1"></a>                 <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"normO3-10"</span>, <span class="st">"m20percO3-10"</span>),</span>
<span id="cb1-746"><a href="#cb1-746" aria-hidden="true" tabindex="-1"></a>                 <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"300"</span>, <span class="st">"240"</span>),</span>
<span id="cb1-747"><a href="#cb1-747" aria-hidden="true" tabindex="-1"></a>                 <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"solid"</span>, <span class="st">"32"</span>))</span>
<span id="cb1-748"><a href="#cb1-748" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-749"><a href="#cb1-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-750"><a href="#cb1-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-751"><a href="#cb1-751" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb1-752"><a href="#cb1-752" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-UVB-PAR-ozone</span></span>
<span id="cb1-753"><a href="#cb1-753" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Daily time course of UV-B:PAR photon ratio under a clear sky, under normal and 20% depleted ozone column. Based on simulations with libradtran for 300 DU and 240 DU, a 20% depletion at Jokioinen, Finland. Data from Anders Lindfors.</span></span>
<span id="cb1-754"><a href="#cb1-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-755"><a href="#cb1-755" aria-hidden="true" tabindex="-1"></a>sun_ozone_irrads <span class="ot">&lt;-</span> <span class="fu">q_irrad</span>(sun_hourly_ozone.spct, <span class="at">w.band =</span> <span class="fu">Plant_bands</span>(<span class="st">"CIE"</span>))</span>
<span id="cb1-756"><a href="#cb1-756" aria-hidden="true" tabindex="-1"></a>sun_ozone_irrads<span class="sc">$</span>ozone <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"^m20per"</span>, sun_ozone_irrads<span class="sc">$</span>spct.idx),</span>
<span id="cb1-757"><a href="#cb1-757" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"240"</span>,</span>
<span id="cb1-758"><a href="#cb1-758" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"300"</span>),</span>
<span id="cb1-759"><a href="#cb1-759" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"300"</span>, <span class="st">"240"</span>))</span>
<span id="cb1-760"><a href="#cb1-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-761"><a href="#cb1-761" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sun_ozone_irrads, </span>
<span id="cb1-762"><a href="#cb1-762" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(when.measured <span class="sc">+</span> <span class="fu">hours</span>(<span class="dv">2</span>), <span class="st">`</span><span class="at">Q_]UVB.CIE</span><span class="st">`</span> <span class="sc">/</span> Q_PAR <span class="sc">*</span> <span class="fl">1e3</span>, <span class="at">linetype =</span> ozone)) <span class="sc">+</span></span>
<span id="cb1-763"><a href="#cb1-763" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1-764"><a href="#cb1-764" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb1-765"><a href="#cb1-765" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Time of day (hh:mm)"</span>,</span>
<span id="cb1-766"><a href="#cb1-766" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="st">"UV-B:PAR ratio "</span><span class="sc">*</span>(mmol<span class="sc">~</span>mol<span class="sc">^</span>{<span class="sc">-</span><span class="dv">1</span>})),</span>
<span id="cb1-767"><a href="#cb1-767" aria-hidden="true" tabindex="-1"></a>       <span class="at">linetype =</span> <span class="st">"Ozone column (DU)"</span>)</span>
<span id="cb1-768"><a href="#cb1-768" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-769"><a href="#cb1-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-770"><a href="#cb1-770" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Clouds</span></span>
<span id="cb1-771"><a href="#cb1-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-772"><a href="#cb1-772" aria-hidden="true" tabindex="-1"></a>Above we have ignored the effects of clouds and relied heavily on simulations for clear-sky conditions. Next we will consider the effect of clouds and use as examples measurements and simulations that include the effect of clouds. We will consider variation at different time scales. We start with a time series of hourly mean spectra for one day, scaled to equal PAR photon irradiance to illustrate how the shape of the spectrum can change during the course of day <span class="co">[</span><span class="ot">@fig-spectra-whole-day-anim</span><span class="co">]</span>.</span>
<span id="cb1-773"><a href="#cb1-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-774"><a href="#cb1-774" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include=FALSE}</span></span>
<span id="cb1-775"><a href="#cb1-775" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare data</span></span>
<span id="cb1-776"><a href="#cb1-776" aria-hidden="true" tabindex="-1"></a>sun_one_day.spct <span class="ot">&lt;-</span> sun_hourly_august.spct</span>
<span id="cb1-777"><a href="#cb1-777" aria-hidden="true" tabindex="-1"></a>sun_one_day.spct <span class="ot">&lt;-</span> <span class="fu">subset</span>(sun_one_day.spct, <span class="fu">day</span>(UTC) <span class="sc">==</span> <span class="dv">21</span>)</span>
<span id="cb1-778"><a href="#cb1-778" aria-hidden="true" tabindex="-1"></a>sun_one_day.spct <span class="ot">&lt;-</span> <span class="fu">setIdFactor</span>(sun_one_day.spct, <span class="at">idfactor =</span> <span class="st">"UTC"</span>)</span>
<span id="cb1-779"><a href="#cb1-779" aria-hidden="true" tabindex="-1"></a>idfactor <span class="ot">&lt;-</span> <span class="fu">getIdFactor</span>(sun_one_day.spct)</span>
<span id="cb1-780"><a href="#cb1-780" aria-hidden="true" tabindex="-1"></a>sun_one_day.spct[[<span class="st">"time"</span>]] <span class="ot">&lt;-</span> sun_one_day.spct[[idfactor]]</span>
<span id="cb1-781"><a href="#cb1-781" aria-hidden="true" tabindex="-1"></a>sun_one_day.spct[[idfactor]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(sun_one_day.spct[[idfactor]])</span>
<span id="cb1-782"><a href="#cb1-782" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-783"><a href="#cb1-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-784"><a href="#cb1-784" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE, warning=FALSE}</span></span>
<span id="cb1-785"><a href="#cb1-785" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-spectra-whole-day-anim</span></span>
<span id="cb1-786"><a href="#cb1-786" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Time series of scaled spectral photon irradiance during one day. Hourly mean spectra scaled to PAR = 1000 $\mu mol\,s^{-1}\,m^{-2}$ to emphasize the change in shape. Simulated with libradtran including the effect of clouds for Kumpula, Helsinki, Finland. Data from Andes Lindfors.</span></span>
<span id="cb1-787"><a href="#cb1-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-788"><a href="#cb1-788" aria-hidden="true" tabindex="-1"></a>temp.spct <span class="ot">&lt;-</span> <span class="fu">fscale</span>(sun_one_day.spct, </span>
<span id="cb1-789"><a href="#cb1-789" aria-hidden="true" tabindex="-1"></a>                    <span class="at">f =</span> q_irrad, </span>
<span id="cb1-790"><a href="#cb1-790" aria-hidden="true" tabindex="-1"></a>                    <span class="at">target =</span> <span class="fl">1e-3</span>, </span>
<span id="cb1-791"><a href="#cb1-791" aria-hidden="true" tabindex="-1"></a>                    <span class="at">w.band =</span> <span class="fu">PAR</span>())</span>
<span id="cb1-792"><a href="#cb1-792" aria-hidden="true" tabindex="-1"></a>temp.spct <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(temp.spct)</span>
<span id="cb1-793"><a href="#cb1-793" aria-hidden="true" tabindex="-1"></a><span class="fu">id_factor</span>(temp.spct) <span class="ot">&lt;-</span> <span class="st">"UTC"</span></span>
<span id="cb1-794"><a href="#cb1-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-795"><a href="#cb1-795" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> temp.spct,</span>
<span id="cb1-796"><a href="#cb1-796" aria-hidden="true" tabindex="-1"></a>               <span class="at">unit.out =</span> <span class="st">"photon"</span>) <span class="sc">+</span></span>
<span id="cb1-797"><a href="#cb1-797" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spct</span>() <span class="sc">+</span></span>
<span id="cb1-798"><a href="#cb1-798" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_wl_continuous</span>() <span class="sc">+</span></span>
<span id="cb1-799"><a href="#cb1-799" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_s.q.irrad_continuous</span>(<span class="at">name =</span> <span class="fu">s.q.irrad_label</span>(<span class="at">scaled =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb1-800"><a href="#cb1-800" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transition_states</span>(UTC,</span>
<span id="cb1-801"><a href="#cb1-801" aria-hidden="true" tabindex="-1"></a>                    <span class="at">transition_length =</span> <span class="dv">2</span>,</span>
<span id="cb1-802"><a href="#cb1-802" aria-hidden="true" tabindex="-1"></a>                    <span class="at">state_length =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1-803"><a href="#cb1-803" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">'{closest_state} UTC'</span>)</span>
<span id="cb1-804"><a href="#cb1-804" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-805"><a href="#cb1-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-806"><a href="#cb1-806" aria-hidden="true" tabindex="-1"></a>It should be noted that, through reflection, broken clouds can locally increase irradiance to values above those under clear-sky conditions <span class="co">[</span><span class="ot">@Frederick1993; @Diaz1996</span><span class="co">]</span>. These are transient increases of short duration and easily detected with fast measurements, and the irradiance increase can be 30% or more compared to under a clear sky. This is well illustrated by measurements at 1 min interval during four consecutive days <span class="co">[</span><span class="ot">@fig-PAR-four-days</span><span class="co">]</span>.</span>
<span id="cb1-807"><a href="#cb1-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-808"><a href="#cb1-808" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb1-809"><a href="#cb1-809" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-PAR-four-days</span></span>
<span id="cb1-810"><a href="#cb1-810" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Time course of PAR, UV-A and UV-B photon irradiance during four consecutive days with different cloud conditions. Measured with broad band-sensors at Viikki, Helsinki, Finland. The values plotted are 1 min means from measurements once every 5 s. The step changes at very low sun elevations are caused by shading from far-away buildings.</span></span>
<span id="cb1-811"><a href="#cb1-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-812"><a href="#cb1-812" aria-hidden="true" tabindex="-1"></a>((<span class="fu">ggplot</span>(four_days_1min.data, <span class="fu">aes</span>(time_EET, PAR_umol)) <span class="sc">+</span></span>
<span id="cb1-813"><a href="#cb1-813" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spct</span>() <span class="sc">+</span></span>
<span id="cb1-814"><a href="#cb1-814" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text_npc"</span>, <span class="at">label =</span> <span class="st">"PAR"</span>, <span class="at">npcy =</span> <span class="fl">0.95</span>, <span class="at">npcx =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb1-815"><a href="#cb1-815" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Local time"</span>, <span class="at">y =</span> <span class="st">""</span>)) <span class="sc">/</span></span>
<span id="cb1-816"><a href="#cb1-816" aria-hidden="true" tabindex="-1"></a>(<span class="fu">ggplot</span>(four_days_1min.data, <span class="fu">aes</span>(time_EET, UVA_umol)) <span class="sc">+</span></span>
<span id="cb1-817"><a href="#cb1-817" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spct</span>() <span class="sc">+</span></span>
<span id="cb1-818"><a href="#cb1-818" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text_npc"</span>, <span class="at">label =</span> <span class="st">"UV-A"</span>, <span class="at">npcy =</span> <span class="fl">0.95</span>, <span class="at">npcx =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb1-819"><a href="#cb1-819" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Local time"</span>, <span class="at">y =</span> <span class="fu">expression</span>(<span class="st">"Photon irradiance "</span><span class="sc">*</span>(mu<span class="sc">*</span>mol<span class="sc">~</span>s<span class="sc">^</span>{<span class="sc">-</span><span class="dv">1</span>}<span class="sc">~</span>m<span class="sc">^</span>{<span class="sc">-</span><span class="dv">2</span>})))) <span class="sc">/</span></span>
<span id="cb1-820"><a href="#cb1-820" aria-hidden="true" tabindex="-1"></a>(<span class="fu">ggplot</span>(four_days_1min.data, <span class="fu">aes</span>(time_EET, UVB_umol)) <span class="sc">+</span></span>
<span id="cb1-821"><a href="#cb1-821" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spct</span>()) <span class="sc">+</span></span>
<span id="cb1-822"><a href="#cb1-822" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text_npc"</span>, <span class="at">label =</span> <span class="st">"UV-B"</span>, <span class="at">npcy =</span> <span class="fl">0.95</span>, <span class="at">npcx =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb1-823"><a href="#cb1-823" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Time"</span>, <span class="at">y =</span> <span class="st">""</span>)) <span class="sc">+</span> </span>
<span id="cb1-824"><a href="#cb1-824" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">axes =</span> <span class="st">'collect'</span>)</span>
<span id="cb1-825"><a href="#cb1-825" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-826"><a href="#cb1-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-827"><a href="#cb1-827" aria-hidden="true" tabindex="-1"></a>The photon ratios for the same four days <span class="co">[</span><span class="ot">@fig-ratios-four-days</span><span class="co">]</span> shows the </span>
<span id="cb1-828"><a href="#cb1-828" aria-hidden="true" tabindex="-1"></a>influence of clouds and of sun elevation, both affecting the PAR diffuse </span>
<span id="cb1-829"><a href="#cb1-829" aria-hidden="true" tabindex="-1"></a>fraction. In particular, broken clouds on </span>
<span id="cb1-830"><a href="#cb1-830" aria-hidden="true" tabindex="-1"></a>10 July cause momentary nearly doubling of the UV-A:PAR and UV-B:PAR photon </span>
<span id="cb1-831"><a href="#cb1-831" aria-hidden="true" tabindex="-1"></a>ratios. The short-term effect on the R:FR is smaller, but the differences</span>
<span id="cb1-832"><a href="#cb1-832" aria-hidden="true" tabindex="-1"></a>between days larger, possibly because of its dependence on the atmospheric</span>
<span id="cb1-833"><a href="#cb1-833" aria-hidden="true" tabindex="-1"></a>water content <span class="co">[</span><span class="ot">@kotilainenxxxx</span><span class="co">]</span>.</span>
<span id="cb1-834"><a href="#cb1-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-835"><a href="#cb1-835" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb1-836"><a href="#cb1-836" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-ratios-four-days</span></span>
<span id="cb1-837"><a href="#cb1-837" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Time course of red:far-red, UV-A:PAR and UV-B:PAR photon ratios during four consecutive days with different cloud conditions. Measured with broad band-sensors at Viikki, Helsinki, Finland. The values plotted are 1 min means from measurements once every 5 s; data shown for sun above the horizon. The step changes at very low sun elevations are caused by shading from far-away buildings. The PAR diffuse ratio varies with sun elevation in the range 0.12 to 1.0, as shown in @fig-diffuse-TUV for clear sky conditions. With the solar disk fully occluded by clouds or objects the diffuse ratio approches 1 at all sun elevations. </span></span>
<span id="cb1-838"><a href="#cb1-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-839"><a href="#cb1-839" aria-hidden="true" tabindex="-1"></a>((<span class="fu">ggplot</span>(four_days_1min.data, </span>
<span id="cb1-840"><a href="#cb1-840" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(time_EET, </span>
<span id="cb1-841"><a href="#cb1-841" aria-hidden="true" tabindex="-1"></a>             <span class="fu">ifelse</span>(sun_elevation <span class="sc">&gt;</span> <span class="dv">0</span>, red_umol <span class="sc">/</span> far_red_umol, <span class="cn">NA</span>),</span>
<span id="cb1-842"><a href="#cb1-842" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> PAR_diff_fr)) <span class="sc">+</span></span>
<span id="cb1-843"><a href="#cb1-843" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">size =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb1-844"><a href="#cb1-844" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text_npc"</span>, <span class="at">label =</span> <span class="st">"R:FR"</span>, <span class="at">npcy =</span> <span class="fl">0.95</span>, <span class="at">npcx =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb1-845"><a href="#cb1-845" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Local time"</span>, <span class="at">y =</span> <span class="st">""</span>,</span>
<span id="cb1-846"><a href="#cb1-846" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> <span class="fu">expression</span>(<span class="st">"PAR diffuse fraction  "</span><span class="sc">*</span>Q[s]<span class="sc">/</span>Q[t]))) <span class="sc">/</span></span>
<span id="cb1-847"><a href="#cb1-847" aria-hidden="true" tabindex="-1"></a>(<span class="fu">ggplot</span>(four_days_1min.data, </span>
<span id="cb1-848"><a href="#cb1-848" aria-hidden="true" tabindex="-1"></a>        <span class="fu">aes</span>(time_EET, </span>
<span id="cb1-849"><a href="#cb1-849" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ifelse</span>(sun_elevation <span class="sc">&gt;</span> <span class="dv">0</span>, UVA_umol <span class="sc">/</span> PAR_umol, <span class="cn">NA</span>),</span>
<span id="cb1-850"><a href="#cb1-850" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> PAR_diff_fr)) <span class="sc">+</span></span>
<span id="cb1-851"><a href="#cb1-851" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">size =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb1-852"><a href="#cb1-852" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text_npc"</span>, <span class="at">label =</span> <span class="st">"UV-A:PAR"</span>, <span class="at">npcy =</span> <span class="fl">0.95</span>, <span class="at">npcx =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb1-853"><a href="#cb1-853" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Local time"</span>, <span class="at">y =</span> <span class="fu">expression</span>(<span class="st">"Photon ratio "</span><span class="sc">*</span>(mol<span class="sc">~</span>mol<span class="sc">^</span>{<span class="sc">-</span><span class="dv">1</span>})),</span>
<span id="cb1-854"><a href="#cb1-854" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> <span class="fu">expression</span>(<span class="st">"PAR diffuse fraction  "</span><span class="sc">*</span>Q[s]<span class="sc">/</span>Q[t]))) <span class="sc">/</span></span>
<span id="cb1-855"><a href="#cb1-855" aria-hidden="true" tabindex="-1"></a>(<span class="fu">ggplot</span>(four_days_1min.data, <span class="fu">aes</span>(time_EET, </span>
<span id="cb1-856"><a href="#cb1-856" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ifelse</span>(sun_elevation <span class="sc">&gt;</span> <span class="dv">0</span>, UVB_umol <span class="sc">/</span> PAR_umol, <span class="cn">NA</span>),</span>
<span id="cb1-857"><a href="#cb1-857" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> PAR_diff_fr)) <span class="sc">+</span></span>
<span id="cb1-858"><a href="#cb1-858" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">size =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb1-859"><a href="#cb1-859" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text_npc"</span>, <span class="at">label =</span> <span class="st">"UV-B:PAR"</span>, <span class="at">npcy =</span> <span class="fl">0.95</span>, <span class="at">npcx =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb1-860"><a href="#cb1-860" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Time"</span>, <span class="at">y =</span> <span class="st">""</span>,</span>
<span id="cb1-861"><a href="#cb1-861" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> <span class="fu">expression</span>(<span class="st">"PAR diffuse fraction  "</span><span class="sc">*</span>Q[s]<span class="sc">/</span>Q[t])))) <span class="sc">+</span> </span>
<span id="cb1-862"><a href="#cb1-862" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">axes =</span> <span class="st">'collect'</span>, <span class="at">guides =</span> <span class="st">'collect'</span>)</span>
<span id="cb1-863"><a href="#cb1-863" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-864"><a href="#cb1-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-865"><a href="#cb1-865" aria-hidden="true" tabindex="-1"></a>In @fig-ratios-four-days we can see fast changes in the ratios towards the end of the day. The time-series of spectra measured once a minute during 5 minutes shows how the shape of the spectrum can rapidly change leading to rapid changes in the R:FR photon ratio <span class="co">[</span><span class="ot">@fig-spectra-anim-five-min</span><span class="co">]</span>.</span>
<span id="cb1-866"><a href="#cb1-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-867"><a href="#cb1-867" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include=FALSE}</span></span>
<span id="cb1-868"><a href="#cb1-868" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare data</span></span>
<span id="cb1-869"><a href="#cb1-869" aria-hidden="true" tabindex="-1"></a>my_sun.spct <span class="ot">&lt;-</span> sun_evening.spct</span>
<span id="cb1-870"><a href="#cb1-870" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">when_measured</span>(my_sun.spct, <span class="at">as.df =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-871"><a href="#cb1-871" aria-hidden="true" tabindex="-1"></a>my_sun.spct<span class="sc">$</span>spct.idx <span class="ot">&lt;-</span> </span>
<span id="cb1-872"><a href="#cb1-872" aria-hidden="true" tabindex="-1"></a>  <span class="fu">factor</span>(my_sun.spct<span class="sc">$</span>spct.idx, </span>
<span id="cb1-873"><a href="#cb1-873" aria-hidden="true" tabindex="-1"></a>         <span class="at">levels =</span> time[[<span class="st">"spct.idx"</span>]], </span>
<span id="cb1-874"><a href="#cb1-874" aria-hidden="true" tabindex="-1"></a>         <span class="at">labels =</span> <span class="fu">as.character</span>(<span class="fu">round_date</span>(time[[<span class="st">"when.measured"</span>]], <span class="at">unit =</span> <span class="st">"minute"</span>)))</span>
<span id="cb1-875"><a href="#cb1-875" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-876"><a href="#cb1-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-877"><a href="#cb1-877" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb1-878"><a href="#cb1-878" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-spectra-anim-five-min</span></span>
<span id="cb1-879"><a href="#cb1-879" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Time series of spectra near sunset. Five minutes of solar spectra measurements. Measured with an array spectrometer at Viikki, Helsinki, Finland.</span></span>
<span id="cb1-880"><a href="#cb1-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-881"><a href="#cb1-881" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> my_sun.spct, <span class="at">unit.out =</span> <span class="st">"photon"</span>) <span class="sc">+</span></span>
<span id="cb1-882"><a href="#cb1-882" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spct</span>() <span class="sc">+</span></span>
<span id="cb1-883"><a href="#cb1-883" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_wl_continuous</span>() <span class="sc">+</span></span>
<span id="cb1-884"><a href="#cb1-884" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_s.q.irrad_continuous</span>() <span class="sc">+</span></span>
<span id="cb1-885"><a href="#cb1-885" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transition_states</span>(spct.idx,</span>
<span id="cb1-886"><a href="#cb1-886" aria-hidden="true" tabindex="-1"></a>                    <span class="at">transition_length =</span> <span class="dv">2</span>,</span>
<span id="cb1-887"><a href="#cb1-887" aria-hidden="true" tabindex="-1"></a>                    <span class="at">state_length =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1-888"><a href="#cb1-888" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">'Now showing {closest_state} UTC'</span>,</span>
<span id="cb1-889"><a href="#cb1-889" aria-hidden="true" tabindex="-1"></a>          <span class="at">subtitle =</span> <span class="st">'Frame {frame} of {nframes}'</span>)</span>
<span id="cb1-890"><a href="#cb1-890" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-891"><a href="#cb1-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-892"><a href="#cb1-892" aria-hidden="true" tabindex="-1"></a>The low irradiance periods interspersed with higher irradiance ones, caused by moving clouds intermittently occluding the sun, or cloud flecks, have a haphazard dynamics that is very dependent on the cloud type and wind conditions. One way of describing them is by estimating an empirical probability density function for their duration <span class="co">[</span><span class="ot">@fig-cloudflecks-edf inset</span><span class="co">]</span>. The distribution is not Normal, and skewed to the right. Semi-transparent and small clouds attenuate irradiance less that large thick clouds and at the same time create cloud flecks of shorter duration <span class="co">[</span><span class="ot">@fig-cloudflecks-edf main panel</span><span class="co">]</span>.</span>
<span id="cb1-893"><a href="#cb1-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-894"><a href="#cb1-894" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb1-895"><a href="#cb1-895" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-cloudflecks-edf</span></span>
<span id="cb1-896"><a href="#cb1-896" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: xxxxxxxxxxxxxxx. In the main panel a quantile regression is shown, with the line repesenting the median, the dark band enclosing the two central quantiles (simmilar to the box in a box plot) and the pale band enclosing 90% of the observations. The inset shows the fitted empirical density function (EDF) for the duration of the cloudflecks. Source @Sellaro2024.</span></span>
<span id="cb1-897"><a href="#cb1-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-898"><a href="#cb1-898" aria-hidden="true" tabindex="-1"></a>dfS <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"light-environment-data/dfCloudfleck_figure.csv"</span>)</span>
<span id="cb1-899"><a href="#cb1-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-900"><a href="#cb1-900" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb1-901"><a href="#cb1-901" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> dfS, <span class="fu">aes</span>(percDiff <span class="sc">*</span> <span class="dv">100</span>, duration)) <span class="sc">+</span></span>
<span id="cb1-902"><a href="#cb1-902" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_quant_band</span>(<span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">qss</span>(x, <span class="at">lambda =</span> <span class="dv">50</span>, <span class="at">constraint =</span> <span class="st">"I"</span>), <span class="at">method =</span> <span class="st">"rqss:sfnc"</span>,</span>
<span id="cb1-903"><a href="#cb1-903" aria-hidden="true" tabindex="-1"></a>                  <span class="at">quantiles =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb1-904"><a href="#cb1-904" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_quant_band</span>(<span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">qss</span>(x, <span class="at">lambda =</span> <span class="dv">50</span>, <span class="at">constraint =</span> <span class="st">"I"</span>), <span class="at">method =</span> <span class="st">"rqss:sfnc"</span>) <span class="sc">+</span></span>
<span id="cb1-905"><a href="#cb1-905" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_quadrant_counts</span>(<span class="at">quadrants =</span> <span class="dv">0</span>L,</span>
<span id="cb1-906"><a href="#cb1-906" aria-hidden="true" tabindex="-1"></a>                       <span class="at">label.x =</span> <span class="fl">0.95</span>,</span>
<span id="cb1-907"><a href="#cb1-907" aria-hidden="true" tabindex="-1"></a>                       <span class="at">label.y =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb1-908"><a href="#cb1-908" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"PAR attenuation during cloudfleck (%)"</span>,</span>
<span id="cb1-909"><a href="#cb1-909" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Cloudfleck duration (min)"</span>) <span class="sc">+</span></span>
<span id="cb1-910"><a href="#cb1-910" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb1-911"><a href="#cb1-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-912"><a href="#cb1-912" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> dfS, <span class="fu">aes</span>(duration)) <span class="sc">+</span></span>
<span id="cb1-913"><a href="#cb1-913" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_density</span>(<span class="at">bw =</span> <span class="st">"nrd"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb1-914"><a href="#cb1-914" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">500</span>)) <span class="sc">+</span></span>
<span id="cb1-915"><a href="#cb1-915" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="fl">1.7</span>, <span class="dv">500</span>)) <span class="sc">+</span></span>
<span id="cb1-916"><a href="#cb1-916" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Cloudfleck duration (min)"</span>,</span>
<span id="cb1-917"><a href="#cb1-917" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Empirical probability density"</span>)</span>
<span id="cb1-918"><a href="#cb1-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-919"><a href="#cb1-919" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p2 <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">60</span>, <span class="dv">120</span>, <span class="dv">180</span>, <span class="dv">240</span>, <span class="dv">300</span>)) <span class="sc">+</span></span>
<span id="cb1-920"><a href="#cb1-920" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"plot"</span>, <span class="at">x =</span> <span class="fu">I</span>(<span class="fl">0.05</span>), <span class="at">y =</span> <span class="fu">I</span>(<span class="dv">1</span>), <span class="at">label =</span> p3, <span class="at">vp.width =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">vp.height =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>))</span>
<span id="cb1-921"><a href="#cb1-921" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-922"><a href="#cb1-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-923"><a href="#cb1-923" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb1-924"><a href="#cb1-924" aria-hidden="true" tabindex="-1"></a><span class="do">## cloudfleck spectrum</span></span>
<span id="cb1-925"><a href="#cb1-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-926"><a href="#cb1-926" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1-927"><a href="#cb1-927" aria-hidden="true" tabindex="-1"></a>  <span class="fu">photon_as_default</span>()</span>
<span id="cb1-928"><a href="#cb1-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-929"><a href="#cb1-929" aria-hidden="true" tabindex="-1"></a>CSCLDY.df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"light-environment-data/dfCSCLDY.csv"</span>)[ , <span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb1-930"><a href="#cb1-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-931"><a href="#cb1-931" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(CSCLDY.df)[<span class="fu">names</span>(CSCLDY.df) <span class="sc">==</span> <span class="st">"s.q.irrad"</span>] <span class="ot">&lt;-</span> <span class="st">"s.e.irrad"</span> <span class="co"># error in data file</span></span>
<span id="cb1-932"><a href="#cb1-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-933"><a href="#cb1-933" aria-hidden="true" tabindex="-1"></a>CSCLDY.df <span class="ot">&lt;-</span> <span class="fu">subset</span>(CSCLDY.df, w.length <span class="sc">&gt;</span> <span class="dv">295</span> <span class="sc">&amp;</span> w.length <span class="sc">&lt;</span> <span class="dv">850</span>)</span>
<span id="cb1-934"><a href="#cb1-934" aria-hidden="true" tabindex="-1"></a>CSCLDY.df<span class="sc">$</span>type.label <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">" "</span>, CSCLDY.df<span class="sc">$</span>type)</span>
<span id="cb1-935"><a href="#cb1-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-936"><a href="#cb1-936" aria-hidden="true" tabindex="-1"></a>CSCLDY.spct <span class="ot">&lt;-</span> <span class="fu">as.source_spct</span>(CSCLDY.df,</span>
<span id="cb1-937"><a href="#cb1-937" aria-hidden="true" tabindex="-1"></a>                              <span class="at">idfactor =</span> <span class="st">"type"</span>,</span>
<span id="cb1-938"><a href="#cb1-938" aria-hidden="true" tabindex="-1"></a>                              <span class="at">multiple.wl =</span> <span class="fu">length</span>(<span class="fu">unique</span>(CSCLDY.df<span class="sc">$</span>type)))</span>
<span id="cb1-939"><a href="#cb1-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-940"><a href="#cb1-940" aria-hidden="true" tabindex="-1"></a>CSCLDY.mspct <span class="ot">&lt;-</span> <span class="fu">e2q</span>(<span class="fu">subset2mspct</span>(CSCLDY.spct))</span>
<span id="cb1-941"><a href="#cb1-941" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-942"><a href="#cb1-942" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-943"><a href="#cb1-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-944"><a href="#cb1-944" aria-hidden="true" tabindex="-1"></a>Irradiance is much lower under cloud cover than in full sunlight under a clear sky <span class="co">[</span><span class="ot">@fig-spectrum-cloudfleck A</span><span class="co">]</span>. The cloud light spectrum is shifted towards shorter wavelengths, i.e., shade light is bluer (or cooler) than full sunlight, more easily seen after scaling the spectra to equal irradiance <span class="co">[</span><span class="ot">@fig-spectrum-cloudfleck B</span><span class="co">]</span>. For this example the coordinated colour temperature (CCT) was <span class="in">`r round(spct_CCT(CSCLDY.mspct[["overcast"]]), -1)`</span> K and <span class="in">`r round(spct_CCT(CSCLDY.mspct[["clear.sky"]]), -1)`</span> K for the overcast and clear sky, respectively. </span>
<span id="cb1-945"><a href="#cb1-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-946"><a href="#cb1-946" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb1-947"><a href="#cb1-947" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-spectrum-cloudfleck</span></span>
<span id="cb1-948"><a href="#cb1-948" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Spectra during and immediately after a cloudfleck. A&amp;#58; photon spectral irradiance as measured, B&amp;#58; same data scaled to equal PAR of $1\,000 \mu mol\,s^{-1}\,m^{-2}$. Source @Sellaro2024.</span></span>
<span id="cb1-949"><a href="#cb1-949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-950"><a href="#cb1-950" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1-951"><a href="#cb1-951" aria-hidden="true" tabindex="-1"></a>  <span class="fu">photon_as_default</span>()</span>
<span id="cb1-952"><a href="#cb1-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-953"><a href="#cb1-953" aria-hidden="true" tabindex="-1"></a>p.cloudy.scaled <span class="ot">&lt;-</span></span>
<span id="cb1-954"><a href="#cb1-954" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">fscale</span>(CSCLDY.spct,</span>
<span id="cb1-955"><a href="#cb1-955" aria-hidden="true" tabindex="-1"></a>                       <span class="at">f =</span> q_irrad , <span class="at">target =</span> <span class="fl">1e-3</span>, <span class="at">w.band =</span> <span class="fu">PAR</span>()),</span>
<span id="cb1-956"><a href="#cb1-956" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(w.length, s.q.irrad, <span class="at">colour =</span> type)) <span class="sc">+</span></span>
<span id="cb1-957"><a href="#cb1-957" aria-hidden="true" tabindex="-1"></a><span class="co">#  geom_vline(xintercept = c(400, 700), linetype = "dotted") +</span></span>
<span id="cb1-958"><a href="#cb1-958" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_wl_strip</span>(<span class="at">ymin =</span> <span class="sc">-</span><span class="fl">0.015e-6</span>, <span class="at">ymax =</span> <span class="sc">-</span><span class="fl">0.003e-6</span>) <span class="sc">+</span></span>
<span id="cb1-959"><a href="#cb1-959" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_identity</span>() <span class="sc">+</span></span>
<span id="cb1-960"><a href="#cb1-960" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1-961"><a href="#cb1-961" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_s.q.irrad_continuous</span>(<span class="at">unit.exponent =</span> <span class="sc">-</span><span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb1-962"><a href="#cb1-962" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_wl_continuous</span>() <span class="sc">+</span></span>
<span id="cb1-963"><a href="#cb1-963" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"steelblue3"</span>, <span class="st">"grey20"</span>)) <span class="sc">+</span></span>
<span id="cb1-964"><a href="#cb1-964" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">tag =</span> <span class="st">"B"</span>, <span class="at">colour =</span> <span class="st">""</span>)</span>
<span id="cb1-965"><a href="#cb1-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-966"><a href="#cb1-966" aria-hidden="true" tabindex="-1"></a>p.cloudy.irrad <span class="ot">&lt;-</span></span>
<span id="cb1-967"><a href="#cb1-967" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">e2q</span>(CSCLDY.spct),</span>
<span id="cb1-968"><a href="#cb1-968" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(w.length, s.q.irrad, <span class="at">colour =</span> type)) <span class="sc">+</span></span>
<span id="cb1-969"><a href="#cb1-969" aria-hidden="true" tabindex="-1"></a><span class="co">#  geom_vline(xintercept = c(400, 700), linetype = "dotted") +</span></span>
<span id="cb1-970"><a href="#cb1-970" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_wl_strip</span>(<span class="at">ymin =</span> <span class="sc">-</span><span class="fl">0.19e-6</span>, <span class="at">ymax =</span> <span class="sc">-</span><span class="fl">0.03e-6</span>) <span class="sc">+</span></span>
<span id="cb1-971"><a href="#cb1-971" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1-972"><a href="#cb1-972" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_identity</span>() <span class="sc">+</span></span>
<span id="cb1-973"><a href="#cb1-973" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_s.q.irrad_continuous</span>(<span class="at">unit.exponent =</span> <span class="sc">-</span><span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb1-974"><a href="#cb1-974" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_wl_continuous</span>() <span class="sc">+</span></span>
<span id="cb1-975"><a href="#cb1-975" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"steelblue3"</span>, <span class="st">"grey20"</span>)) <span class="sc">+</span></span>
<span id="cb1-976"><a href="#cb1-976" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">tag =</span> <span class="st">"A"</span>, <span class="at">colour =</span> <span class="st">""</span>)</span>
<span id="cb1-977"><a href="#cb1-977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-978"><a href="#cb1-978" aria-hidden="true" tabindex="-1"></a>p.cloudy.irrad <span class="sc">/</span> p.cloudy.scaled <span class="sc">+</span></span>
<span id="cb1-979"><a href="#cb1-979" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">axes =</span> <span class="st">"collect"</span>, <span class="at">guides =</span> <span class="st">"collect"</span>)</span>
<span id="cb1-980"><a href="#cb1-980" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-981"><a href="#cb1-981" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-982"><a href="#cb1-982" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Elevation</span></span>
<span id="cb1-983"><a href="#cb1-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-984"><a href="#cb1-984" aria-hidden="true" tabindex="-1"></a>**We have three options: 1) generate suitable data with TUV, 2) show measured data from the literature, or 3) both.** </span>
<span id="cb1-985"><a href="#cb1-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-986"><a href="#cb1-986" aria-hidden="true" tabindex="-1"></a>A simulation with the TUV model shows how attenuation by the atmosphere decreases with increasing ground altitude under a clear sky, with all other parameters kept unchanged, including surface albedo. As above, we show the actual spectral irradiance and the spectral irradiances scaled to equal PAR photon irradiance. The effect is not huge and the decrease in attenuation is stronger at shorter wavelengths <span class="co">[</span><span class="ot">@fig-spectrum-ground-altitude</span><span class="co">]</span>.</span>
<span id="cb1-987"><a href="#cb1-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-988"><a href="#cb1-988" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb1-989"><a href="#cb1-989" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-spectrum-ground-altitude</span></span>
<span id="cb1-990"><a href="#cb1-990" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Spectra under clear sky and a sun elevation of 45 degrees at different ground altitudes. A&amp;#58; photon spectral irradiance as computed with the TUV model, B&amp;#58; same data scaled to equal PAR of $1\,000 \mu mol\,s^{-1}\,m^{-2}$.</span></span>
<span id="cb1-991"><a href="#cb1-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-992"><a href="#cb1-992" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1-993"><a href="#cb1-993" aria-hidden="true" tabindex="-1"></a>  <span class="fu">photon_as_default</span>()</span>
<span id="cb1-994"><a href="#cb1-994" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-995"><a href="#cb1-995" aria-hidden="true" tabindex="-1"></a><span class="co"># avoid repeated calls to Quick TUV server</span></span>
<span id="cb1-996"><a href="#cb1-996" aria-hidden="true" tabindex="-1"></a>altitudes.file.path <span class="ot">&lt;-</span> <span class="st">"light-environment-data/ground_altitudesx2.mspct.rda"</span></span>
<span id="cb1-997"><a href="#cb1-997" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(altitudes.file.path)) {</span>
<span id="cb1-998"><a href="#cb1-998" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(altitudes.file.path)</span>
<span id="cb1-999"><a href="#cb1-999" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb1-1000"><a href="#cb1-1000" aria-hidden="true" tabindex="-1"></a>  ground_altitudes.mspct <span class="ot">&lt;-</span></span>
<span id="cb1-1001"><a href="#cb1-1001" aria-hidden="true" tabindex="-1"></a>    <span class="fu">qtuv_m_s.e.irrad</span>(</span>
<span id="cb1-1002"><a href="#cb1-1002" aria-hidden="true" tabindex="-1"></a>      <span class="at">ground.altitude =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">8</span>),</span>
<span id="cb1-1003"><a href="#cb1-1003" aria-hidden="true" tabindex="-1"></a>      <span class="at">w.length =</span> <span class="dv">290</span><span class="sc">:</span><span class="dv">750</span>,</span>
<span id="cb1-1004"><a href="#cb1-1004" aria-hidden="true" tabindex="-1"></a>      <span class="at">sun.elevation =</span> <span class="dv">45</span></span>
<span id="cb1-1005"><a href="#cb1-1005" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-1006"><a href="#cb1-1006" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(ground_altitudes.mspct, <span class="at">file =</span> altitudes.file.path)</span>
<span id="cb1-1007"><a href="#cb1-1007" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-1008"><a href="#cb1-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1009"><a href="#cb1-1009" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(ground_altitudes.mspct) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">8</span>), <span class="st">"km"</span>)</span>
<span id="cb1-1010"><a href="#cb1-1010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1011"><a href="#cb1-1011" aria-hidden="true" tabindex="-1"></a>p.altitude.scaled <span class="ot">&lt;-</span></span>
<span id="cb1-1012"><a href="#cb1-1012" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">fscale</span>(ground_altitudes.mspct,</span>
<span id="cb1-1013"><a href="#cb1-1013" aria-hidden="true" tabindex="-1"></a>                       <span class="at">f =</span> q_irrad , <span class="at">target =</span> <span class="fl">1e-3</span>, <span class="at">w.band =</span> <span class="fu">PAR</span>()),</span>
<span id="cb1-1014"><a href="#cb1-1014" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(w.length, s.q.irrad, <span class="at">colour =</span> spct.idx)) <span class="sc">+</span></span>
<span id="cb1-1015"><a href="#cb1-1015" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  geom_vline(xintercept = c(400, 700), linetype = "dotted") +</span></span>
<span id="cb1-1016"><a href="#cb1-1016" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_wl_strip</span>(<span class="at">ymin =</span> <span class="sc">-</span><span class="fl">0.015e-6</span>, <span class="at">ymax =</span> <span class="sc">-</span><span class="fl">0.003e-6</span>) <span class="sc">+</span></span>
<span id="cb1-1017"><a href="#cb1-1017" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_identity</span>() <span class="sc">+</span></span>
<span id="cb1-1018"><a href="#cb1-1018" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1-1019"><a href="#cb1-1019" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_s.q.irrad_continuous</span>(<span class="at">unit.exponent =</span> <span class="sc">-</span><span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb1-1020"><a href="#cb1-1020" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_wl_continuous</span>() <span class="sc">+</span></span>
<span id="cb1-1021"><a href="#cb1-1021" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"darkgreen"</span>, <span class="st">"grey20"</span>)) <span class="sc">+</span></span>
<span id="cb1-1022"><a href="#cb1-1022" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">tag =</span> <span class="st">"B"</span>, <span class="at">colour =</span> <span class="st">""</span>)</span>
<span id="cb1-1023"><a href="#cb1-1023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1024"><a href="#cb1-1024" aria-hidden="true" tabindex="-1"></a>p.altitude.irrad <span class="ot">&lt;-</span></span>
<span id="cb1-1025"><a href="#cb1-1025" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">e2q</span>(ground_altitudes.mspct),</span>
<span id="cb1-1026"><a href="#cb1-1026" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(w.length, s.q.irrad, <span class="at">colour =</span> spct.idx)) <span class="sc">+</span></span>
<span id="cb1-1027"><a href="#cb1-1027" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  geom_vline(xintercept = c(400, 700), linetype = "dotted") +</span></span>
<span id="cb1-1028"><a href="#cb1-1028" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_wl_strip</span>(<span class="at">ymin =</span> <span class="sc">-</span><span class="fl">0.19e-6</span>, <span class="at">ymax =</span> <span class="sc">-</span><span class="fl">0.03e-6</span>) <span class="sc">+</span></span>
<span id="cb1-1029"><a href="#cb1-1029" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1-1030"><a href="#cb1-1030" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_identity</span>() <span class="sc">+</span></span>
<span id="cb1-1031"><a href="#cb1-1031" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_s.q.irrad_continuous</span>(<span class="at">unit.exponent =</span> <span class="sc">-</span><span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb1-1032"><a href="#cb1-1032" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_wl_continuous</span>() <span class="sc">+</span></span>
<span id="cb1-1033"><a href="#cb1-1033" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"darkgreen"</span>, <span class="st">"grey20"</span>)) <span class="sc">+</span></span>
<span id="cb1-1034"><a href="#cb1-1034" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">tag =</span> <span class="st">"A"</span>, <span class="at">colour =</span> <span class="st">""</span>)</span>
<span id="cb1-1035"><a href="#cb1-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1036"><a href="#cb1-1036" aria-hidden="true" tabindex="-1"></a>p.altitude.irrad <span class="sc">/</span> p.altitude.scaled <span class="sc">+</span></span>
<span id="cb1-1037"><a href="#cb1-1037" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">axes =</span> <span class="st">"collect"</span>, <span class="at">guides =</span> <span class="st">"collect"</span>)</span>
<span id="cb1-1038"><a href="#cb1-1038" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-1039"><a href="#cb1-1039" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-1040"><a href="#cb1-1040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1041"><a href="#cb1-1041" aria-hidden="true" tabindex="-1"></a>In @fig-spectrum-ground-altitude we show the spectra for two extreme altitudes, sea level and 8000 m above sea level. In @fig-irradiance-ground-altitude we show the increase in UV-B, UV-A2, UV-A1 and PAR with ground altitude.</span>
<span id="cb1-1042"><a href="#cb1-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1043"><a href="#cb1-1043" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb1-1044"><a href="#cb1-1044" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-irradiance-ground-altitude</span></span>
<span id="cb1-1045"><a href="#cb1-1045" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Increase in PAR and UV irradiances at ground level under clear sky as a function of ground altitude above sea level. Based on spectral simulations with TUV for sun elevation 45 degrees. UVA-1, violet; UV-A2, purple; UV-B, black.</span></span>
<span id="cb1-1046"><a href="#cb1-1046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1047"><a href="#cb1-1047" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1-1048"><a href="#cb1-1048" aria-hidden="true" tabindex="-1"></a>  <span class="fu">photon_as_default</span>()</span>
<span id="cb1-1049"><a href="#cb1-1049" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-1050"><a href="#cb1-1050" aria-hidden="true" tabindex="-1"></a><span class="co"># avoid repeated calls to Quick TUV server</span></span>
<span id="cb1-1051"><a href="#cb1-1051" aria-hidden="true" tabindex="-1"></a>altitudes.file.path <span class="ot">&lt;-</span> <span class="st">"light-environment-data/ground_altitudesx9.mspct.rda"</span></span>
<span id="cb1-1052"><a href="#cb1-1052" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(altitudes.file.path)) {</span>
<span id="cb1-1053"><a href="#cb1-1053" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(altitudes.file.path)</span>
<span id="cb1-1054"><a href="#cb1-1054" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb1-1055"><a href="#cb1-1055" aria-hidden="true" tabindex="-1"></a>  ground_altitudesx9.mspct <span class="ot">&lt;-</span></span>
<span id="cb1-1056"><a href="#cb1-1056" aria-hidden="true" tabindex="-1"></a>  <span class="fu">qtuv_m_s.e.irrad</span>(</span>
<span id="cb1-1057"><a href="#cb1-1057" aria-hidden="true" tabindex="-1"></a>    <span class="at">ground.altitude =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">8</span>,</span>
<span id="cb1-1058"><a href="#cb1-1058" aria-hidden="true" tabindex="-1"></a>    <span class="at">w.length =</span> <span class="dv">290</span><span class="sc">:</span><span class="dv">750</span>,</span>
<span id="cb1-1059"><a href="#cb1-1059" aria-hidden="true" tabindex="-1"></a>    <span class="at">sun.elevation =</span> <span class="dv">45</span></span>
<span id="cb1-1060"><a href="#cb1-1060" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-1061"><a href="#cb1-1061" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(ground_altitudesx9.mspct, <span class="at">file =</span> altitudes.file.path)</span>
<span id="cb1-1062"><a href="#cb1-1062" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-1063"><a href="#cb1-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1064"><a href="#cb1-1064" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(ground_altitudesx9.mspct) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">8</span>)</span>
<span id="cb1-1065"><a href="#cb1-1065" aria-hidden="true" tabindex="-1"></a>ground_altitudesx9.spct <span class="ot">&lt;-</span> <span class="fu">rbindspct</span>(ground_altitudesx9.mspct, <span class="at">idfactor =</span> <span class="st">"Altitude"</span>)</span>
<span id="cb1-1066"><a href="#cb1-1066" aria-hidden="true" tabindex="-1"></a>q_irrads_altitude.tb <span class="ot">&lt;-</span> <span class="fu">q_irrad</span>(ground_altitudesx9.spct, <span class="fu">Plant_bands</span>(<span class="st">"CIE"</span>), <span class="at">scale.factor =</span> <span class="fl">1e6</span>)</span>
<span id="cb1-1067"><a href="#cb1-1067" aria-hidden="true" tabindex="-1"></a>q_irrads_altitude.tb<span class="sc">$</span>Altitude <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(q_irrads_altitude.tb<span class="sc">$</span>Altitude)</span>
<span id="cb1-1068"><a href="#cb1-1068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1069"><a href="#cb1-1069" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(q_irrads_altitude.tb, <span class="fu">aes</span>(Altitude)) <span class="sc">+</span></span>
<span id="cb1-1070"><a href="#cb1-1070" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> ((<span class="st">`</span><span class="at">Q_]UVB.CIE</span><span class="st">`</span> <span class="sc">/</span> <span class="st">`</span><span class="at">Q_]UVB.CIE</span><span class="st">`</span>[<span class="dv">1</span>]) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span>), <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb1-1071"><a href="#cb1-1071" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> ((Q_UVA2.CIE <span class="sc">/</span> Q_UVA2.CIE[<span class="dv">1</span>]) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span>), <span class="at">colour =</span> <span class="st">"purple"</span>) <span class="sc">+</span></span>
<span id="cb1-1072"><a href="#cb1-1072" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> ((Q_UVA1.CIE <span class="sc">/</span> Q_UVA1.CIE[<span class="dv">1</span>]) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span>), <span class="at">colour =</span> <span class="st">"violet"</span>) <span class="sc">+</span></span>
<span id="cb1-1073"><a href="#cb1-1073" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> ((Q_PAR <span class="sc">/</span> Q_PAR[<span class="dv">1</span>]) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span>), <span class="at">colour =</span> <span class="st">"orange"</span>) <span class="sc">+</span></span>
<span id="cb1-1074"><a href="#cb1-1074" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="st">"Increase in photon irradiance (%)"</span>) <span class="sc">+</span></span>
<span id="cb1-1075"><a href="#cb1-1075" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"Ground altitude (km a.s.l.)"</span>)</span>
<span id="cb1-1076"><a href="#cb1-1076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1077"><a href="#cb1-1077" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-1078"><a href="#cb1-1078" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-1079"><a href="#cb1-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1080"><a href="#cb1-1080" aria-hidden="true" tabindex="-1"></a>In reality, the different variables shown individually in the examples in this chapter, can vary in ways that their effects add up, so the total range of variation is larger than is apparent in the examples above.</span>
<span id="cb1-1081"><a href="#cb1-1081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1082"><a href="#cb1-1082" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Seasons and latitude</span></span>
<span id="cb1-1083"><a href="#cb1-1083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1084"><a href="#cb1-1084" aria-hidden="true" tabindex="-1"></a>The main determinant of changes in spectral irradiance with seasons and latitude is the changing path of the sun through the sky, and consequently of the sun elevation angle. However, several other variables play a role. The depth of the ozone column varies with latitude and seasonally. Clouds and the water column depth vary locally and with latitude, as does ground elevation and albedo. The result is that spectral irradiance varies in time and space. One way of summarising this is to describe the local climatology using maps with monthly averages over several years interpolated over a geographic grid. One approach is to use data retrieved by instruments on board satellites. An alternative approach is to describe terrestrial solar radiation at locations where ground-level measurements are available. We start with examples based on this second approach and observations with broadband sensors from ELDONET. From the perspective of research with plants the availability of UV-B, UV-A and PhR data measured concurrently is important.</span>
<span id="cb1-1085"><a href="#cb1-1085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1086"><a href="#cb1-1086" aria-hidden="true" tabindex="-1"></a>Considering a longer time scale of years, seasonal and daily variation are combined. The seasonal pattern of variation in UV-B daily exposure is very clear but has day to day variation superimposed <span class="co">[</span><span class="ot">@fig-UVB-Erlangen A</span><span class="co">]</span>. The strong change in the UV-B:PAR photon ratio with sun elevation creates a strong seasonal pattern in this photon ratio <span class="co">[</span><span class="ot">@fig-UVB-Erlangen B</span><span class="co">]</span>.</span>
<span id="cb1-1087"><a href="#cb1-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1088"><a href="#cb1-1088" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE, message=FALSE, warning=FALSE}</span></span>
<span id="cb1-1089"><a href="#cb1-1089" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-UVB-Erlangen</span></span>
<span id="cb1-1090"><a href="#cb1-1090" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Seasonal variation in daily UV-B energy exposure Erlangen, Germany ($54^\circ 10^\prime \mathrm{N}, 07^\circ 51^\prime \mathrm{E}$, 280 m asl). A&amp;#58; daily UV-B energy exposure; B&amp;#58; UV-B:PhR daily-energy-exposures ratio. Note&amp;#58; there are gaps with missing data in the time-series data. Measured with ELDONET instruments [see, @Haeder2007].</span></span>
<span id="cb1-1091"><a href="#cb1-1091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1092"><a href="#cb1-1092" aria-hidden="true" tabindex="-1"></a>Erlangen.data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./light-environment-data/Erlangen_data.csv"</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-1093"><a href="#cb1-1093" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"1997$"</span>, Datum))</span>
<span id="cb1-1094"><a href="#cb1-1094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1095"><a href="#cb1-1095" aria-hidden="true" tabindex="-1"></a>Erlangen.data <span class="ot">&lt;-</span> <span class="fu">within</span>(Erlangen.data, date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(Datum, <span class="st">"%d/%m/%Y"</span>))</span>
<span id="cb1-1096"><a href="#cb1-1096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1097"><a href="#cb1-1097" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Erlangen.data,<span class="fu">aes</span>(<span class="at">x=</span>date,<span class="at">y=</span>UVB<span class="sc">/</span><span class="dv">1000</span>)) <span class="sc">+</span> </span>
<span id="cb1-1098"><a href="#cb1-1098" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spct</span>() <span class="sc">+</span></span>
<span id="cb1-1099"><a href="#cb1-1099" aria-hidden="true" tabindex="-1"></a><span class="co">#  geom_point(size=1, colour="black", alpha=0.33) + </span></span>
<span id="cb1-1100"><a href="#cb1-1100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_breaks =</span> <span class="st">"1 year"</span>, <span class="at">date_labels =</span> <span class="st">"%Y"</span>) <span class="sc">+</span> </span>
<span id="cb1-1101"><a href="#cb1-1101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Time"</span>, <span class="at">y=</span><span class="fu">expression</span>(<span class="st">"UV-B exposure"</span><span class="sc">~</span><span class="er">~</span>(kJ<span class="sc">~</span>d<span class="sc">^</span>{<span class="sc">-</span><span class="dv">1</span>}<span class="sc">~</span>m<span class="sc">^</span>{<span class="sc">-</span><span class="dv">2</span>})),</span>
<span id="cb1-1102"><a href="#cb1-1102" aria-hidden="true" tabindex="-1"></a>       <span class="at">tag =</span> <span class="st">"A"</span>)</span>
<span id="cb1-1103"><a href="#cb1-1103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1104"><a href="#cb1-1104" aria-hidden="true" tabindex="-1"></a>fig_ratio <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Erlangen.data,<span class="fu">aes</span>(<span class="at">x=</span>date,<span class="at">y=</span>UVB<span class="sc">/</span>PAR<span class="sc">*</span><span class="dv">1000</span>)) <span class="sc">+</span></span>
<span id="cb1-1105"><a href="#cb1-1105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spct</span>() <span class="sc">+</span></span>
<span id="cb1-1106"><a href="#cb1-1106" aria-hidden="true" tabindex="-1"></a><span class="co">#  geom_point(size=1, colour="black", alpha=0.33) + </span></span>
<span id="cb1-1107"><a href="#cb1-1107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_breaks =</span> <span class="st">"1 year"</span>, <span class="at">date_labels =</span> <span class="st">"%Y"</span>) <span class="sc">+</span> </span>
<span id="cb1-1108"><a href="#cb1-1108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Time"</span>, <span class="at">y=</span><span class="fu">expression</span>(<span class="st">"UV-B:PhR ratio"</span><span class="sc">~</span><span class="er">~</span>(<span class="dv">1</span><span class="sc">%*%</span><span class="dv">10</span><span class="sc">^</span><span class="dv">3</span>)),</span>
<span id="cb1-1109"><a href="#cb1-1109" aria-hidden="true" tabindex="-1"></a>       <span class="at">tag =</span> <span class="st">"B"</span>)</span>
<span id="cb1-1110"><a href="#cb1-1110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1111"><a href="#cb1-1111" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>((fig <span class="sc">/</span> fig_ratio) <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">axes =</span> <span class="st">"collect"</span>) )</span>
<span id="cb1-1112"><a href="#cb1-1112" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-1113"><a href="#cb1-1113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1114"><a href="#cb1-1114" aria-hidden="true" tabindex="-1"></a>UV-B irradiance increases with elevation in mountains and with decreasing latitude <span class="co">[</span><span class="ot">@fig-UVB-latitude</span><span class="co">]</span> and is particularly high on high mountains in equatorial regions. </span>
<span id="cb1-1115"><a href="#cb1-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1116"><a href="#cb1-1116" aria-hidden="true" tabindex="-1"></a><span class="ot">[^2]: </span>*Tree line* is the highest elevation on a mountain slope at which tree species are naturally able to grow.</span>
<span id="cb1-1117"><a href="#cb1-1117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1118"><a href="#cb1-1118" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE, message=FALSE}</span></span>
<span id="cb1-1119"><a href="#cb1-1119" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-UVB-latitude</span></span>
<span id="cb1-1120"><a href="#cb1-1120" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Latitudinal variation in annual UV-B and UV-A energy exposure in the Northern Hemisphere. Measured with ELDONET instruments. The ground altitude for these locations varies [see, @Haeder2007].</span></span>
<span id="cb1-1121"><a href="#cb1-1121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1122"><a href="#cb1-1122" aria-hidden="true" tabindex="-1"></a>latitudinal.data <span class="ot">&lt;-</span> </span>
<span id="cb1-1123"><a href="#cb1-1123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read.csv</span>(<span class="st">"./light-environment-data/latitudinal_data.csv"</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-1124"><a href="#cb1-1124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">within</span>(latitude <span class="ot">&lt;-</span> degrees <span class="sc">+</span> minutes<span class="sc">/</span><span class="dv">60</span>)</span>
<span id="cb1-1125"><a href="#cb1-1125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1126"><a href="#cb1-1126" aria-hidden="true" tabindex="-1"></a>fig_UVB <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>latitudinal.data,<span class="fu">aes</span>(<span class="at">x=</span>latitude,<span class="at">y=</span>UVB)) <span class="sc">+</span> </span>
<span id="cb1-1127"><a href="#cb1-1127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_poly_line</span>(<span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb1-1128"><a href="#cb1-1128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">colour=</span><span class="st">"red"</span>)<span class="sc">+</span> </span>
<span id="cb1-1129"><a href="#cb1-1129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label=</span>Location), <span class="at">colour=</span><span class="st">"Black"</span>, <span class="at">size=</span><span class="fl">3.5</span>,</span>
<span id="cb1-1130"><a href="#cb1-1130" aria-hidden="true" tabindex="-1"></a>                  <span class="at">position =</span> <span class="fu">position_nudge_line</span>(<span class="at">x =</span> <span class="fl">0.05</span>, <span class="at">y =</span> <span class="fl">0.5</span>, <span class="at">direction =</span> <span class="st">"split"</span>,</span>
<span id="cb1-1131"><a href="#cb1-1131" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">line_nudge =</span> <span class="dv">5</span>),</span>
<span id="cb1-1132"><a href="#cb1-1132" aria-hidden="true" tabindex="-1"></a>                  <span class="at">min.segment.length =</span> <span class="dv">0</span>, <span class="at">point.padding =</span> <span class="fl">0.4</span>, <span class="at">box.padding =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb1-1133"><a href="#cb1-1133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">13</span>), <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">25</span>,<span class="dv">75</span>)) <span class="sc">+</span> </span>
<span id="cb1-1134"><a href="#cb1-1134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Latitude N (degrees)"</span>, </span>
<span id="cb1-1135"><a href="#cb1-1135" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="fu">expression</span>(<span class="st">"Annual exposure"</span><span class="sc">~</span><span class="er">~</span>(MJ<span class="sc">~</span>m<span class="sc">^</span>{<span class="sc">-</span><span class="dv">2</span>})),</span>
<span id="cb1-1136"><a href="#cb1-1136" aria-hidden="true" tabindex="-1"></a>       <span class="at">tag =</span> <span class="st">"UV-B"</span>)</span>
<span id="cb1-1137"><a href="#cb1-1137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1138"><a href="#cb1-1138" aria-hidden="true" tabindex="-1"></a>fig_UVA <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>latitudinal.data,<span class="fu">aes</span>(<span class="at">x=</span>latitude,<span class="at">y=</span>UVA)) <span class="sc">+</span> </span>
<span id="cb1-1139"><a href="#cb1-1139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_poly_line</span>(<span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb1-1140"><a href="#cb1-1140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">colour=</span><span class="st">"red"</span>)<span class="sc">+</span> </span>
<span id="cb1-1141"><a href="#cb1-1141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label=</span>Location), <span class="at">colour=</span><span class="st">"Black"</span>, <span class="at">size=</span><span class="fl">3.5</span>,</span>
<span id="cb1-1142"><a href="#cb1-1142" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_nudge_line</span>(<span class="at">x =</span> <span class="fl">0.03</span>, <span class="at">y =</span> <span class="dv">200</span>, <span class="at">direction =</span> <span class="st">"split"</span>,</span>
<span id="cb1-1143"><a href="#cb1-1143" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">line_nudge =</span> <span class="dv">3</span>),</span>
<span id="cb1-1144"><a href="#cb1-1144" aria-hidden="true" tabindex="-1"></a>            <span class="at">min.segment.length =</span> <span class="dv">0</span>, <span class="at">point.padding =</span> <span class="fl">0.4</span>, <span class="at">box.padding =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb1-1145"><a href="#cb1-1145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">3300</span>), <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">25</span>,<span class="dv">75</span>)) <span class="sc">+</span> </span>
<span id="cb1-1146"><a href="#cb1-1146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Latitude N (degrees)"</span>, </span>
<span id="cb1-1147"><a href="#cb1-1147" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="fu">expression</span>(<span class="st">"Annual exposure"</span><span class="sc">~</span><span class="er">~</span>(MJ<span class="sc">~</span>m<span class="sc">^</span>{<span class="sc">-</span><span class="dv">2</span>})),</span>
<span id="cb1-1148"><a href="#cb1-1148" aria-hidden="true" tabindex="-1"></a>       <span class="at">tag =</span> <span class="st">"UV-A"</span>)</span>
<span id="cb1-1149"><a href="#cb1-1149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1150"><a href="#cb1-1150" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>((fig_UVB <span class="sc">/</span> fig_UVA) <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">axes =</span> <span class="st">"collect"</span>))</span>
<span id="cb1-1151"><a href="#cb1-1151" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-1152"><a href="#cb1-1152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1153"><a href="#cb1-1153" aria-hidden="true" tabindex="-1"></a>**I have data for 2-3 years time series measured with the same sensors as the four days plot above. Could be added as they include separate measurements of UV-B, UV-A2, UV-A1, blue, red, far-red and PAR irradiances. Maybe a figure with daily averages per month or week or showing a moving average or moving median could be informative. What do you think?**</span>
<span id="cb1-1154"><a href="#cb1-1154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1155"><a href="#cb1-1155" aria-hidden="true" tabindex="-1"></a>**Maps for global radiation, UV-B, and UV-A could be added to this section. The daily data are available on-line on a 1/2 degree grid for the last &gt;10 years. Some biologically effective exposures are also available. This is a lot of data. I have already downloaded the last 12 months. Downloading the whole time series with worldwide coverage and computing long-term means would be doable I think, but time consuming. For the time being here are maps for UV-B and UV-A with monthly means of daily doses for the whole world.**</span>
<span id="cb1-1156"><a href="#cb1-1156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1157"><a href="#cb1-1157" aria-hidden="true" tabindex="-1"></a><span class="al">![Monthly means of daily doses of UV-B. Daily data from 2023-10-01 to 2024-09-30 on a 0.5 by 0.5 degrees grid were used to compute monthly means. Grey areas in the map correspond to continuous night or low sun elevation at solar noon, which prevent remote sensing. Under these conditions UV-B irradiance is very low or null. We thank the AC SAF project of the EUMETSAT for providing data and/or products used in this figure.](images/UVB-world-map-monthly.png)</span>{#fig-uvb-world-map width=100%}</span>
<span id="cb1-1158"><a href="#cb1-1158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1159"><a href="#cb1-1159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1160"><a href="#cb1-1160" aria-hidden="true" tabindex="-1"></a><span class="al">![Monthly means of daily doses of UV-A. Daily data from 2023-10-01 to 2024-09-30 on a 0.5 by 0.5 degrees grid were used to compute monthly means. Grey areas in the map correspond to continuous night or low sun elevation at solar noon, which prevent remote sensing. Under these conditions UV-A irradiance is low or null. We thank the AC SAF project of the EUMETSAT for providing data and/or products used in this figure.](images/UVA-world-map-monthly.png)</span>{#fig-uva-world-map width=100%}</span>
<span id="cb1-1161"><a href="#cb1-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1162"><a href="#cb1-1162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1163"><a href="#cb1-1163" aria-hidden="true" tabindex="-1"></a><span class="al">![Monthly means of daily doses of UV-B for Europe. Daily data from 2023-10-01 to 2024-09-30 on a 0.5 by 0.5 degrees grid were used to compute monthly means. Grey areas in the map correspond to continuous night or low sun elevation at solar noon, which prevent remote sensing. Under these conditions UV-B irradiance is very low or null. We thank the AC SAF project of the EUMETSAT for providing data and/or products used in this figure.](images/UVB-europe-map-monthly.png)</span>{#fig-uvb-europe-map width=100%}</span>
<span id="cb1-1164"><a href="#cb1-1164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1165"><a href="#cb1-1165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1166"><a href="#cb1-1166" aria-hidden="true" tabindex="-1"></a><span class="al">![Monthly means of daily doses of UV-A for Europe. Daily data from 2023-10-01 to 2024-09-30 on a 0.5 by 0.5 degrees grid were used to compute monthly means. Grey areas in the map correspond to continuous night or low sun elevation at solar noon, which prevent remote sensing. Under these conditions UV-A irradiance is low or null. We thank the AC SAF project of the EUMETSAT for providing data and/or products used in this figure.](images/UVA-europe-map-monthly.png)</span>{#fig-uva-europe-map width=100%}</span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://www.uv4plants.org">
<p>Uv4Plants Association</p>
</a>
  </li>  
</ul>
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 © 2012-2025 COST office and authors
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>